<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>宝石重量計算ツール</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400&family=DM+Mono:wght@300;400;500&family=Noto+Sans+JP:wght@300;400;500&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg:       #0A0C0B;
  --bg2:      #0F1410;
  --bg3:      #151C16;
  --panel:    rgba(255,255,255,0.04);
  --border:   rgba(192,154,80,0.18);
  --border2:  rgba(192,154,80,0.35);
  --gold:     #C09A50;
  --gold-lt:  #E8D49A;
  --gold-dk:  #8A6A28;
  --white:    #F5F0E8;
  --muted:    rgba(245,240,232,0.45);
  --dim:      rgba(245,240,232,0.22);
  --green:    #1A3628;
  --shadow:   0 8px 40px rgba(0,0,0,0.5);
  --r:        12px;
}

html { background: var(--bg); }
body {
  font-family: 'Noto Sans JP', sans-serif;
  background: var(--bg);
  color: var(--white);
  min-height: 100vh;
  padding-bottom: 60px;
  overflow-x: hidden;
}

/* grain */
body::before {
  content: '';
  position: fixed; inset: 0; z-index: 0; pointer-events: none;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
  opacity: 0.55;
}

/* ─── Header ─── */
.page-header {
  position: relative; z-index: 1;
  text-align: center;
  padding: 44px 24px 36px;
  border-bottom: 1px solid var(--border);
  background: linear-gradient(180deg, rgba(14,20,14,0.9) 0%, transparent 100%);
}
.page-header::after {
  content: '';
  position: absolute; bottom: -1px; left: 0; right: 0; height: 1px;
  background: linear-gradient(90deg, transparent, var(--gold-dk) 25%, var(--gold) 50%, var(--gold-dk) 75%, transparent);
}
.header-eyebrow {
  font-family: 'DM Mono', monospace;
  font-size: 0.6rem;
  letter-spacing: 0.4em;
  color: var(--gold-dk);
  text-transform: uppercase;
  margin-bottom: 10px;
}
.header-title {
  font-family: 'Cormorant Garamond', serif;
  font-size: clamp(2rem, 6vw, 3.2rem);
  font-weight: 300;
  letter-spacing: 0.15em;
  color: var(--white);
  line-height: 1.1;
}
.header-title em {
  font-style: italic;
  color: var(--gold);
  font-weight: 300;
}
.header-sub {
  font-family: 'DM Mono', monospace;
  font-size: 0.62rem;
  letter-spacing: 0.2em;
  color: var(--dim);
  margin-top: 12px;
}
.header-orn {
  display: flex; align-items: center; justify-content: center; gap: 12px;
  margin-top: 18px;
}
.header-orn::before, .header-orn::after {
  content: ''; flex: 1; max-width: 80px; height: 1px;
  background: linear-gradient(90deg, transparent, rgba(192,154,80,0.4));
}
.header-orn::after { background: linear-gradient(90deg, rgba(192,154,80,0.4), transparent); }
.orn-gem {
  width: 10px; height: 10px;
  background: var(--gold);
  clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%);
}

/* ─── Layout ─── */
.wrap {
  position: relative; z-index: 1;
  max-width: 680px;
  margin: 0 auto;
  padding: 32px 18px;
}

/* ─── Section ─── */
.section { margin-bottom: 24px; }
.section-label {
  font-family: 'DM Mono', monospace;
  font-size: 0.58rem;
  letter-spacing: 0.3em;
  text-transform: uppercase;
  color: var(--gold-dk);
  margin-bottom: 10px;
  display: flex; align-items: center; gap: 10px;
}
.section-label::after { content: ''; flex: 1; height: 1px; background: var(--border); }

/* ─── Gemstone selector ─── */
.gem-select-wrap {
  position: relative;
}
.gem-select-wrap::after {
  content: '';
  position: absolute; right: 14px; top: 50%; transform: translateY(-50%);
  border: 4px solid transparent;
  border-top-color: rgba(192,154,80,0.5);
  margin-top: 2px;
  pointer-events: none;
}
select {
  width: 100%;
  font-family: 'Noto Sans JP', sans-serif;
  font-size: 0.95rem;
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: var(--r);
  color: var(--white);
  padding: 0 16px;
  height: 52px;
  outline: none;
  appearance: none;
  -webkit-appearance: none;
  cursor: pointer;
  transition: border-color 0.2s, background 0.2s, box-shadow 0.2s;
}
select:focus {
  border-color: rgba(192,154,80,0.5);
  box-shadow: 0 0 0 3px rgba(192,154,80,0.08);
}
select option { background: #0f1410; color: var(--white); }

/* Gem SG badge */
.gem-sg-info {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-top: 8px;
  font-family: 'DM Mono', monospace;
  font-size: 0.72rem;
  color: var(--muted);
  padding: 0 4px;
}
.gem-sg-val { color: var(--gold-lt); font-size: 0.8rem; }

/* ─── Cut Grid ─── */
.cut-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
  gap: 8px;
}
.cut-card {
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 10px 6px 8px;
  cursor: pointer;
  transition: border-color 0.18s, background 0.18s, transform 0.15s, box-shadow 0.18s;
  display: flex; flex-direction: column; align-items: center; gap: 6px;
  text-align: center;
}
.cut-card:hover {
  border-color: rgba(192,154,80,0.4);
  background: rgba(255,255,255,0.07);
  transform: translateY(-2px);
  box-shadow: 0 4px 16px rgba(0,0,0,0.3);
}
.cut-card.active {
  border-color: var(--gold);
  background: rgba(192,154,80,0.1);
  box-shadow: 0 0 0 1px var(--gold-dk), 0 4px 20px rgba(192,154,80,0.15);
}
.cut-card .cut-svg {
  width: 44px; height: 44px;
  display: flex; align-items: center; justify-content: center;
}
.cut-card .cut-name {
  font-size: 0.62rem;
  color: var(--muted);
  line-height: 1.3;
  word-break: keep-all;
}
.cut-card.active .cut-name { color: var(--gold-lt); }

/* ─── Dimension fields ─── */
.dim-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 10px;
}
.dim-field { display: flex; flex-direction: column; gap: 5px; }
.dim-label {
  font-size: 0.65rem;
  letter-spacing: 0.1em;
  color: var(--muted);
  display: flex; align-items: center; gap: 5px;
}
.dim-label svg { opacity: 0.5; }
.dim-select-wrap { position: relative; }
.dim-select-wrap::after {
  content: '';
  position: absolute; right: 12px; top: 50%; transform: translateY(-50%);
  border: 4px solid transparent;
  border-top-color: rgba(192,154,80,0.4);
  margin-top: 2px;
  pointer-events: none;
}
.dim-select-wrap select {
  height: 46px;
  font-family: 'DM Mono', monospace;
  font-size: 0.95rem;
  letter-spacing: 0.05em;
}

/* ─── Buttons ─── */
.btn-row {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 10px;
  margin-top: 8px;
}
.btn {
  height: 56px;
  display: flex; align-items: center; justify-content: center; gap: 8px;
  border: none; border-radius: var(--r);
  font-family: 'Cormorant Garamond', serif;
  font-size: 1.1rem;
  letter-spacing: 0.12em;
  cursor: pointer;
  transition: transform 0.15s, box-shadow 0.18s, opacity 0.15s;
}
.btn:active { transform: scale(0.97); }
.btn-calc {
  background: linear-gradient(135deg, #2a4a35 0%, #1a3628 50%, #0f2219 100%);
  border: 1px solid rgba(192,154,80,0.35);
  color: var(--gold-lt);
  box-shadow: 0 4px 20px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.06);
}
.btn-calc:hover {
  box-shadow: 0 6px 28px rgba(192,154,80,0.2), inset 0 1px 0 rgba(255,255,255,0.06);
  border-color: rgba(192,154,80,0.6);
}
.btn-reset {
  width: 56px;
  height: 56px;
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.1);
  color: var(--muted);
  border-radius: var(--r);
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: background 0.18s, border-color 0.18s, color 0.18s;
}
.btn-reset:hover { background: rgba(255,255,255,0.09); color: var(--white); border-color: rgba(255,255,255,0.2); }

/* ─── Result panel ─── */
.result-panel {
  background: linear-gradient(135deg, rgba(192,154,80,0.08) 0%, rgba(14,20,14,0.6) 100%);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 28px 24px;
  text-align: center;
  position: relative;
  overflow: hidden;
  transition: border-color 0.4s, box-shadow 0.4s;
}
.result-panel::before {
  content: '';
  position: absolute; top: 0; left: 0; right: 0; height: 1px;
  background: linear-gradient(90deg, transparent, var(--gold-dk) 30%, var(--gold) 50%, var(--gold-dk) 70%, transparent);
}
.result-panel.has-value {
  border-color: rgba(192,154,80,0.4);
  box-shadow: 0 0 40px rgba(192,154,80,0.08);
}
.result-label {
  font-family: 'DM Mono', monospace;
  font-size: 0.58rem;
  letter-spacing: 0.3em;
  text-transform: uppercase;
  color: var(--gold-dk);
  margin-bottom: 16px;
}
.result-values {
  display: flex;
  align-items: baseline;
  justify-content: center;
  gap: 12px;
  flex-wrap: wrap;
}
.result-main {
  font-family: 'Cormorant Garamond', serif;
  font-size: clamp(2.4rem, 8vw, 3.8rem);
  font-weight: 300;
  color: var(--gold-lt);
  letter-spacing: 0.04em;
  line-height: 1;
}
.result-main .unit {
  font-size: 0.45em;
  color: var(--gold);
  letter-spacing: 0.15em;
  margin-left: 4px;
}
.result-divider {
  font-size: 1.5rem;
  color: var(--border2);
  font-weight: 300;
}
.result-ct {
  font-family: 'Cormorant Garamond', serif;
  font-size: clamp(1.6rem, 5vw, 2.6rem);
  font-weight: 300;
  color: var(--muted);
  letter-spacing: 0.04em;
  line-height: 1;
}
.result-ct .unit {
  font-size: 0.45em;
  color: rgba(245,240,232,0.35);
  letter-spacing: 0.15em;
  margin-left: 4px;
}
.result-calib-note {
  font-size: 0.65rem;
  color: var(--dim);
  margin-top: 12px;
  font-family: 'DM Mono', monospace;
  letter-spacing: 0.05em;
}
.result-gem-name {
  font-family: 'Cormorant Garamond', serif;
  font-style: italic;
  font-size: 0.88rem;
  color: var(--gold-dk);
  margin-top: 4px;
  letter-spacing: 0.08em;
}

/* ─── Admin link ─── */
.admin-link {
  text-align: right;
  font-size: 0.68rem;
  margin-top: 20px;
  font-family: 'DM Mono', monospace;
  letter-spacing: 0.06em;
}
.admin-link a { color: var(--dim); text-decoration: none; transition: color 0.2s; }
.admin-link a:hover { color: var(--gold-dk); }

@media (max-width: 480px) {
  .cut-grid { grid-template-columns: repeat(4, 1fr); }
  .dim-grid  { grid-template-columns: 1fr 1fr; }
}
</style>
</head>
<body>

<div class="page-header">
  <div class="header-eyebrow">SGC GROUP — Gemological Tools</div>
  <div class="header-title"><em>宝石</em>重量計算</div>
  <div class="header-sub">GEMSTONE WEIGHT ESTIMATOR</div>
  <div class="header-orn"><div class="orn-gem"></div></div>
</div>

<div class="wrap">

  <!-- 1. 石の種類 -->
  <div class="section">
    <div class="section-label">石の種類 · Gemstone</div>
    <div class="gem-select-wrap">
      <select id="gemstoneSelect"></select>
    </div>
    <div class="gem-sg-info">
      <span>比重 SG</span>
      <span class="gem-sg-val" id="sgDisplay">—</span>
      <span id="sgRange" style="font-size:0.65rem; opacity:0.6;"></span>
    </div>
  </div>

  <!-- 2. カット選択 -->
  <div class="section">
    <div class="section-label">カット形状 · Cut Style</div>
    <div class="cut-grid" id="cutGrid"></div>
  </div>

  <!-- 3. 寸法入力 -->
  <div class="section">
    <div class="section-label">寸法入力 · Measurements</div>
    <div class="dim-grid" id="dimGrid"></div>
  </div>

  <!-- 計算ボタン -->
  <div class="btn-row">
    <button class="btn btn-calc" id="calcBtn">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18"/></svg>
      重量を計算する
    </button>
    <button class="btn-reset" id="resetBtn" title="リセット">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 .49-3.65"/></svg>
    </button>
  </div>

  <!-- 結果 -->
  <div class="result-panel" id="resultPanel" style="margin-top:20px;">
    <div class="result-label">計算結果 · Result</div>
    <div class="result-values">
      <div class="result-main"><span id="resultG">0.000</span><span class="unit">g</span></div>
      <div class="result-divider">/</div>
      <div class="result-ct"><span id="resultCt">0.000</span><span class="unit">ct</span></div>
    </div>
    <div class="result-gem-name" id="resultGemName"></div>
    <div class="result-calib-note" id="calibNote"></div>
  </div>

  <div class="admin-link">
    管理者用: <a href="register.html" target="_blank">補正データ登録</a>
  </div>

</div><!-- /wrap -->

<script>
// ─── SVG definitions for each cut ───
const CUT_SVGS = {
  round_brilliant: `<svg viewBox="0 0 44 44" fill="none" xmlns="http://www.w3.org/2000/svg">
    <circle cx="22" cy="22" r="18" stroke="#C09A50" stroke-width="1.2" fill="rgba(192,154,80,0.08)"/>
    <polygon points="22,4 38,22 22,40 6,22" fill="rgba(192,154,80,0.12)" stroke="#C09A50" stroke-width="0.8"/>
    <line x1="22" y1="4" x2="22" y2="40" stroke="#C09A50" stroke-width="0.5" opacity="0.5"/>
    <line x1="4" y1="22" x2="40" y2="22" stroke="#C09A50" stroke-width="0.5" opacity="0.5"/>
    <circle cx="22" cy="22" r="7" stroke="#C09A50" stroke-width="0.8" fill="rgba(192,154,80,0.15)"/>
    <line x1="13" y1="13" x2="31" y2="31" stroke="#C09A50" stroke-width="0.5" opacity="0.5"/>
    <line x1="31" y1="13" x2="13" y2="31" stroke="#C09A50" stroke-width="0.5" opacity="0.5"/>
  </svg>`,

  oval: `<svg viewBox="0 0 44 44" fill="none">
    <ellipse cx="22" cy="22" rx="16" ry="11" stroke="#C09A50" stroke-width="1.2" fill="rgba(192,154,80,0.08)"/>
    <ellipse cx="22" cy="22" rx="8" ry="5" stroke="#C09A50" stroke-width="0.7" fill="rgba(192,154,80,0.12)"/>
    <line x1="6" y1="22" x2="38" y2="22" stroke="#C09A50" stroke-width="0.5" opacity="0.5"/>
    <line x1="22" y1="11" x2="22" y2="33" stroke="#C09A50" stroke-width="0.5" opacity="0.5"/>
  </svg>`,

  cushion: `<svg viewBox="0 0 44 44" fill="none">
    <rect x="6" y="6" width="32" height="32" rx="9" stroke="#C09A50" stroke-width="1.2" fill="rgba(192,154,80,0.08)"/>
    <rect x="13" y="13" width="18" height="18" rx="5" stroke="#C09A50" stroke-width="0.7" fill="rgba(192,154,80,0.12)"/>
    <line x1="6" y1="22" x2="38" y2="22" stroke="#C09A50" stroke-width="0.5" opacity="0.5"/>
    <line x1="22" y1="6" x2="22" y2="38" stroke="#C09A50" stroke-width="0.5" opacity="0.5"/>
  </svg>`,

  antique_cushion: `<svg viewBox="0 0 44 44" fill="none">
    <rect x="5" y="7" width="34" height="30" rx="9" stroke="#C09A50" stroke-width="1.2" fill="rgba(192,154,80,0.08)"/>
    <rect x="12" y="13" width="20" height="18" rx="5" stroke="#C09A50" stroke-width="0.7" fill="rgba(192,154,80,0.12)"/>
    <line x1="5" y1="22" x2="39" y2="22" stroke="#C09A50" stroke-width="0.5" opacity="0.4"/>
    <line x1="22" y1="7" x2="22" y2="37" stroke="#C09A50" stroke-width="0.5" opacity="0.4"/>
  </svg>`,

  princess: `<svg viewBox="0 0 44 44" fill="none">
    <rect x="6" y="6" width="32" height="32" stroke="#C09A50" stroke-width="1.2" fill="rgba(192,154,80,0.08)"/>
    <rect x="13" y="13" width="18" height="18" stroke="#C09A50" stroke-width="0.7" fill="rgba(192,154,80,0.12)"/>
    <line x1="6" y1="6" x2="38" y2="38" stroke="#C09A50" stroke-width="0.5" opacity="0.5"/>
    <line x1="38" y1="6" x2="6" y2="38" stroke="#C09A50" stroke-width="0.5" opacity="0.5"/>
  </svg>`,

  heart: `<svg viewBox="0 0 44 44" fill="none">
    <path d="M22 36 C22 36 5 26 5 15 C5 9 10 6 15 8 C18 9 21 12 22 14 C23 12 26 9 29 8 C34 6 39 9 39 15 C39 26 22 36 22 36Z" stroke="#C09A50" stroke-width="1.2" fill="rgba(192,154,80,0.08)"/>
    <path d="M22 30 C22 30 11 23 11 16 C11 13 14 11.5 16.5 12.5 C18.5 13.3 21 16 22 17.5 C23 16 25.5 13.3 27.5 12.5 C30 11.5 33 13 33 16 C33 23 22 30 22 30Z" stroke="#C09A50" stroke-width="0.7" fill="rgba(192,154,80,0.12)"/>
  </svg>`,

  millennium: `<svg viewBox="0 0 44 44" fill="none">
    <ellipse cx="22" cy="22" rx="14" ry="11" stroke="#C09A50" stroke-width="1.2" fill="rgba(192,154,80,0.08)"/>
    <ellipse cx="22" cy="22" rx="7" ry="5" stroke="#C09A50" stroke-width="0.7" fill="rgba(192,154,80,0.12)"/>
    <line x1="8" y1="22" x2="36" y2="22" stroke="#C09A50" stroke-width="0.5" opacity="0.4"/>
    <line x1="22" y1="11" x2="22" y2="33" stroke="#C09A50" stroke-width="0.5" opacity="0.4"/>
    <line x1="12" y1="14" x2="32" y2="30" stroke="#C09A50" stroke-width="0.5" opacity="0.35"/>
    <line x1="32" y1="14" x2="12" y2="30" stroke="#C09A50" stroke-width="0.5" opacity="0.35"/>
  </svg>`,

  concave: `<svg viewBox="0 0 44 44" fill="none">
    <ellipse cx="22" cy="22" rx="15" ry="11" stroke="#C09A50" stroke-width="1.2" fill="rgba(192,154,80,0.08)"/>
    <path d="M 7 22 Q 22 16 37 22" stroke="#C09A50" stroke-width="0.7" fill="none"/>
    <path d="M 7 22 Q 22 28 37 22" stroke="#C09A50" stroke-width="0.7" fill="rgba(192,154,80,0.1)"/>
  </svg>`,

  mirror: `<svg viewBox="0 0 44 44" fill="none">
    <rect x="7" y="10" width="30" height="24" stroke="#C09A50" stroke-width="1.2" fill="rgba(192,154,80,0.08)"/>
    <rect x="13" y="15" width="18" height="14" stroke="#C09A50" stroke-width="0.7" fill="rgba(192,154,80,0.12)"/>
    <line x1="7" y1="10" x2="13" y2="15" stroke="#C09A50" stroke-width="0.5" opacity="0.6"/>
    <line x1="37" y1="10" x2="31" y2="15" stroke="#C09A50" stroke-width="0.5" opacity="0.6"/>
    <line x1="7" y1="34" x2="13" y2="29" stroke="#C09A50" stroke-width="0.5" opacity="0.6"/>
    <line x1="37" y1="34" x2="31" y2="29" stroke="#C09A50" stroke-width="0.5" opacity="0.6"/>
  </svg>`,

  marquise: `<svg viewBox="0 0 44 44" fill="none">
    <path d="M22 5 Q38 22 22 39 Q6 22 22 5Z" stroke="#C09A50" stroke-width="1.2" fill="rgba(192,154,80,0.08)"/>
    <path d="M22 11 Q33 22 22 33 Q11 22 22 11Z" stroke="#C09A50" stroke-width="0.7" fill="rgba(192,154,80,0.12)"/>
    <line x1="22" y1="5" x2="22" y2="39" stroke="#C09A50" stroke-width="0.5" opacity="0.5"/>
    <line x1="9" y1="22" x2="35" y2="22" stroke="#C09A50" stroke-width="0.5" opacity="0.5"/>
  </svg>`,

  pear: `<svg viewBox="0 0 44 44" fill="none">
    <path d="M22 6 Q36 16 36 26 Q36 38 22 38 Q8 38 8 26 Q8 16 22 6Z" stroke="#C09A50" stroke-width="1.2" fill="rgba(192,154,80,0.08)"/>
    <path d="M22 12 Q31 20 31 27 Q31 34 22 34 Q13 34 13 27 Q13 20 22 12Z" stroke="#C09A50" stroke-width="0.7" fill="rgba(192,154,80,0.12)"/>
    <line x1="22" y1="6" x2="22" y2="38" stroke="#C09A50" stroke-width="0.5" opacity="0.5"/>
  </svg>`,

  trilliant: `<svg viewBox="0 0 44 44" fill="none">
    <polygon points="22,5 40,37 4,37" stroke="#C09A50" stroke-width="1.2" fill="rgba(192,154,80,0.08)"/>
    <polygon points="22,14 33,33 11,33" stroke="#C09A50" stroke-width="0.7" fill="rgba(192,154,80,0.12)"/>
    <line x1="22" y1="5" x2="22" y2="37" stroke="#C09A50" stroke-width="0.5" opacity="0.4"/>
  </svg>`,

  baguette: `<svg viewBox="0 0 44 44" fill="none">
    <rect x="8" y="12" width="28" height="20" stroke="#C09A50" stroke-width="1.2" fill="rgba(192,154,80,0.08)"/>
    <rect x="13" y="16" width="18" height="12" stroke="#C09A50" stroke-width="0.7" fill="rgba(192,154,80,0.12)"/>
    <line x1="8" y1="12" x2="13" y2="16" stroke="#C09A50" stroke-width="0.5" opacity="0.6"/>
    <line x1="36" y1="12" x2="31" y2="16" stroke="#C09A50" stroke-width="0.5" opacity="0.6"/>
    <line x1="8" y1="32" x2="13" y2="28" stroke="#C09A50" stroke-width="0.5" opacity="0.6"/>
    <line x1="36" y1="32" x2="31" y2="28" stroke="#C09A50" stroke-width="0.5" opacity="0.6"/>
  </svg>`,

  square: `<svg viewBox="0 0 44 44" fill="none">
    <rect x="7" y="7" width="30" height="30" stroke="#C09A50" stroke-width="1.2" fill="rgba(192,154,80,0.08)"/>
    <rect x="13" y="13" width="18" height="18" stroke="#C09A50" stroke-width="0.7" fill="rgba(192,154,80,0.12)"/>
    <line x1="7" y1="7" x2="37" y2="37" stroke="#C09A50" stroke-width="0.5" opacity="0.5"/>
    <line x1="37" y1="7" x2="7" y2="37" stroke="#C09A50" stroke-width="0.5" opacity="0.5"/>
    <line x1="22" y1="7" x2="22" y2="37" stroke="#C09A50" stroke-width="0.5" opacity="0.4"/>
    <line x1="7" y1="22" x2="37" y2="22" stroke="#C09A50" stroke-width="0.5" opacity="0.4"/>
  </svg>`,

  emerald: `<svg viewBox="0 0 44 44" fill="none">
    <polygon points="10,7 34,7 39,13 39,31 34,37 10,37 5,31 5,13" stroke="#C09A50" stroke-width="1.2" fill="rgba(192,154,80,0.08)"/>
    <polygon points="14,12 30,12 34,17 34,27 30,32 14,32 10,27 10,17" stroke="#C09A50" stroke-width="0.7" fill="rgba(192,154,80,0.12)"/>
    <line x1="22" y1="7" x2="22" y2="37" stroke="#C09A50" stroke-width="0.5" opacity="0.4"/>
    <line x1="5" y1="22" x2="39" y2="22" stroke="#C09A50" stroke-width="0.5" opacity="0.4"/>
  </svg>`,

  octagon: `<svg viewBox="0 0 44 44" fill="none">
    <polygon points="14,5 30,5 39,14 39,30 30,39 14,39 5,30 5,14" stroke="#C09A50" stroke-width="1.2" fill="rgba(192,154,80,0.08)"/>
    <polygon points="17,11 27,11 33,17 33,27 27,33 17,33 11,27 11,17" stroke="#C09A50" stroke-width="0.7" fill="rgba(192,154,80,0.12)"/>
    <line x1="22" y1="5" x2="22" y2="39" stroke="#C09A50" stroke-width="0.5" opacity="0.4"/>
    <line x1="5" y1="22" x2="39" y2="22" stroke="#C09A50" stroke-width="0.5" opacity="0.4"/>
  </svg>`,

  briolette: `<svg viewBox="0 0 44 44" fill="none">
    <path d="M22 4 Q35 22 22 40 Q9 22 22 4Z" stroke="#C09A50" stroke-width="1.2" fill="rgba(192,154,80,0.08)"/>
    <line x1="22" y1="4" x2="22" y2="40" stroke="#C09A50" stroke-width="0.5" opacity="0.5"/>
    <line x1="10" y1="18" x2="34" y2="18" stroke="#C09A50" stroke-width="0.5" opacity="0.4"/>
    <line x1="13" y1="27" x2="31" y2="27" stroke="#C09A50" stroke-width="0.5" opacity="0.4"/>
  </svg>`,

  cabochon_ellipsoid: `<svg viewBox="0 0 44 44" fill="none">
    <ellipse cx="22" cy="26" rx="16" ry="11" stroke="#C09A50" stroke-width="1.2" fill="rgba(192,154,80,0.08)"/>
    <path d="M6 26 Q22 10 38 26" stroke="#C09A50" stroke-width="1" fill="rgba(192,154,80,0.15)"/>
    <line x1="6" y1="26" x2="38" y2="26" stroke="#C09A50" stroke-width="0.5" opacity="0.5"/>
  </svg>`,

  cabochon: `<svg viewBox="0 0 44 44" fill="none">
    <ellipse cx="22" cy="28" rx="14" ry="9" stroke="#C09A50" stroke-width="1.2" fill="rgba(192,154,80,0.08)"/>
    <path d="M8 28 Q22 8 36 28" stroke="#C09A50" stroke-width="1" fill="rgba(192,154,80,0.15)"/>
    <line x1="8" y1="28" x2="36" y2="28" stroke="#C09A50" stroke-width="0.5" opacity="0.5"/>
  </svg>`,

  buff_top: `<svg viewBox="0 0 44 44" fill="none">
    <ellipse cx="22" cy="30" rx="14" ry="8" stroke="#C09A50" stroke-width="1.2" fill="rgba(192,154,80,0.08)"/>
    <path d="M8 30 Q22 14 36 30" stroke="#C09A50" stroke-width="1" fill="rgba(192,154,80,0.12)"/>
    <polygon points="14,30 30,30 32,24 12,24" stroke="#C09A50" stroke-width="0.7" fill="rgba(192,154,80,0.1)"/>
    <line x1="8" y1="30" x2="36" y2="30" stroke="#C09A50" stroke-width="0.5" opacity="0.5"/>
  </svg>`,

  pearl_round: `<svg viewBox="0 0 44 44" fill="none">
    <circle cx="22" cy="22" r="16" stroke="#C09A50" stroke-width="1.2" fill="rgba(192,154,80,0.08)"/>
    <circle cx="18" cy="17" r="4" stroke="none" fill="rgba(255,255,255,0.08)"/>
    <circle cx="22" cy="22" r="5" stroke="#C09A50" stroke-width="0.5" fill="rgba(192,154,80,0.08)"/>
  </svg>`,

  mabe_pearl: `<svg viewBox="0 0 44 44" fill="none">
    <ellipse cx="22" cy="28" rx="16" ry="11" stroke="#C09A50" stroke-width="1.2" fill="rgba(192,154,80,0.08)"/>
    <path d="M6 28 Q22 6 38 28" stroke="#C09A50" stroke-width="1" fill="rgba(192,154,80,0.15)"/>
    <ellipse cx="17" cy="21" rx="4" ry="3" stroke="none" fill="rgba(255,255,255,0.07)"/>
    <line x1="6" y1="28" x2="38" y2="28" stroke="#C09A50" stroke-width="0.5" opacity="0.5"/>
  </svg>`,
};

// ─── Data (inline) ───
const GEMSTONES = [
  {"id":"diamond","name_ja":"ダイヤモンド","sg_min":3.50,"sg_max":3.53,"sg_std":3.52},
  {"id":"ruby","name_ja":"ルビー","sg_min":3.95,"sg_max":4.10,"sg_std":4.00},
  {"id":"sapphire","name_ja":"サファイア","sg_min":3.90,"sg_max":4.10,"sg_std":4.00},
  {"id":"emerald","name_ja":"エメラルド","sg_min":2.67,"sg_max":2.80,"sg_std":2.73},
  {"id":"aquamarine","name_ja":"アクアマリン","sg_min":2.68,"sg_max":2.80,"sg_std":2.74},
  {"id":"beryl","name_ja":"ベリル","sg_min":2.68,"sg_max":2.80,"sg_std":2.74},
  {"id":"garnet","name_ja":"ガーネット","sg_min":3.50,"sg_max":4.30,"sg_std":3.85},
  {"id":"spinel","name_ja":"スピネル","sg_min":3.60,"sg_max":4.10,"sg_std":3.85},
  {"id":"topaz","name_ja":"トパーズ","sg_min":3.40,"sg_max":3.60,"sg_std":3.53},
  {"id":"sphene","name_ja":"スフェーン","sg_min":3.30,"sg_max":3.52,"sg_std":3.40},
  {"id":"chrysoberyl","name_ja":"クリソベリル","sg_min":3.71,"sg_max":3.73,"sg_std":3.72},
  {"id":"tourmaline","name_ja":"トルマリン","sg_min":3.00,"sg_max":3.24,"sg_std":3.12},
  {"id":"iolite","name_ja":"アイオライト","sg_min":2.57,"sg_max":2.70,"sg_std":2.64},
  {"id":"amethyst","name_ja":"アメジスト","sg_min":2.65,"sg_max":2.66,"sg_std":2.66},
  {"id":"ametrine","name_ja":"アメトリン","sg_min":2.65,"sg_max":2.66,"sg_std":2.655},
  {"id":"citrine","name_ja":"シトリン","sg_min":2.65,"sg_max":2.75,"sg_std":2.70},
  {"id":"rose_quartz","name_ja":"ローズクォーツ","sg_min":2.65,"sg_max":2.66,"sg_std":2.66},
  {"id":"quartz","name_ja":"クオーツ","sg_min":2.65,"sg_max":2.66,"sg_std":2.66},
  {"id":"chalcedony","name_ja":"カルセドニー","sg_min":2.58,"sg_max":2.62,"sg_std":2.60},
  {"id":"apatite","name_ja":"アパタイト","sg_min":3.17,"sg_max":3.30,"sg_std":3.23},
  {"id":"fluorite","name_ja":"フローライト","sg_min":3.18,"sg_max":3.18,"sg_std":3.18},
  {"id":"jadeite","name_ja":"ジェイダイト","sg_min":3.33,"sg_max":3.34,"sg_std":3.34},
  {"id":"nephrite","name_ja":"ネフライト","sg_min":2.95,"sg_max":3.00,"sg_std":2.98},
  {"id":"turquoise","name_ja":"トルコ石","sg_min":2.60,"sg_max":2.90,"sg_std":2.75},
  {"id":"conch_pearl","name_ja":"コンクパール","sg_min":2.85,"sg_max":2.85,"sg_std":2.85},
  {"id":"pearl","name_ja":"真珠","sg_min":2.60,"sg_max":2.78,"sg_std":2.69},
  {"id":"amber","name_ja":"琥珀","sg_min":1.03,"sg_max":1.10,"sg_std":1.06},
  {"id":"jet","name_ja":"ジェット","sg_min":1.32,"sg_max":1.32,"sg_std":1.32},
  {"id":"moonstone","name_ja":"ムーンストーン","sg_min":2.56,"sg_max":2.60,"sg_std":2.58},
  {"id":"malachite","name_ja":"マラカイト","sg_min":3.74,"sg_max":3.95,"sg_std":3.85},
  {"id":"labradorite","name_ja":"ラブラドライト","sg_min":2.68,"sg_max":2.69,"sg_std":2.685},
  {"id":"lapis_lazuli","name_ja":"ラピスラズリ","sg_min":2.70,"sg_max":2.90,"sg_std":2.80},
  {"id":"shell_cameo","name_ja":"シェル・カメオ","sg_min":1.50,"sg_max":1.50,"sg_std":1.50},
  {"id":"rutilated_quartz","name_ja":"ルチルクォーツ","sg_min":2.65,"sg_max":2.70,"sg_std":2.675},
  {"id":"morganite","name_ja":"モルガナイト","sg_min":2.70,"sg_max":2.90,"sg_std":2.80},
  {"id":"moldavite","name_ja":"モルダバイト","sg_min":2.40,"sg_max":2.40,"sg_std":2.40},
  {"id":"unakite","name_ja":"ユナカイト","sg_min":2.85,"sg_max":3.20,"sg_std":3.03},
  {"id":"epidote","name_ja":"エピドート","sg_min":3.25,"sg_max":3.50,"sg_std":3.375},
  {"id":"sphalerite","name_ja":"スファレライト","sg_min":4.05,"sg_max":4.05,"sg_std":4.05},
  {"id":"hematite","name_ja":"ヘマタイト","sg_min":4.95,"sg_max":5.20,"sg_std":5.08},
  {"id":"cubic_zirconia_synth","name_ja":"キュービックジルコニア","sg_min":5.8,"sg_max":5.8,"sg_std":5.80}
];

const CUTS = [
  {"id":"round_brilliant","name_ja":"ラウンド","model":"round","measurement_fields":["d","D"],"correction_factor":0.985},
  {"id":"oval","name_ja":"オーバル","model":"ellipsoid","measurement_fields":["L","W","D"],"correction_factor":0.972},
  {"id":"cushion","name_ja":"クッション","model":"ellipsoid","measurement_fields":["L","W","D"],"correction_factor":0.965},
  {"id":"antique_cushion","name_ja":"アンティーク\nクッション","model":"ellipsoid","measurement_fields":["L","W","D"],"correction_factor":0.963},
  {"id":"princess","name_ja":"プリンセス","model":"prism_box_square","measurement_fields":["a","D"],"correction_factor":0.992},
  {"id":"heart","name_ja":"ハート","model":"pear","measurement_fields":["L","W","D"],"correction_factor":0.952},
  {"id":"millennium","name_ja":"ミレニアム","model":"ellipsoid","measurement_fields":["L","W","D"],"correction_factor":0.978},
  {"id":"concave","name_ja":"コンケーブ","model":"ellipsoid","measurement_fields":["L","W","D"],"correction_factor":0.979},
  {"id":"mirror","name_ja":"ミラー","model":"prism_box","measurement_fields":["L","W","D"],"correction_factor":0.977},
  {"id":"marquise","name_ja":"マーキス","model":"ellipsoid","measurement_fields":["L","W","D"],"correction_factor":0.949},
  {"id":"pear","name_ja":"ペアシェイプ","model":"pear","measurement_fields":["L","W","D","split_ratio"],"correction_factor":0.951},
  {"id":"trilliant","name_ja":"トリリアント","model":"trilliant","measurement_fields":["A","D"],"correction_factor":0.960},
  {"id":"baguette","name_ja":"バゲット","model":"prism_box","measurement_fields":["L","W","D"],"correction_factor":1.000},
  {"id":"square","name_ja":"スクエア","model":"prism_box_square","measurement_fields":["a","D"],"correction_factor":0.993},
  {"id":"emerald","name_ja":"エメラルド","model":"prism_box","measurement_fields":["L","W","D"],"correction_factor":0.953},
  {"id":"octagon","name_ja":"オクタゴン","model":"prism_box","measurement_fields":["L","W","D"],"correction_factor":0.980},
  {"id":"briolette","name_ja":"ブリオレット","model":"bicone","measurement_fields":["r","h_half"],"correction_factor":0.972},
  {"id":"cabochon_ellipsoid","name_ja":"カボション\n（楕円）","model":"cabochon_ellipsoid","measurement_fields":["L","W","h"],"correction_factor":1.020},
  {"id":"cabochon","name_ja":"カボション\n（円）","model":"cabochon","measurement_fields":["d","h"],"correction_factor":1.020},
  {"id":"buff_top","name_ja":"バフトップ","model":"cabochon","measurement_fields":["d","h"],"correction_factor":1.019},
  {"id":"pearl_round","name_ja":"丸（球体）","model":"pearl_round","measurement_fields":["d"],"correction_factor":1.000},
  {"id":"mabe_pearl","name_ja":"マベパール","model":"pearl_mabe","measurement_fields":["L","W","h"],"correction_factor":1.000}
];

const MODELS = {
  ellipsoid:          (L,W,D) => Math.PI*L*W*D/6.0,
  round:              (d,D,cr=0.40) => { const r=d/2,Hc=D*cr,Hp=D-Hc,Rc=(r*r+Hc*Hc)/(2*Hc),Vc=Math.PI*Hc*Hc*(Rc-Hc/3),Vp=(1/3)*Math.PI*r*r*Hp; return Vc+Vp; },
  prism_box:          (L,W,D) => L*W*D*0.94,
  prism_box_square:   (a,D) => a*a*D*0.93,
  cabochon:           (d,h) => { const a=d/2,r=(a*a+h*h)/(2*h); return Math.PI*h*h*(r-h/3); },
  cabochon_ellipsoid: (L,W,h) => { const a=Math.sqrt(L*W)/2,r=(a*a+h*h)/(2*h); return Math.PI*h*h*(r-h/3); },
  bicone:             (r,h_half) => (2/3)*Math.PI*r*r*h_half*1.03,
  trilliant:          (A,D) => (1/3)*A*D*0.97,
  pear:               (L,W,D,sp=0.60) => { const tH=D*sp,bH=D-tH,tV=Math.PI*L*W*tH/6,bV=(1/3)*Math.PI*(W/2)**2*bH; return tV+bV+tV*0.01; },
  pearl_round:        (d) => (4/3)*Math.PI*(d/2)**3,
  pearl_mabe:         (L,W,h) => (2/3)*Math.PI*(L/2)*(W/2)*h,
};

const CALIBRATIONS = [
  {"stone":"jadeite","cut":"cabochon_ellipsoid","correction_factor":1.031},
  {"stone":"sapphire","cut":"oval","correction_factor":0.869},
  {"stone":"emerald","cut":"emerald","correction_factor":0.363},
  {"stone":"ruby","cut":"cushion","correction_factor":0.949},
  {"stone":"tourmaline","cut":"octagon","correction_factor":0.618},
  {"stone":"moonstone","cut":"cabochon_ellipsoid","correction_factor":1.041},
  {"stone":"quartz","cut":"pear","correction_factor":1.146}
];

const DIM_LABELS = {
  d:"直径", D:"厚み/全高", L:"縦", W:"横",
  a:"辺長", r:"最大半径", h:"高さ",
  h_half:"片側高さ", A:"底面積 (mm²)", split_ratio:"上部割合"
};
const DIM_UNIT = { A: "mm²", split_ratio: "" };

// ─── Sort gemstones ───
function isKatakana(str) { return /^[\u30A0-\u30FF]+$/.test(str); }
const sortedGems = [...GEMSTONES].sort((a,b) => {
  const ak = isKatakana(a.name_ja), bk = isKatakana(b.name_ja);
  if(ak && !bk) return -1; if(!ak && bk) return 1;
  return a.name_ja.localeCompare(b.name_ja,'ja');
});

let selectedCutId = CUTS[0].id;

// ─── Init ───
function init() {
  // Gemstone select
  const sel = document.getElementById("gemstoneSelect");
  sortedGems.forEach(g => {
    const o = document.createElement("option");
    o.value = g.id; o.textContent = `${g.name_ja}　(SG ${g.sg_std})`;
    sel.appendChild(o);
  });
  sel.addEventListener("change", updateSgDisplay);
  updateSgDisplay();

  // Cut grid
  buildCutGrid();

  // Set default cut
  selectCut(CUTS[0].id);
}

function updateSgDisplay() {
  const gId = document.getElementById("gemstoneSelect").value;
  const g = GEMSTONES.find(x => x.id === gId);
  if(!g) return;
  document.getElementById("sgDisplay").textContent = g.sg_std.toFixed(3);
  document.getElementById("sgRange").textContent = `(${g.sg_min} – ${g.sg_max})`;
}

function buildCutGrid() {
  const grid = document.getElementById("cutGrid");
  grid.innerHTML = "";
  CUTS.forEach(cut => {
    const card = document.createElement("div");
    card.className = "cut-card";
    card.dataset.id = cut.id;
    const svgHtml = CUT_SVGS[cut.id] || `<svg viewBox="0 0 44 44"><circle cx="22" cy="22" r="14" stroke="#C09A50" stroke-width="1" fill="rgba(192,154,80,0.08)"/></svg>`;
    card.innerHTML = `
      <div class="cut-svg">${svgHtml}</div>
      <div class="cut-name">${cut.name_ja.replace('\n','<br>')}</div>`;
    card.addEventListener("click", () => selectCut(cut.id));
    grid.appendChild(card);
  });
}

function selectCut(cutId) {
  selectedCutId = cutId;
  document.querySelectorAll(".cut-card").forEach(c => {
    c.classList.toggle("active", c.dataset.id === cutId);
  });
  buildDimFields(cutId);
}

function buildDimFields(cutId) {
  const cut = CUTS.find(c => c.id === cutId);
  const grid = document.getElementById("dimGrid");
  grid.innerHTML = "";

  cut.measurement_fields.forEach(f => {
    const wrap = document.createElement("div");
    wrap.className = "dim-field";

    const label = document.createElement("div");
    label.className = "dim-label";
    label.textContent = (DIM_LABELS[f] || f) + (DIM_UNIT[f] !== undefined ? (DIM_UNIT[f] ? ` (${DIM_UNIT[f]})` : "") : " (mm)");
    wrap.appendChild(label);

    const sw = document.createElement("div");
    sw.className = "dim-select-wrap";
    const sel = document.createElement("select");
    sel.id = `dim_${f}`;

    if(f === 'split_ratio') {
      [0.4,0.5,0.6,0.7].forEach(v => {
        const o = document.createElement("option");
        o.value = v; o.textContent = v;
        if(v === 0.6) o.selected = true;
        sel.appendChild(o);
      });
    } else if(f === 'A') {
      // Bottom area in mm²: 10 to 400, step 5
      for(let i=10; i<=400; i+=5) {
        const o = document.createElement("option");
        o.value = i; o.textContent = `${i} mm²`;
        if(i === 50) o.selected = true;
        sel.appendChild(o);
      }
    } else {
      // 0.5 to 30 mm, 0.5 step
      for(let v=0.5; v<=30; v+=0.5) {
        const o = document.createElement("option");
        const vr = Math.round(v*10)/10;
        o.value = vr; o.textContent = `${vr} mm`;
        if(vr === 5) o.selected = true;
        sel.appendChild(o);
      }
    }

    sw.appendChild(sel);
    wrap.appendChild(sw);
    grid.appendChild(wrap);
  });
}

// ─── Calculate ───
document.getElementById("calcBtn").addEventListener("click", calculate);

function calculate() {
  const gId  = document.getElementById("gemstoneSelect").value;
  const stone = GEMSTONES.find(s => s.id === gId);
  const cut   = CUTS.find(c => c.id === selectedCutId);
  const modelFn = MODELS[cut.model];

  const args = cut.measurement_fields.map(f => {
    const v = parseFloat(document.getElementById(`dim_${f}`).value);
    return isNaN(v) ? 0 : v;
  });

  let V = modelFn(...args);
  V *= cut.correction_factor;
  let massG = stone.sg_std * V / 1000;

  // Calibration
  const relevant = CALIBRATIONS.filter(c => c.stone === gId && c.cut === selectedCutId);
  let calibApplied = false;
  if(relevant.length > 0) {
    const avg = relevant.reduce((s,c) => s + c.correction_factor, 0) / relevant.length;
    massG *= avg;
    calibApplied = true;
  }

  const massCt = massG / 0.2;

  document.getElementById("resultG").textContent  = massG.toFixed(3);
  document.getElementById("resultCt").textContent = massCt.toFixed(3);
  document.getElementById("resultGemName").textContent = `${stone.name_ja}　/　${cut.name_ja.replace('\n',' ')}`;
  document.getElementById("calibNote").textContent = calibApplied
    ? "▸ 実測補正データ適用済み"
    : "▸ 標準モデル値（補正データなし）";
  document.getElementById("resultPanel").classList.add("has-value");

  // Scroll to result
  document.getElementById("resultPanel").scrollIntoView({ behavior: "smooth", block: "nearest" });
}

// ─── Reset ───
document.getElementById("resetBtn").addEventListener("click", () => {
  document.getElementById("gemstoneSelect").selectedIndex = 0;
  updateSgDisplay();
  selectCut(CUTS[0].id);
  document.getElementById("resultG").textContent  = "0.000";
  document.getElementById("resultCt").textContent = "0.000";
  document.getElementById("resultGemName").textContent = "";
  document.getElementById("calibNote").textContent = "";
  document.getElementById("resultPanel").classList.remove("has-value");
});

init();
</script>
</body>
</html>
