<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="icon" href="https://raw.githubusercontent.com/sgc-gold/sgc/main/image/sgc-icon.png" type="image/png">
  <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/sgc-gold/sgc/main/image/sgc-icon.png">
  <title>SGC 社内ポータル</title>
  <link href="https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@400;600;700&family=Cormorant+Garamond:ital,wght@0,400;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
  <style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --green:    #1A3628;
    --green-lt: #254D38;
    --green-dk: #0E1F17;
    --gold:     #C09A50;
    --gold-lt:  #E8D49A;
    --gold-dk:  #8A6A28;
    --white:    #FFFFFF;
    --border:   rgba(192,154,80,0.18);
    --nav-w:    260px;
    --header-h: 58px;
    --bottom-content-h: 56px;
    --safe-top:    env(safe-area-inset-top,    0px);
    --safe-bottom: env(safe-area-inset-bottom, 0px);
    --safe-left:   env(safe-area-inset-left,   0px);
    --safe-right:  env(safe-area-inset-right,  0px);
  }

  /* ─────────────────────────────────────
     高さ戦略:
     dvh → svh → 100vh のフォールバックチェーン。
     JSの visualViewport でさらに補正する。
  ───────────────────────────────────── */
  html {
    height: 100vh;
    height: 100svh;
    height: 100dvh;
    background: var(--green-dk);
  }
  body {
    height: 100vh;
    height: 100svh;
    height: 100dvh;
    overflow: hidden;
    background: var(--green-dk);
    font-family: 'DM Sans', sans-serif;
  }

  /* ─── App shell ─── */
  #shell {
    display: grid;
    grid-template-columns: var(--nav-w) 1fr;
    grid-template-rows: calc(var(--header-h) + var(--safe-top)) 1fr;
    grid-template-areas:
      "hdr  hdr"
      "side main";
    width: 100%;
    height: 100vh;
    height: 100svh;
    height: 100dvh;
    overflow: hidden;
  }

  /* ─── Header ─── */
  #app-header {
    grid-area: hdr;
    background: var(--green-dk);
    border-bottom: 1px solid rgba(192,154,80,0.12);
    display: flex;
    align-items: flex-end; /* safe-area padding後に下揃え */
    padding: var(--safe-top) 16px 0;
    height: calc(var(--header-h) + var(--safe-top));
    padding-bottom: 0;
    gap: 12px;
    position: relative;
    z-index: 300;
  }
  /* ヘッダー内コンテンツを下端に揃えるラッパー */
  #app-header .header-inner {
    display: flex;
    align-items: center;
    gap: 12px;
    width: 100%;
    height: var(--header-h);
  }
  #app-header::after {
    content: '';
    position: absolute;
    bottom: 0; left: 0; right: 0; height: 1px;
    background: linear-gradient(90deg, transparent, var(--gold-dk) 25%, var(--gold) 50%, var(--gold-dk) 75%, transparent);
  }

  .header-logo  { height: 26px; width: auto; opacity: 0.9; flex-shrink: 0; }
  .header-title {
    flex: 1;
    font-family: 'Shippori Mincho', serif;
    font-size: 1.05rem;
    font-weight: 600;
    color: var(--white);
    letter-spacing: 0.1em;
    cursor: pointer;
    user-select: none;
  }
  .header-title:hover { color: var(--gold-lt); }

  .hamburger {
    display: none;
    flex-direction: column;
    gap: 5px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 6px;
    border-radius: 8px;
    flex-shrink: 0;
    -webkit-tap-highlight-color: transparent;
  }
  .hamburger span {
    display: block; width: 22px; height: 2px;
    background: rgba(255,255,255,0.8); border-radius: 2px;
    transition: all 0.28s ease;
  }
  .hamburger.open span:nth-child(1) { transform: translateY(7px) rotate(45deg); }
  .hamburger.open span:nth-child(2) { opacity: 0; }
  .hamburger.open span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }

  /* ─── Sidebar ─── */
  #sidebar {
    grid-area: side;
    background: var(--green-dk);
    border-right: 1px solid rgba(192,154,80,0.1);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .sidebar-scroll {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    padding: 16px 12px 20px;
    scrollbar-width: thin;
    scrollbar-color: rgba(192,154,80,0.18) transparent;
    -webkit-overflow-scrolling: touch;
  }
  .sidebar-scroll::-webkit-scrollbar { width: 3px; }
  .sidebar-scroll::-webkit-scrollbar-thumb { background: rgba(192,154,80,0.2); border-radius: 4px; }

  .nav-section-title {
    font-size: 0.56rem;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    color: rgba(192,154,80,0.45);
    padding: 14px 8px 5px;
    display: flex; align-items: center; gap: 8px;
  }
  .nav-section-title::after { content: ''; flex: 1; height: 1px; background: rgba(192,154,80,0.1); }

  .nav-link {
    display: flex; align-items: center; gap: 10px;
    padding: 8px 10px;
    border-radius: 8px;
    color: rgba(255,255,255,0.55);
    font-size: 0.84rem;
    text-decoration: none;
    cursor: pointer;
    transition: background 0.15s, color 0.15s;
    border: 1px solid transparent;
    user-select: none;
    margin-bottom: 1px;
    -webkit-tap-highlight-color: transparent;
  }
  .nav-link:hover  { background: rgba(255,255,255,0.05); color: rgba(255,255,255,0.85); }
  .nav-link.active { background: rgba(192,154,80,0.1); color: var(--gold-lt); border-color: rgba(192,154,80,0.16); }
  .nav-link.disabled { opacity: 0.28; pointer-events: none; text-decoration: line-through; }
  .nav-icon { width: 16px; height: 16px; opacity: 0.55; flex-shrink: 0; transition: opacity 0.15s; }
  .nav-link:hover .nav-icon, .nav-link.active .nav-icon { opacity: 0.9; }

  .sidebar-footer {
    padding: 10px 14px;
    border-top: 1px solid rgba(192,154,80,0.08);
    font-size: 0.6rem;
    color: rgba(255,255,255,0.18);
    letter-spacing: 0.06em;
    font-family: 'Cormorant Garamond', serif;
    font-style: italic;
    text-align: center;
  }

  /* ─── Main content ─── */
  #content-area {
    grid-area: main;
    overflow: hidden;
    background: #F7F3EB;
    display: flex;
    flex-direction: column;
    padding-left:  var(--safe-left);
    padding-right: var(--safe-right);
  }

  #main-frame {
    flex: 1;
    width: 100%;
    border: none;
    display: block;
    min-height: 0;
  }

  /* ─── Overlay ─── */
  #overlay {
    display: none;
    position: fixed; inset: 0; z-index: 250;
    background: rgba(0,0,0,0.5);
    backdrop-filter: blur(2px);
    -webkit-backdrop-filter: blur(2px);
  }
  #overlay.active { display: block; }

  /* ══════════════════════════════════
     MOBILE (< 900px)
  ══════════════════════════════════ */
  @media (max-width: 899px) {

    #shell {
      grid-template-columns: 1fr;
      grid-template-rows:
        calc(var(--header-h) + env(safe-area-inset-top, 0px))
        1fr
        auto; /* ← auto にして bottom-nav の実測高さに任せる */
      grid-template-areas:
        "hdr"
        "main"
        "bnav";
    }

    .hamburger { display: flex; }

    #sidebar {
      grid-area: unset;
      position: fixed;
      top: calc(var(--header-h) + env(safe-area-inset-top, 0px));
      left: 0;
      width: var(--nav-w);
      bottom: 0;
      z-index: 260;
      transform: translateX(-100%);
      transition: transform 0.3s cubic-bezier(0.4,0,0.2,1);
      box-shadow: 4px 0 24px rgba(0,0,0,0.55);
    }
    #sidebar.open { transform: translateX(0); }

    /* ─── Bottom nav ─── */
    #bottom-nav {
      grid-area: bnav;
      background: var(--green-dk);
      border-top: 1px solid rgba(192,154,80,0.14);
      display: flex;
      align-items: stretch;

      /* ★ 核心: コンテンツ高さは min-height で保証し、
           safe-area 分は padding-bottom で追加する。
           height: auto のままなので grid が正しく計算できる。 */
      padding-bottom: env(safe-area-inset-bottom, 0px);
      padding-left:   env(safe-area-inset-left,   0px);
      padding-right:  env(safe-area-inset-right,  0px);

      /* Edge PWA で grid-area が消えることへの保険 */
      position: relative;
      z-index: 100;
      /* Edge で display:flex が無視されるケース対策 */
      min-height: var(--bottom-content-h);
    }

    .bnav-item {
      flex: 1;
      display: flex !important; /* Edge PWA で flex が剥がれる対策 */
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 3px;
      color: rgba(255,255,255,0.38);
      font-size: 0.58rem;
      letter-spacing: 0.03em;
      cursor: pointer;
      border: none;
      background: none;
      padding: 8px 2px;
      min-height: var(--bottom-content-h);
      text-decoration: none;
      transition: color 0.15s;
      -webkit-tap-highlight-color: transparent;
    }
    .bnav-item.active { color: var(--gold); }
    .bnav-item svg {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
      display: block; /* SVG が inline のままだと Edge で崩れる */
    }
    .bnav-item span {
      display: block;
      line-height: 1;
    }
  }

  @media (min-width: 900px) {
    #bottom-nav { display: none !important; }
  }
  </style>
</head>
<body>
<div id="shell">

  <!-- ─── Header ─── -->
  <header id="app-header">
    <div class="header-inner">
      <button class="hamburger" id="hamburger" onclick="toggleSidebar()">
        <span></span><span></span><span></span>
      </button>
      <div class="header-title" onclick="navigate('main.html',null)">社内ポータル</div>
      <img class="header-logo" src="https://www.sgc-gold.co.jp/img/header-logo.png" alt="SGC">
    </div>
  </header>

  <!-- ─── Sidebar ─── -->
  <nav id="sidebar">
    <div class="sidebar-scroll">

      <div class="nav-section-title">Home</div>
      <a class="nav-link active" onclick="navigate('main.html',this)">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        トップページ
      </a>

      <div class="nav-section-title">Market · 貴金属市況</div>
      <a class="nav-link" onclick="navigate('price.html',this)">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
        価格情報
      </a>
      <a class="nav-link" onclick="navigate('market.html',this)">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8M12 17v4"/></svg>
        市況情報
      </a>

      <div class="nav-section-title">Purchase · 買取関連</div>
      <a class="nav-link" onclick="navigate('https://script.google.com/macros/s/AKfycbxV4bMjhApWrwqTBLsuu0BnSQ5L8TyaV40_qCOO_RFjT3-WHvosgeesx_LxWZAO4MFr/exec',this)">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
        IGシリアル照合
      </a>
      <a class="nav-link" onclick="navigate('coin.html',this)">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
        記念金貨買取価格
      </a>
      <a class="nav-link" onclick="navigate('https://script.google.com/macros/s/AKfycbxeQHB5lwwoTw0f-cgXh657fuaNiHL-LMbo5AfUOm9pDyftHNaF7OPi5hfMOrKNPhKYyQ/exec',this)">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="9" y1="15" x2="15" y2="15"/></svg>
        買取 / 分割確認
      </a>
      <a class="nav-link" onclick="navigate('diamond.html',this)">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M12 2L2 9l10 13 10-13-10-7z"/><path d="M2 9h20"/></svg>
        ダイヤ相場検索
      </a>
      <a class="nav-link" onclick="navigate('gemstone.html',this)">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="12" cy="12" r="3"/><path d="M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83"/></svg>
        色石重量検索
      </a>

      <div class="nav-section-title">Sales · 販売関連</div>
      <a class="nav-link disabled">準備中</a>

      <div class="nav-section-title">Reference · 社内資料</div>
      <a class="nav-link" onclick="navigate('schedule.html',this)">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
        スケジュール
      </a>
      <a class="nav-link" onclick="navigate('contacts.html',this)">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M21 10c0 7-9 13-9 13S3 17 3 10a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
        拠点一覧
      </a>

      <div class="nav-section-title">Media · メディア</div>
      <a class="nav-link" onclick="navigate('news.html',this)">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 0-2 2zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2"/><path d="M18 14h-8M15 18h-5M10 6h8v4h-8z"/></svg>
        ニュース
      </a>
      <a class="nav-link" onclick="navigate('youtube.html',this)">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M22.54 6.42a2.78 2.78 0 0 0-1.95-1.96C18.88 4 12 4 12 4s-6.88 0-8.59.46a2.78 2.78 0 0 0-1.95 1.96A29 29 0 0 0 1 12a29 29 0 0 0 .46 5.58A2.78 2.78 0 0 0 3.41 19.54C5.12 20 12 20 12 20s6.88 0 8.59-.46a2.78 2.78 0 0 0 1.95-1.96A29 29 0 0 0 23 12a29 29 0 0 0-.46-5.58z"/><polygon points="9.75 15.02 15.5 12 9.75 8.98 9.75 15.02"/></svg>
        YouTube
      </a>

    </div>
    <div class="sidebar-footer">© SGC Co., Ltd. All Rights Reserved.</div>
  </nav>

  <!-- ─── Content ─── -->
  <div id="content-area">
    <iframe id="main-frame" src="main.html" scrolling="yes" allowtransparency="true"></iframe>
  </div>

  <!-- ─── Bottom nav (mobile only) ─── -->
  <nav id="bottom-nav">
    <a class="bnav-item active" onclick="navigate('main.html',this)" data-bnav>
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
      <span>ホーム</span>
    </a>
    <a class="bnav-item" onclick="navigate('price.html',this)" data-bnav>
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
      <span>価格</span>
    </a>
    <a class="bnav-item" onclick="navigate('coin.html',this)" data-bnav>
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
      <span>金貨</span>
    </a>
    <a class="bnav-item" onclick="navigate('market.html',this)" data-bnav>
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8M12 17v4"/></svg>
      <span>市況</span>
    </a>
    <button class="bnav-item" onclick="toggleSidebar()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><line x1="3" y1="6"  x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
      <span>メニュー</span>
    </button>
  </nav>

</div><!-- /shell -->

<div id="overlay" onclick="closeSidebar()"></div>

<script>
// ─────────────────────────────────────────────
//  HEIGHT FIX
//  visualViewport API が最も正確（iOS Safari 13+, Edge 79+）
//  なければ window.innerHeight にフォールバック
// ─────────────────────────────────────────────
function getVH() {
  return window.visualViewport ? window.visualViewport.height : window.innerHeight;
}

function setHeight() {
  const h = getVH();
  const shell = document.getElementById('shell');
  shell.style.height = h + 'px';
  sizeFrame();
}

function sizeFrame() {
  const frame   = document.getElementById('main-frame');
  const content = document.getElementById('content-area');
  if (!frame || !content) return;
  const rect = content.getBoundingClientRect();
  if (rect.height > 0) {
    frame.style.height = rect.height + 'px';
  }
}

// 初回実行
setHeight();

// イベント登録
if (window.visualViewport) {
  window.visualViewport.addEventListener('resize', setHeight);
  window.visualViewport.addEventListener('scroll', setHeight);
} else {
  window.addEventListener('resize', setHeight);
}

window.addEventListener('orientationchange', function() {
  setTimeout(setHeight, 100);
  setTimeout(setHeight, 350);
  setTimeout(setHeight, 700);
});

window.addEventListener('load', function() {
  setHeight();
  setTimeout(setHeight, 300);
});

// ─────────────────────────────────────────────
//  NAVIGATION
// ─────────────────────────────────────────────
var frame = document.getElementById('main-frame');

function navigate(url, el) {
  if (!url || url === '#') return;
  frame.src = url;

  document.querySelectorAll('#sidebar .nav-link').forEach(function(l) { l.classList.remove('active'); });
  if (el && el.closest && el.closest('#sidebar')) el.classList.add('active');

  document.querySelectorAll('[data-bnav]').forEach(function(l) { l.classList.remove('active'); });
  if (el && el.hasAttribute && el.hasAttribute('data-bnav')) el.classList.add('active');

  if (window.innerWidth < 900) closeSidebar();
}

// ─────────────────────────────────────────────
//  SIDEBAR
// ─────────────────────────────────────────────
var sidebar   = document.getElementById('sidebar');
var overlay   = document.getElementById('overlay');
var hamburger = document.getElementById('hamburger');

function toggleSidebar() {
  var isOpen = sidebar.classList.toggle('open');
  hamburger.classList.toggle('open', isOpen);
  overlay.classList.toggle('active', isOpen);
}
function closeSidebar() {
  sidebar.classList.remove('open');
  hamburger.classList.remove('open');
  overlay.classList.remove('active');
}

window.addEventListener('message', function() {});
</script>
</body>
</html>
