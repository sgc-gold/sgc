<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒ€ã‚¤ãƒ¤ç›¸å ´æ¤œç´¢</title>
<style>
/* =======================
   åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ«
======================= */
body {
  margin:0; padding:0;
  font-family:'Noto Sans JP', sans-serif;
  background: linear-gradient(180deg, #fdfdfd 0%, #f7f6f3 100%);
  color: #1b2b2b;
}

.container {
  max-width:700px;
  background:#fff;
  padding:1.2rem 1.4rem;
  border-radius: 16px;
  box-shadow: 0 4px 18px rgba(0,0,0,0.06);
  border: 1px solid #eae7dc;
}

/* è¦‹å‡ºã— */
h2 {
  margin-bottom:1rem;
  color:#1b2b2b;
  font-weight:700;
  border-bottom: 2px solid #bfa14a;
  display:inline-block;
  padding-bottom: 4px;
  letter-spacing: 0.5px;
}

/* å…¥åŠ›ãƒ»ãƒœã‚¿ãƒ³å…±é€š */
input, select, button {
  font-size:1.05rem;
  padding:0.8rem 0.75rem;
  border-radius:8px;
  border:1px solid #d3d3d3;
  background:#fff;
  transition:all 0.25s ease;
}

input:focus, select:focus {
  outline:none;
  border-color:#bfa14a;
  box-shadow:0 0 0 3px rgba(191,161,74,0.25);
}

/* ãƒœã‚¿ãƒ³ */
button {
  cursor:pointer;
  font-weight:600;
  letter-spacing:0.3px;
}

#searchButton {
  background:linear-gradient(135deg,#bfa14a,#d6c36b);
  color:#fff;
  width:140px;
  border:none;
  box-shadow:0 2px 6px rgba(191,161,74,0.35);
}
#searchButton:hover {
  opacity:0.95;
  transform:translateY(-1px);
  box-shadow:0 4px 10px rgba(191,161,74,0.4);
}

#clearButton {
  background:linear-gradient(135deg,#f2f2f2,#e0e0e0);
  color:#333;
  width:140px;
  border:1px solid #ccc;
}
#clearButton:hover {
  background:linear-gradient(135deg,#fafafa,#e8e8e8);
}

/* è¡Œãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
.flex-row {
  display:flex;
  flex-wrap:wrap;
  gap:0.5rem;
  align-items:center;
  margin-bottom:0.8rem;
}
.flex-row label {
  width:150px;
  font-weight:600;
  text-align:center;
  color:#333;
}
.flex-row select {
    flex: 1 1 60px; /* flex-grow:1, flex-shrink:1, flex-basis:60px */
    min-width: 60px; 
}   

/* ã‚«ãƒ©ãƒƒãƒˆå…¥åŠ› */
#mainCarat {
  width:90px;
  text-align:center;
}

/* ã‚«ãƒ©ãƒƒãƒˆã‚»ãƒƒãƒˆè¡Œ */
#caratSetRow {
  display:flex;
  align-items:center;
  flex-wrap:wrap;
}

#caratSetRow button#setCarat {
  margin-right:2rem;
  margin-left:1rem;
  background:linear-gradient(135deg,#bfa14a,#d4b95e);
  color:#fff;
  border:none;
  box-shadow:0 2px 6px rgba(191,161,74,0.35);
}
#caratSetRow button#setCarat:hover {
  opacity:0.95;
  transform:translateY(-1px);
}

/* æœ€å°ï½æœ€å¤§ã‚«ãƒ©ãƒƒãƒˆ */
#caratRange {
  display:inline-flex;
  align-items:center;
}

#caratRange input {
  width:50px;
  text-align:center;
  border-radius:6px;
  border:1px solid #ccc;
  padding:0.45rem 0.6rem;
  margin:0.4rem;
  background:#fdfdfd;
}
#caratRange input:focus {
  border-color:#bfa14a;
  box-shadow:0 0 0 3px rgba(191,161,74,0.2);
}
#caratRange span {
  font-weight:600;
  color:#444;
}

/* ã‚«ãƒ©ãƒ¼åˆ‡æ›¿ç”¨ */
.colorSelector {
  display:flex;
  flex-direction:column;
  flex:1;
}

.colorButtons {
  display:flex;
  gap:0.5rem;
  margin-bottom:0.4rem;
}

.colorButtons button {
  padding:0.5rem 0.8rem;
  border-radius:6px;
  border:1px solid #ccc;
  background:#fdfdfd;
  cursor:pointer;
  font-weight:600;
  transition:all 0.2s ease;
}

.colorButtons button.active {
  background:linear-gradient(135deg,#bfa14a,#d4b95e);
  color:#fff;
  border:none;
}

.colorButtons button:hover:not(.active) {
  background:#f7f7f7;
}

/* ãƒ•ã‚©ãƒ¼ãƒ éƒ¨åˆ† */
.colorForms select {
  margin-right:0.4rem;
  margin-bottom:0.3rem;
}

input[type="checkbox"] {
  vertical-align: middle; /* ä¸­å¤®æƒãˆ */
  margin: 0; /* iOSã®ä½™ç™½èª¿æ•´ */
}

label {
  vertical-align: middle; /* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã¨åŒã˜ãƒ©ã‚¤ãƒ³ã«æƒãˆã‚‹ */
}

/* =======================
   ãƒ†ãƒ¼ãƒ–ãƒ«
======================= */
.table-wrapper {
  width: 100%;
}

#resultTable {
  width:100%;
  border-collapse:collapse;
  margin-top:1rem;
  display:none;
  border:1px solid #e5e5e5;
  border-radius:8px;
  overflow:hidden;
  box-shadow:0 2px 6px rgba(0,0,0,0.03);
}

#resultTable th, #resultTable td {
  border:1px solid #e8e8e8;
  padding:8px 4px;
  text-align:center;
  font-size:0.75rem;
}

#resultTable th {
  background:linear-gradient(180deg,#faf9f5,#f1efe8);
  font-weight:700;
  color:#2c2c2c;
  border-bottom:2px solid #d1c089;
}

.detailsRow {
  display:none;
  background:#fbfbfa;
}

.detailsRow td {
  text-align:left;
  font-size:0.9rem;
}

.detailToggle {
  color:#bfa14a;
  cursor:pointer;
  font-weight:600;
  transition:color 0.2s ease;
}
.detailToggle:hover {
  color:#8e7a38;
}

#resultTable td.priceCell {
  text-align:right;
  padding-right:1rem;
}

/* ã‚µãƒãƒªãƒ¼ãƒœãƒƒã‚¯ã‚¹å…¨ä½“ã‚’ä¸­å¤®å¯„ã›ï¼ˆä»–ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«å½±éŸ¿ãŒå‡ºã‚‹å ´åˆã¯ .container å†…ã«èª¿æ•´ã—ã¦ãã ã•ã„ï¼‰ */
.summary-box {
  margin: 2.5rem auto;           /* æ¨ªä¸­å¤®ã«é…ç½® */
  padding: 1rem 1.25rem;
  border: 1px solid #e0d8b0;
  border-radius: 12px;
  background: linear-gradient(135deg,#fdf9f0,#f7f2de);
  box-shadow: 0 6px 18px rgba(0,0,0,0.06);
  width: 380px;                  /* å¿…è¦ã«å¿œã˜ã¦èª¿æ•´ */
  max-width: 96%;
}

/* ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½¿ã£ã¦å·¦å³2åˆ—ã‚’å®‰å®šé…ç½® */
.summary-table {
  width: 100%;
  border-collapse: collapse;
  font-family: "Noto Sans JP", sans-serif;
}

.summary-table td {
  padding: 8px 6px;
  vertical-align: middle;
}

/* å·¦åˆ—ï¼ˆãƒ©ãƒ™ãƒ«ï¼‰: ä¸­å¤®æƒãˆ */
.summary-table .label {
  width: 36%;                    /* å·¦å¹…ã‚’å›ºå®šçš„ã«ç¢ºä¿ */
  text-align: center;
  font-weight: 600;
  color: #5a4a2d;
  white-space: nowrap;           /* ãƒ©ãƒ™ãƒ«ã§æ”¹è¡Œã•ã›ãªã„ */
  padding-right: 12px;
}

/* å³åˆ—ï¼ˆå€¤ï¼‰: å·¦æƒãˆã€æ•°å€¤ã¨å˜ä½ã‚’æ”¹è¡Œã•ã›ãªã„ */
.summary-table .value {
  width: 64%;
  text-align: right;
  color: #2f2f2f;
}

/* æ•°å€¤ï¼‹å˜ä½ã‚’åŒã˜è¡Œã«ã™ã‚‹ */
.value-inline {
  display: inline-block;
  white-space: nowrap;           /* â† ã“ã“ãŒé‡è¦ï¼šæ•°å€¤ã¨å˜ä½ã‚’æ”¹è¡Œã•ã›ãªã„ */
  font-size: 0.98rem;
}

/* å˜ä½ã®è¦‹ãŸç›® */
.unit {
  color: #555;
  font-weight: 500;
  margin-left: 0.1rem;
}

/* select ã®è¦‹ãŸç›®ã‚’æƒãˆã‚‹ */
#rateSelect {
  padding: 0.5rem 2rem;
  border-radius: 6px;
  border: 1px solid #d0b880;
  background: #fff;
  font-weight: 600;
}

/* è²·å–ä¾¡æ ¼è¡Œï¼ˆå¼·èª¿ï¼‰*/
.total-label {
  font-size: 1rem;
}
.total-value .value-inline strong,
.total-value .value-inline .unit {
  font-size: 1.05rem;
  color: #8b6e3c;
  font-weight: 700;
}

/* =======================
   ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ãƒ”ãƒŠãƒ¼
======================= */
.spinner {
  width:32px;
  height:32px;
  border:3px solid #ddd;
  border-top:3px solid #bfa14a;
  border-radius:50%;
  animation: spin 1s linear infinite;
  margin:auto;
}
@keyframes spin {
  0% { transform:rotate(0deg); }
  100% { transform:rotate(360deg); }
}

/* =======================
   ä»¶æ•°è¡¨ç¤ºãƒ»ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
======================= */
.stylish-count {
  font-size:1.05rem;
  font-weight:600;
  color:#333;
  padding:6px 0 10px 4px;
  display:inline-block;
  margin:6px 0 12px 2px;
  letter-spacing:0.3px;
  position:relative;
}
.stylish-count::before {
  content:"";
  position:absolute;
  left:0;
  bottom:0;
  width:80px;
  height:2px;
  background:linear-gradient(90deg,#bfa14a,transparent);
  border-radius:2px;
}

.stylish-pagination {
  margin:22px 0 8px;
  text-align:center;
}
.stylish-pagination button {
  background:linear-gradient(135deg,#ffffff,#f6f6f4);
  color:#333;
  border:1px solid #ccc;
  padding:6px 12px;
  margin:0 4px;
  border-radius:6px;
  cursor:pointer;
  font-weight:500;
  transition:all 0.25s ease;
}
.stylish-pagination button:hover:not(:disabled) {
  background:linear-gradient(135deg,#f9f7ed,#fff);
  border-color:#bfa14a;
  color:#bfa14a;
  transform:translateY(-1px);
  box-shadow:0 2px 6px rgba(191,161,74,0.2);
}
.stylish-pagination button:disabled {
  color:#aaa;
  border-color:#eee;
  cursor:not-allowed;
}
.stylish-pagination span {
  font-size:0.95rem;
  color:#555;
  margin:0 10px;
}

/* =======================
   ãƒ¢ãƒã‚¤ãƒ«
======================= */
@media(max-width:480px){
  /* å…¨ä½“ã®è¡Œãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
  .flex-row {
    flex-direction: row;
    align-items: center;
    flex-wrap: nowrap; /* â† æŠ˜ã‚Šè¿”ã•ãªã„ */
  }

  /* ãƒ©ãƒ™ãƒ« */
  .flex-row label {
    width: 105px;         /* â† æ¨ªå¹…å°‘ã—ç¸®ã‚ã‚‹ */
    text-align: left;
    margin-bottom: 0;
    flex-shrink: 0;       /* â† ãƒ©ãƒ™ãƒ«ãŒç¸®ã¾ã‚‰ãªã„ã‚ˆã†ã« */
  }

  /* å…¥åŠ›æ¬„ã‚„ã‚»ãƒ¬ã‚¯ãƒˆã®å…±é€šè¨­å®š */
  .flex-row input,
  .flex-row select {
    flex: 1;               /* â† å…¥åŠ›æ¬„ã¯æ®‹ã‚Šå¹…ã‚’ä½¿ã† */
    min-width: 0;          /* â† æŠ˜ã‚Šè¿”ã—é˜²æ­¢ */
  }

  /* ã‚«ãƒ©ãƒƒãƒˆã‚»ãƒƒãƒˆè¡Œ */
  #caratSetRow {
    flex-wrap: wrap; /* â† ã‚«ãƒ©ãƒƒãƒˆã‚»ãƒƒãƒˆè¡Œã¯æŠ˜ã‚Šè¿”ã—OK */
  }

  /* ã‚«ãƒ©ãƒƒãƒˆç¯„å›²ï¼ˆæœ€å°ï½æœ€å¤§ï¼‰ã‚’æ¨ªä¸¦ã³ç¶­æŒ */
  #caratRange {
    flex-direction: row;
    align-items: center;
    flex-wrap: nowrap;
  }

  #caratRange input {
    width: 55px; /* â† ãƒ¢ãƒã‚¤ãƒ«ã§å°‘ã—ç‹­ã */
  }

  /* ã‚«ãƒ©ãƒ¼åˆ‡æ›¿ãƒ•ã‚©ãƒ¼ãƒ ã®æ¨ªä¸¦ã³èª¿æ•´ */
  .colorForms {
    display:flex;
    flex-wrap:wrap;
    gap:0.4rem;
  }
  .colorForms .alphaForm,
  .colorForms .fancyForm {
    display:flex;
    flex-wrap:wrap;
    gap:0.3rem;
    flex:1 1 100%; /* æ¨ªå¹…ãŒç‹­ã‘ã‚Œã°æ”¹è¡Œã•ã‚Œã‚‹ */
  }
  .colorForms select {
    flex:1 1 60px; /* å¹…ã‚’æŸ”è»Ÿã« */
    min-width:50px;
  }  

  .table-wrapper {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch; /* iPhoneã§ã®ã‚¹ãƒ ãƒ¼ã‚ºã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */
  }

  #resultTable {
    min-width: 800px; /* ã‚¹ãƒãƒ›ã§æ½°ã‚Œãªã„ã‚ˆã†ã«æœ€ä½å¹…ã‚’ç¢ºä¿ */
    font-size: 0.85rem; /* å°‘ã—å°ã•ã‚ã«ã—ã¦è¦‹ã‚„ã™ã */
  }

  #resultTable th, #resultTable td {
    white-space: nowrap; /* æŠ˜ã‚Šè¿”ã•ãšæ¨ªã«ä¸¦ã¹ã‚‹ */
    padding: 0.4rem 0.6rem;
  }
}
</style>
</head>
<body>
<div class="container">
  <!-- ã‚«ãƒ©ãƒƒãƒˆã‚»ãƒƒãƒˆ + æœ€å°ï½æœ€å¤§ -->
  <div class="flex-row">
    <label for="mainCarat">ã‚«ãƒ©ãƒƒãƒˆï¼ˆctï¼‰</label>
    <div id="caratSetRow">
      <input type="text" id="mainCarat" placeholder="ä¾‹ï¼š0.345" inputmode="decimal" pattern="[0-9]*\.?[0-9]*">     
      <button type="button" id="setCarat">ã‚»ãƒƒãƒˆ</button>
      <div id="caratRange">
        <input type="text" id="minCarat" placeholder="æœ€å°ct" inputmode="decimal" pattern="[0-9]*\.?[0-9]*">
        <span>ï½</span>
        <input type="text" id="maxCarat" placeholder="æœ€å¤§ct" inputmode="decimal" pattern="[0-9]*\.?[0-9]*">
      </div>
    </div>
  </div>

  <!-- æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆå…ƒã‚³ãƒ¼ãƒ‰ã¨åŒã˜ï¼‰ -->
  <div class="flex-row" style="align-items:center;">
    <label for="dateSelect">é–‹å‚¬æ—¥</label>
    <select id="dateSelect"><option value="">ã™ã¹ã¦</option></select>
    <span style="margin-left:0.5rem; color:#555; font-size:0.5rem;">â€»é¸æŠæ—¥ä»¥é™ã§æ¤œç´¢</span>
  </div>

  <!-- ã‚«ãƒ©ãƒ¼é¸æŠ -->
  <div class="flex-row">
    <label>ã‚«ãƒ©ãƒ¼</label>
    <div class="colorSelector">
      <div class="colorButtons">
        <button type="button" class="colorTypeBtn active" data-type="alpha">A to Z</button>
        <button type="button" class="colorTypeBtn" data-type="fancy">FANCY</button>
      </div>
      <div class="colorForms">
        <!-- ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã‚«ãƒ©ãƒ¼ãƒ•ã‚©ãƒ¼ãƒ  -->
        <div class="alphaForm">
          <select id="fromColor"><option value="">From</option></select>
          <span>ã€œ</span>
          <select id="toColor"><option value="">To</option></select>
        </div>
        <!-- FANCYç³»ãƒ•ã‚©ãƒ¼ãƒ  -->
        <div class="fancyForm" style="display:none;">
          <select id="fancyGradeSelect"><option value="">ã™ã¹ã¦</option></select>
          <select id="fancyToneSelect"><option value="">ã™ã¹ã¦</option></select>
        </div>
      </div>
    </div>
  </div>
   
  <div class="flex-row">
    <label for="claritySelect">ã‚¯ãƒ©ãƒªãƒ†ã‚£</label>
    <select id="claritySelect">
      <option value="">ã™ã¹ã¦</option>
      <option value="FL">FL</option>
      <option value="IF">IF</option>
      <option value="VVS1">VVS1</option>
      <option value="VVS2">VVS2</option>
      <option value="VS1">VS1</option>    
      <option value="VS2">VS2</option>       
      <option value="SI1">SI1</option>       
      <option value="SI2">SI2</option>  
      <option value="I1">I1</option>        
      <option value="I2">I2</option> 
      <option value="I3">I3</option>                     
    </select>
  </div>
  <div class="flex-row">
    <label for="cutSelect">ã‚«ãƒƒãƒˆ</label>
    <select id="cutSelect">
      <option value="">ã™ã¹ã¦</option>
      <option value="EX">EX</option>
      <option value="VG">VG</option>
      <option value="GD">GD</option>
      <option value="FR">FR</option>
      <option value="PR">PR</option>
    </select>
    <label style="margin-left:10px; font-weight:normal;">
      <input type="checkbox" id="hcCheck"> H&C
    </label>
  </div>
  <div class="flex-row">
    <label for="fluorescenceSelect">è›å…‰æ€§</label>
    <select id="fluorescenceSelect">
      <option value="">ã™ã¹ã¦</option>
      <option value="N">N</option>
      <option value="F">F</option>
      <option value="MB">MB</option>
      <option value="SB">SB</option>
      <option value="VSB">VSB</option>
    </select>
  </div>
  <div class="flex-row">
    <label for="shapeSelect">å½¢çŠ¶</label>
    <select id="shapeSelect"><option value="">ã™ã¹ã¦</option></select>
  </div>

  <div class="flex-row">
    <label for="keyword">ãƒ•ãƒªãƒ¼ãƒ¯ãƒ¼ãƒ‰</label>
    <input type="text" id="keyword" placeholder="ä¾‹ï¼šD VS1 GD">
  </div>

  <div class="flex-row" style="justify-content:center; gap:1rem;">
    <button id="searchButton">æ¤œç´¢</button>
    <button id="clearButton">ã‚¯ãƒªã‚¢</button>
  </div>

  <div id="loadingSpinner" style="display:none; justify-content:center; margin-top:1rem;">
    <div class="spinner"></div>
  </div>

  <!-- è²·å–å‚è€ƒä¾¡æ ¼ã‚µãƒãƒªãƒ¼ -->
  <div id="summaryBox" class="summary-box">
    <table class="summary-table" role="table" aria-label="è²·å–å‚è€ƒä¾¡æ ¼ã‚µãƒãƒªãƒ¼">
      <tbody>
        <tr>
          <td class="label">æ¤œç´¢ä»¶æ•°</td>
          <td class="value"><span class="value-inline"><strong id="summaryCount">0</strong>&nbsp;<span class="unit">ä»¶</span></span></td>
        </tr>
        <tr>
          <td class="label">å¹³å‡ã‚¬ã‚¤å˜ä¾¡</td>
          <td class="value"><span class="value-inline"><strong id="summaryAvgPrice">0</strong>&nbsp;<span class="unit">å††</span></span></td>
        </tr>
        <tr>
          <td class="label">æ›ã‘ç‡</td>
          <td class="value">
            <span class="value-inline">
              <select id="rateSelect" aria-label="æ›ã‘ç‡">
                <option value="0.5">5æ›ã‘</option>
                <option value="0.6">6æ›ã‘</option>
                <option value="0.7" selected>7æ›ã‘</option>
                <option value="0.8">8æ›ã‘</option>
                <option value="0.9">9æ›ã‘</option>
              </select>
            </span>
          </td>
        </tr>
        <tr>
          <td class="label">ã‚¬ã‚¤å˜ä¾¡</td>
          <td class="value"><span class="value-inline"><strong id="summaryUnitPrice">0</strong>&nbsp;<span class="unit">å††</span></span></td>
        </tr>
        <tr>
          <td class="label">ã‚«ãƒ©ãƒƒãƒˆ</td>
          <td class="value"><span class="value-inline"><strong id="summaryCarat">0.000</strong>&nbsp;<span class="unit">ct</span></span></td>
        </tr>
        <tr>
          <td class="label total-label">è²·å–ä¾¡æ ¼</td>
          <td class="value total-value"><span class="value-inline"><strong id="summaryTotalPrice">0</strong>&nbsp;<span class="unit">å††</span></span></td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- çµæœãƒ†ãƒ¼ãƒ–ãƒ« -->
  <div class="table-wrapper">
    <table id="resultTable">
      <thead>
        <tr>
          <th>æ—¥ä»˜</th>
          <th>ã‚«ãƒ©ãƒ¼</th>
          <th>ã‚¯ãƒ©ãƒªãƒ†ã‚£</th>
          <th>ã‚«ãƒƒãƒˆ</th>
          <th>è›å…‰æ€§</th>
          <th>å½¢çŠ¶</th>
          <th>ã‚«ãƒ©ãƒƒãƒˆ</th>
          <th>ã‚¬ã‚¤å˜ä¾¡</th>
          <th>é‡‘é¡</th>
          <th>å‚™è€ƒ</th>
          <th>è©³ç´°</th>
        </tr>
      </thead>
      <tbody id="resultBody"></tbody>
    </table>
  </div>
</div>

<script>
  // ---------------------
  // å…±é€šå®šç¾©
  // ---------------------
  const alphabetColors = "D E F G H I J K L M N O P Q R S T U V W X Y Z".split(" ");
  const fancyGrades = ["FAINT","VERY LIGHT","LIGHT","FANCY LIGHT","FANCY","FANCY INTENSE","FANCY VIVID","FANCY DEEP","FANCY DARK"];
  const fancyTones = ["YELLOW","PINK","BLUE","GREEN","BROWN","ORANGE","PURPLE","RED","GRAY","BLACK"];
  const CLARITY_ORDER = ["FL","IF","VVS1","VVS2","VS1","VS2","SI1","SI2","I1","I2","I3"];
  const caratThresholds = [0,0.1,0.2,0.25,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1,1.5,2,3,5];

  // ---------------------
  // ã‚«ãƒ©ãƒƒãƒˆã‚»ãƒƒãƒˆæ©Ÿèƒ½
  // ---------------------
document.getElementById("setCarat").addEventListener("click", () => {
  const c = parseFloat(document.getElementById("mainCarat").value);
  if (isNaN(c)) return alert("æ•°å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

  let min = 0, max = null;

  // å…¥åŠ›å€¤ãŒcaratThresholdsã®ç¯„å›²ã«å…¥ã‚‹ã‹åˆ¤å®š
  for (let i = 0; i < caratThresholds.length - 1; i++) {
    if (c >= caratThresholds[i] && c < caratThresholds[i + 1]) {
      min = caratThresholds[i];
      max = caratThresholds[i + 1] - 0.001;
      break;
    }
  }

  // æœ€å¾Œã®ç¯„å›²ï¼ˆ5.000ä»¥ä¸Šï¼‰ã®å ´åˆã¯ä¸Šé™ãªã—
  if (c >= caratThresholds[caratThresholds.length - 1]) {
    min = caratThresholds[caratThresholds.length - 1];
    max = null; // ä¸Šé™ãªã—
  }

  document.getElementById("minCarat").value = min.toFixed(3);
  document.getElementById("maxCarat").value = max !== null ? max.toFixed(3) : "";
});

  // ---------------------
  // ã‚«ãƒ©ãƒ¼åˆ‡ã‚Šæ›¿ãˆ
  // ---------------------
  const colorBtns = document.querySelectorAll('.colorTypeBtn');
  colorBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      // ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åˆ‡æ›¿
      colorBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      // ãƒ•ã‚©ãƒ¼ãƒ åˆ‡æ›¿
      const type = btn.dataset.type;
      document.querySelector('.alphaForm').style.display = type === 'alpha' ? 'flex' : 'none';
      document.querySelector('.fancyForm').style.display = type === 'fancy' ? 'flex' : 'none';
    });
  });

  // ---------------------
  // AtoZå…¥åŠ›è¦å‰‡
  // ---------------------  
  const fromColor = document.getElementById('fromColor');
  const toColor = document.getElementById('toColor');

  // Fromã‚’å¤‰æ›´ã—ãŸã‚‰Toã«ã‚³ãƒ”ãƒ¼
  fromColor.addEventListener('change', () => {
    toColor.value = fromColor.value;
  });

  // Toã‚’å¤‰æ›´ã—ã¦ã‚‚Fromã¯å¤‰ãˆãªã„
  toColor.addEventListener('change', () => {
    // ç‰¹ã«å‡¦ç†ã¯ä¸è¦ã€Fromã«å½±éŸ¿ã•ã›ãªã„
  });

  // ---------------------
  // JSONå–å¾—ï¼†ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ä½œæˆ
  // ---------------------
  let diamondData = [];
  async function populateFilters() {
    const resp = await fetch("https://raw.githubusercontent.com/sgc-gold/sgc/main/data/diamonds.json");
    diamondData = await resp.json();

    const sets = { dates:new Set(), clarities:new Set(), cuts:new Set(), fluos:new Set(), shapes:new Set() };
    diamondData.forEach(d => {
      if(d.date) sets.dates.add(d.date.split(" ")[0]);
      if(d.clarity) sets.clarities.add(d.clarity);
      if(d.cut) sets.cuts.add(d.cut);
      if(d.fluorescence) sets.fluos.add(d.fluorescence);
      if(d.shape) sets.shapes.add(d.shape);
    });

    const addOption = (sel,val)=>sel.appendChild(new Option(val,val));

    Array.from(sets.dates).sort((a,b)=>new Date(b)-new Date(a)).forEach(d=>addOption(document.getElementById("dateSelect"),d));
    document.getElementById("dateSelect").selectedIndex = 1;
    Array.from(sets.shapes).sort().forEach(s=>addOption(document.getElementById("shapeSelect"),s));

    const fromColorSel = document.getElementById("fromColor");
    const toColorSel = document.getElementById("toColor");
    alphabetColors.forEach(c => { addOption(fromColorSel,c); addOption(toColorSel,c); });

    const fancyGradeSel = document.getElementById("fancyGradeSelect");
    const fancyToneSel = document.getElementById("fancyToneSelect");
    fancyGrades.forEach(g=>addOption(fancyGradeSel,g));
    fancyTones.forEach(t=>addOption(fancyToneSel,t));
  }
  populateFilters();

  // ---------------------
  // FANCYã‚«ãƒ©ãƒ¼åˆ¤å®š
  // ---------------------
  function isFancyColor(color){
    if(!color) return false;
    const upper=color.toUpperCase().trim();
    if(upper.includes("UNDER")) return false;
    if(upper.includes("FANCY")) return true;
    const fancyTones=["PINK","PURPLE","BLUE","GREEN","ORANGE","YELLOW","BROWN","GRAY","RED","VIOLET","BLACK","WHITE"];
    const ishTerms=["ISH","ORANGY","PINKISH","PURPLISH","GRAYISH","YELLOWISH","BROWNISH","GREENISH","BLUISH"];
    return fancyTones.some(t=>upper.includes(t))||ishTerms.some(i=>upper.includes(i));
  }

  // ---------------------
  // ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°é–¢æ•°
  // ---------------------
  function getColorScore(color){
    const baseMap={D:100,E:95,F:90,G:85,H:80,I:75,J:70,K:65,L:60,M:55,N:50,O:45,P:40,Q:35,R:30,S:25,T:20,U:15,V:10,W:5,X:3,Y:2,Z:1};
    const fancyGradeMap={"FANCY VIVID":20,"FANCY INTENSE":18,"FANCY DEEP":16,"FANCY DARK":14,"FANCY":12,"FANCY LIGHT":10,"LIGHT":8,"VERY LIGHT":6,"FAINT":4};
    const fancyColorMap={RED:30,BLUE:25,PINK:20,GREEN:18,ORANGE:15,PURPLE:12,VIOLET:10,YELLOW:8,BROWN:5,GRAY:3,BLACK:2,WHITE:1};
    const ishMap={PINKISH:1,PURPLISH:1,BLUISH:0,GREENISH:0,BROWNISH:-2,GRAYISH:-3,YELLOWISH:-1,ORANGY:-1,VIOLETISH:0,BLACKISH:-3};
    if(!color) return 0;
    const upper=color.toUpperCase();
    let score=0;
    for(const key in baseMap) if(upper.startsWith(key)||upper.includes("UNDER "+key)){score=baseMap[key];break;}
    for(const grade in fancyGradeMap) if(upper.includes(grade)) score+=fancyGradeMap[grade];
    for(const tone in fancyColorMap) if(upper.includes(tone)) score+=fancyColorMap[tone];
    for(const ish in ishMap) if(upper.includes(ish)) score+=ishMap[ish];
    if(score<1) score+=1000;
    return score;
  }

  function getCutScore(cutStr){
    if(!cutStr) return 0;
    const rankMap={ "3EX":100, EX:90, VG:70, GD:50, FR:30, FA:29, PR:10, PO:9 };
    let score=0;
    if(cutStr.includes("H&C")||cutStr.includes("HC")) score+=5;
    if(cutStr.includes("HEART")||cutStr.includes("H&A")) score+=3;
    const parts=cutStr.split("/");
    const main=parts[0].replace(/[^A-Z]/g,"");
    score+=rankMap[main]||0;
    if(parts.length===3){ score+=(rankMap[parts[2]]||0)*0.1; score+=(rankMap[parts[1]]||0)*0.05; }
    else if(parts.length===2){ score+=(rankMap[parts[1]]||0)*0.05; }
    return score;
  }

  function getFluorescenceScore(fluo){
    if(!fluo) return 0;
    const intensityMap={N:0,NONE:0,F:1,FAINT:1,M:2,MEDIUM:2,S:3,STRONG:3,VS:4,"VERY STRONG":4};
    const colorBonusMap={BLUE:0.5,BL:0.5,FB:0.5,MB:0.5,VSB:0.5,YELLOW:-0.5,FtY:-0.5,MY:-0.5,SY:-0.5,VSY:-0.5,GREEN:0,FtYGn:0,MYGn:0,SYGn:0,VSYGn:0,WHITE:0,WB:0,MBW:0,VSBW:0,GRAY:-1,SWG:-1,WYG:-1,INERT:0};
    const upper=fluo.toUpperCase();
    let score=0;
    for(const key in intensityMap) if(upper.includes(key)){score+=intensityMap[key];break;}
    for(const key in colorBonusMap) if(upper.includes(key)){score+=colorBonusMap[key];break;}
    return score;
  }

  function getCaratGroupIndex(carat,color){
    const maxIndex=caratThresholds.length;
    if(isFancyColor(color)) return maxIndex;
    for(let i=0;i<caratThresholds.length;i++){ if(carat<caratThresholds[i]) return i; }
    return maxIndex-1;
  }

  // ---------------------
  // æ¤œç´¢å‡¦ç†
  // ---------------------
  document.getElementById("searchButton").addEventListener("click", () => {
    const spinner = document.getElementById("loadingSpinner");
    spinner.style.display = "flex";

    setTimeout(() => {
      // ã‚«ãƒƒãƒˆã¨H&Cå–å¾—
      const cutVal = document.getElementById("cutSelect").value;
      const hcChecked = document.getElementById("hcCheck").checked;

      // ä»–ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å–å¾—ï¼ˆä»¥å‰ã®ã‚³ãƒ¼ãƒ‰ã¨åŒã˜ï¼‰
      const minC = parseFloat(document.getElementById("minCarat").value) || 0;
      const maxC = parseFloat(document.getElementById("maxCarat").value) || 999;
      const dateVal = document.getElementById("dateSelect").value;
      const clarityVal = document.getElementById("claritySelect").value;
      const fluVal = document.getElementById("fluorescenceSelect").value;
      const shapeVal = document.getElementById("shapeSelect").value;
      const keyword = document.getElementById("keyword").value.trim().toLowerCase();

      const fromColor = document.getElementById("fromColor").value;
      const toColor = document.getElementById("toColor").value;
      const fancyGrade = document.getElementById("fancyGradeSelect").value;
      const fancyTone = document.getElementById("fancyToneSelect").value;

      const tbody = document.getElementById("resultBody");
      tbody.innerHTML = "";
      document.getElementById("resultTable").style.display = "table"; 

      // ä»¶æ•°è¡¨ç¤º
      let countTop = document.getElementById("resultCountTop");
      let countBottom = document.getElementById("resultCountBottom");
      if(!countTop){
        countTop = document.createElement("div");
        countTop.id = "resultCountTop";
        countTop.className = "result-count stylish-count";
        tbody.parentElement.insertAdjacentElement("beforebegin",countTop);
      }
      if(!countBottom){
        countBottom = document.createElement("div");
        countBottom.id = "resultCountBottom";
        countBottom.className = "result-count stylish-count";
        tbody.parentElement.insertAdjacentElement("afterend",countBottom);
      }

      const fromIndex = alphabetColors.indexOf(fromColor);
      const toIndex = alphabetColors.indexOf(toColor);

      // çµã‚Šè¾¼ã¿
      const results = diamondData.filter(d => {
        const c = parseFloat(d.carat) || 0;
        if(c<minC||c>maxC) return false;
        if(dateVal && d.date.split(" ")[0] < dateVal) return false;
        if(clarityVal && d.clarity!=clarityVal) return false;
        if(fluVal && d.fluorescence!=fluVal) return false;
        if(shapeVal && d.shape!=shapeVal) return false;

        // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
        if(keyword){
          const fields=[d.carat,d.color,d.clarity,d.cut,d.fluorescence,d.notes].join(" ").toLowerCase();
          if(!keyword.split(" ").every(k=>fields.includes(k))) return false;
        }

        // ã‚«ãƒ©ãƒ¼åˆ¤å®šï¼ˆä»¥å‰ã®ã‚³ãƒ¼ãƒ‰ãã®ã¾ã¾ï¼‰
        const colorUpper=(d.color||"").toUpperCase();
        const isFancy = isFancyColor(d.color);
        let matchAlphabet=true;
        if(!isFancy && fromColor && toColor){
          const colorIndex = alphabetColors.findIndex(c=>colorUpper.startsWith(c));
          matchAlphabet=(colorIndex>=fromIndex && colorIndex<=toIndex);
        } else if(!isFancy){ matchAlphabet=true; } else { matchAlphabet=false; }

        let matchFancy=true;
        if(isFancy){
          if(fancyGrade && fancyTone){
            matchFancy=colorUpper.includes(fancyGrade.toUpperCase()) && colorUpper.includes(fancyTone.toUpperCase());
          } else if(fancyGrade){
            matchFancy=colorUpper.includes(fancyGrade.toUpperCase());
          } else if(fancyTone){
            matchFancy=colorUpper.includes(fancyTone.toUpperCase());
          } else { matchFancy=true; }
        } else { matchFancy=false; }

        let colorMatch=true;
        if((fromColor && toColor) && !(fancyGrade || fancyTone)) colorMatch=matchAlphabet;
        else if((fancyGrade||fancyTone) && !(fromColor && toColor)) colorMatch=matchFancy;
        else if(!(fromColor && toColor) && !(fancyGrade||fancyTone)) colorMatch=true;
        else colorMatch=matchAlphabet || matchFancy;

        // ã‚«ãƒƒãƒˆåˆ¤å®š
        let cutMatch = true;
        if(cutVal){
          const cutUpper = (d.cut||"").toUpperCase();
          if(cutVal==="FR") cutMatch = cutUpper.includes("FR") || cutUpper.includes("FA");
          else if(cutVal==="PR") cutMatch = cutUpper.includes("PR") || cutUpper.includes("PO");
          else cutMatch = cutUpper.includes(cutVal);
        }

        // H&Cåˆ¤å®š
        let hcMatch = true;
        if(hcChecked){
          const cutUpper = (d.cut||"").toUpperCase();
          hcMatch = cutUpper.includes("H&C") || cutUpper.includes("HC");
        }

        return colorMatch && cutMatch && hcMatch;
      });

      // ä¸¦ã³æ›¿ãˆ
      results.sort((a,b)=>{
        const groupA=getCaratGroupIndex(parseFloat(a.carat),a.color);
        const groupB=getCaratGroupIndex(parseFloat(b.carat),b.color);
        if(groupA!==groupB) return groupA-groupB;
        const colorDiff=getColorScore(b.color)-getColorScore(a.color);
        if(colorDiff!==0) return colorDiff;
        const clarityDiff=CLARITY_ORDER.indexOf(a.clarity)-CLARITY_ORDER.indexOf(b.clarity);
        if(clarityDiff!==0) return clarityDiff;
        const cutDiff=getCutScore(b.cut)-getCutScore(a.cut);
        if(cutDiff!==0) return cutDiff;
        return getFluorescenceScore(b.fluorescence)-getFluorescenceScore(a.fluorescence);
      });

      // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
      const perPage=100;
      let currentPage=1;
      const totalPages=Math.ceil(results.length/perPage);
      const pagination=document.getElementById("paginationArea")||document.createElement("div");
      pagination.id="paginationArea";
      pagination.className="pagination stylish-pagination";
      countBottom.insertAdjacentElement("afterend",pagination);

      function renderPage(page){
        tbody.innerHTML="";
        const start=(page-1)*perPage;
        const end=start+perPage;
        results.slice(start,end).forEach(d=>{
          const row=document.createElement("tr");
          row.innerHTML=`
            <td>${d.date.split(" ")[0]||""}</td>
            <td>${d.color||""}</td>
            <td>${d.clarity||""}</td>
            <td>${d.cut||""}</td>
            <td>${d.fluorescence||""}</td>
            <td>${d.shape||""}</td>
            <td>${parseFloat(d.carat)?.toFixed(3)||""}</td>
            <td class="priceCell">${parseFloat(d.pricePerCarat)?.toLocaleString()||""}</td>
            <td class="priceCell">${Math.floor(parseFloat(d.pricePerCarat)*parseFloat(d.carat))?.toLocaleString()||""}</td>
            <td>${d.notes||""}</td>
            <td><span class="detailToggle">è©³ç´°</span></td>
          `;
          tbody.appendChild(row);

          const detailRow=document.createElement("tr");
          detailRow.classList.add("detailsRow");
          let unevenRate="", heightRatio="";
          if(d.diameterMin && d.diameterMax){
            const min=parseFloat(d.diameterMin), max=parseFloat(d.diameterMax);
            const avg=(min+max)/2;
            unevenRate=(((max-min)/avg)*100).toFixed(2)+"%";
            if(d.height) heightRatio=((parseFloat(d.height)/avg)*100).toFixed(2)+"%";
          }
          detailRow.innerHTML=`
            <td colspan="11">
              ç›´å¾„ï¼š${d.diameterMin||""}-${d.diameterMax||""}mmï¼ˆä¸æ­£å††ç‡ï¼š${unevenRate}ï¼‰ã€€é«˜ã•ï¼š${d.height||""}mmï¼ˆå…¨é«˜æ¯”ï¼š${heightRatio}ï¼‰
            </td>
          `;
          tbody.appendChild(detailRow);

          row.querySelector(".detailToggle").addEventListener("click",()=>{
            detailRow.style.display=detailRow.style.display==="table-row"?"none":"table-row";
          });
        });

        const msg=results.length
          ? `ğŸ”¹æ¤œç´¢çµæœï¼š<strong>${results.length.toLocaleString()}</strong> ä»¶ï¼ˆ${page}/${totalPages}ãƒšãƒ¼ã‚¸ï¼‰`
          : `âš  è©²å½“ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚`;
        countTop.innerHTML=msg;
        countBottom.innerHTML=msg;
      }

      function updatePagination(){
        pagination.innerHTML="";
        if(totalPages<=1) return;
        const prev=document.createElement("button");
        prev.textContent="â† å‰ã¸";
        prev.disabled=currentPage===1;
        prev.onclick=()=>{currentPage--; renderPage(currentPage); updatePagination();};
        const next=document.createElement("button");
        next.textContent="æ¬¡ã¸ â†’";
        next.disabled=currentPage===totalPages;
        next.onclick=()=>{currentPage++; renderPage(currentPage); updatePagination();};
        const info=document.createElement("span");
        info.innerHTML=`ãƒšãƒ¼ã‚¸ ${currentPage} / ${totalPages}`;
        pagination.append(prev,info,next);
      }

      renderPage(1);
      updatePagination();
      window.lastSearchResults = results; // å¾Œã§æ›ã‘ç‡å¤‰æ›´æ™‚ã«å†åˆ©ç”¨
      updateSummary(results);             // è²·å–å‚è€ƒä¾¡æ ¼ã‚’æ›´æ–°
      spinner.style.display="none";
    },100);
  });

  // ---------------------
  // ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³
  // ---------------------
  document.getElementById("clearButton").addEventListener("click", () => {
    // å„å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
    ["minCarat","maxCarat","mainCarat","fromColor","toColor","fancyGradeSelect","fancyToneSelect",
    "claritySelect","cutSelect","fluorescenceSelect","shapeSelect","keyword"].forEach(id => {
      document.getElementById(id).value = "";
    });

    // H&C ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ
    document.getElementById("hcCheck").checked = false;

    // çµæœãƒ†ãƒ¼ãƒ–ãƒ«æœ¬ä½“ã‚’éè¡¨ç¤ºã‹ã¤ã‚¯ãƒªã‚¢
    document.getElementById("resultBody").innerHTML = "";
    document.getElementById("resultTable").style.display = "none";

    // ä»¶æ•°è¡¨ç¤ºã‚‚å‰Šé™¤
    const countTop = document.getElementById("resultCountTop");
    const countBottom = document.getElementById("resultCountBottom");
    if(countTop) countTop.remove();
    if(countBottom) countBottom.remove();

    // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚‚å‰Šé™¤
    const pagination = document.getElementById("paginationArea");
    if(pagination) pagination.remove();

    // âœ… ã‚µãƒãƒªãƒ¼ãƒªã‚»ãƒƒãƒˆå‡¦ç†
    document.getElementById("summaryCount").textContent = "0";
    document.getElementById("summaryAvgPrice").textContent = "0";
    document.getElementById("summaryUnitPrice").textContent = "0";
    document.getElementById("summaryCarat").textContent = "0.000";
    document.getElementById("summaryTotalPrice").textContent = "0";

    // æ›ã‘ç‡ã‚‚åˆæœŸå€¤ï¼ˆ7æ›ã‘ï¼‰ã«æˆ»ã™
    document.getElementById("rateSelect").value = "0.7";

    // æ¤œç´¢çµæœã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ãƒªã‚»ãƒƒãƒˆ
    window.lastSearchResults = [];
  });  

  // ---------------------
  // è²·å–ä¾¡æ ¼è¨ˆç®—
  // ---------------------  
  function updateSummary(results) {
    const carat = parseFloat(document.getElementById("mainCarat").value) || 0;
    const rate = parseFloat(document.getElementById("rateSelect").value) || 1;

    const count = results.length;

    // å¹³å‡ä¾¡æ ¼ã®è¨ˆç®—ï¼ˆpricePerCarat ã‚’ä½¿ç”¨ï¼‰
    const avgPrice = count > 0 
      ? Math.round(results.reduce((sum, d) => sum + (parseFloat(d.pricePerCarat) || 0), 0) / count)
      : 0;

    const unitPrice = Math.round(avgPrice * rate);
    const totalPrice = Math.round(unitPrice * carat);

    document.getElementById("summaryCount").textContent = count;
    document.getElementById("summaryAvgPrice").textContent = avgPrice.toLocaleString();
    document.getElementById("summaryUnitPrice").textContent = unitPrice.toLocaleString();
    document.getElementById("summaryCarat").textContent = carat.toFixed(3);
    document.getElementById("summaryTotalPrice").textContent = totalPrice.toLocaleString();
  }

  // æ›ã‘ç‡å¤‰æ›´æ™‚ã«ã‚‚æ›´æ–°
  document.getElementById("rateSelect").addEventListener("change", () => {
    // æ¤œç´¢æ¸ˆã¿çµæœãŒã‚ã‚Œã°å†è¨ˆç®—
    const results = window.lastSearchResults || [];
    updateSummary(results);
  });

  // ===== ã‚µãƒãƒªãƒ¼ãƒªã‚»ãƒƒãƒˆé–¢æ•° =====
  function clearSummary() {
    document.getElementById("summaryCount").textContent = "0";
    document.getElementById("summaryAvgPrice").textContent = "0";
    document.getElementById("summaryUnitPrice").textContent = "0";
    document.getElementById("summaryCarat").textContent = "0.000";
    document.getElementById("summaryTotalPrice").textContent = "0";

    // æ›ã‘ç‡ã‚‚åˆæœŸå€¤ã«æˆ»ã™ï¼ˆä»»æ„ï¼‰
    document.getElementById("rateSelect").value = "0.7";
  }
  </script>
</body>
</html>
