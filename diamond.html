<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DIAMOND MARKET PRICE | „ÉÄ„Ç§„É§Áõ∏Â†¥Ê§úÁ¥¢</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&family=Noto+Sans+JP:wght@300;400;700&display=swap" rel="stylesheet">
<style>
/* =======================
   Variables & Base
======================= */
:root {
  --primary-gold: #bfa14a;
  --dark-gold: #8e7a38;
  --bg-sand: #f9f8f6;
  --navy: #1a2a3a;
  --text-main: #333;
  --white: #ffffff;
}

body {
  margin: 0; padding: 0;
  font-family: 'Noto Sans JP', sans-serif;
  background-color: var(--bg-sand);
  color: var(--text-main);
  line-height: 1.6;
}

/* =======================
   Header & Notice
======================= */
header {
  background: var(--navy);
  color: #fff;
  padding: 25px 0;
  text-align: center;
  border-bottom: 3px solid var(--primary-gold);
}

header h1 {
  font-family: 'Cinzel', serif;
  font-size: 1.4rem;
  letter-spacing: 4px;
  margin: 0;
}

.notice {
  background: #fff;
  border-bottom: 1px solid #eee;
  padding: 12px 15px;
  font-size: 0.8rem;
  text-align: center;
  color: #666;
}

.notice a { color: var(--dark-gold); font-weight: bold; text-decoration: underline; }

/* =======================
   Container & Components
======================= */
.container {
  max-width: 800px;
  margin: 20px auto;
  padding: 0 15px 120px; /* „Çµ„Éû„É™„Éº„Éú„ÉÉ„ÇØ„ÇπÁî®„ÅÆ‰ΩôÁôΩ */
}

.card {
  background: var(--white);
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.05);
  margin-bottom: 20px;
  border: 1px solid #eee;
}

h2 {
  font-size: 1rem;
  font-weight: 700;
  color: var(--navy);
  border-left: 4px solid var(--primary-gold);
  padding-left: 12px;
  margin-top: 0;
  margin-bottom: 20px;
  letter-spacing: 1px;
}

/* =======================
   Form Elements
======================= */
.form-group {
  margin-bottom: 18px;
}

.form-label {
  display: block;
  font-size: 0.85rem;
  font-weight: 700;
  margin-bottom: 8px;
  color: #555;
}

.flex-row {
  display: flex;
  gap: 10px;
  align-items: center;
}

input[type="text"], input[type="number"], select {
  width: 100%;
  padding: 12px;
  border: 1px solid #ddd;
  border-radius: 8px;
  font-size: 1rem;
  background: #fafafa;
  transition: 0.3s;
}

input:focus, select:focus {
  border-color: var(--primary-gold);
  outline: none;
  background: #fff;
}

/* Button Group (Tabs) */
.btn-group {
  display: flex;
  background: #f0f0f0;
  padding: 4px;
  border-radius: 10px;
  margin-bottom: 12px;
}

.btn-group button {
  flex: 1;
  border: none;
  padding: 10px;
  border-radius: 8px;
  background: none;
  font-size: 0.8rem;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s;
}

.btn-group button.active {
  background: var(--white);
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  color: var(--dark-gold);
}

/* Action Buttons */
.action-buttons {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 12px;
  margin-top: 30px;
}

#searchButton {
  background: linear-gradient(135deg, var(--primary-gold), var(--dark-gold));
  color: white;
  border: none;
  padding: 16px;
  border-radius: 30px;
  font-weight: bold;
  font-size: 1.1rem;
  cursor: pointer;
  box-shadow: 0 4px 15px rgba(191, 161, 74, 0.4);
}

#clearButton {
  background: #eee;
  color: #666;
  border: none;
  border-radius: 30px;
  cursor: pointer;
}

/* =======================
   Summary Box (Floating on Mobile)
======================= */
.summary-box {
  position: sticky;
  bottom: 20px;
  background: var(--navy);
  color: white;
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 -10px 30px rgba(0,0,0,0.2);
  z-index: 100;
  border: 1px solid rgba(255,255,255,0.1);
}

.summary-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 15px;
}

.summary-item {
  border-bottom: 1px solid rgba(255,255,255,0.1);
  padding-bottom: 8px;
}

.summary-label { font-size: 0.65rem; color: #aaa; display: block; text-transform: uppercase; }
.summary-value { font-size: 1rem; font-weight: 700; }
.summary-value strong { color: var(--primary-gold); font-size: 1.2rem; }

#rateSelect {
  background: #333;
  color: white;
  padding: 4px 8px;
  border: none;
  border-radius: 4px;
  width: auto;
  font-size: 0.8rem;
}

.total-price-area {
  grid-column: span 2;
  background: rgba(191, 161, 74, 0.15);
  padding: 12px;
  border-radius: 10px;
  text-align: center;
  border: 1px solid var(--primary-gold);
}

/* =======================
   Table Styles
======================= */
.table-wrapper {
  overflow-x: auto;
  margin-top: 10px;
}

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.85rem;
}

th {
  background: #f8f8f8;
  padding: 12px 8px;
  text-align: center;
  border-bottom: 2px solid var(--primary-gold);
  white-space: nowrap;
}

td {
  padding: 12px 8px;
  border-bottom: 1px solid #eee;
  text-align: center;
}

.price-cell { font-weight: bold; color: var(--dark-gold); }

/* Mobile Specific */
@media (max-width: 600px) {
  #resultTable {
    min-width: 800px;
  }
  .action-buttons {
    grid-template-columns: 1fr;
  }
}
</style>
</head>
<body>

<header>
  <h1>DIAMOND MARKET</h1>
</header>

<div class="notice">
  üì¢ <strong>Êõ¥Êñ∞ÊÉÖÂ†±:</strong> 2026.02.20 <a href="data/NJ_20260211.pdf">NJÂ§ß‰ºö 2ÊúàÂâçÂçäÂàÜ</a>„ÇíËøΩÂä†
</div>

<div class="container">
  
  <div class="card">
    <h2>SPECIFICATIONS</h2>

    <div class="form-group">
      <label class="form-label">CARAT (ct)</label>
      <div class="flex-row">
        <div style="display:flex; align-items:center; gap:5px; flex:1;">
          <select id="spinInt" style="width:70px;"></select>
          <span>.</span>
          <select id="spinDec" style="width:70px;"></select>
        </div>
        <button type="button" id="setCarat" style="background:var(--primary-gold); color:white; border:none; padding:10px 15px; border-radius:8px; font-weight:bold;">„Çª„ÉÉ„Éà</button>
      </div>
      <div class="flex-row" style="margin-top:10px;">
        <input type="text" id="minCarat" placeholder="ÊúÄÂ∞è" inputmode="decimal">
        <span>ÔΩû</span>
        <input type="text" id="maxCarat" placeholder="ÊúÄÂ§ß" inputmode="decimal">
        <input type="hidden" id="mainCarat">
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">DATE (‰ª•Èôç)</label>
      <select id="dateSelect"><option value="">„Åô„Åπ„Å¶</option></select>
    </div>

    <div class="form-group">
      <label class="form-label">COLOR</label>
      <div class="btn-group">
        <button type="button" class="colorTypeBtn" data-type="alpha">AtoZ</button>
        <button type="button" class="colorTypeBtn" data-type="fancy">FANCY</button>
        <button type="button" class="colorTypeBtn active" data-type="all">„Åô„Åπ„Å¶</button>
      </div>
      
      <div id="alphaFields" class="flex-row" style="display:none;">
        <select id="fromColor"><option value="">From</option></select>
        <span>ÔΩû</span>
        <select id="toColor"><option value="">To</option></select>
      </div>
      <div id="fancyFields" class="flex-row" style="display:none;">
        <select id="fancyGradeSelect"><option value="">Grade</option></select>
        <select id="fancyToneSelect"><option value="">Tone</option></select>
      </div>
      <div style="margin-top:10px; font-size:0.85rem;">
        <label><input type="checkbox" id="treatedCheck"> TREATED</label>
        <label style="margin-left:15px;"><input type="checkbox" id="faintCheck"> FAINT</label>
      </div>
    </div>

    <div class="form-group">
      <div class="flex-row">
        <div style="flex:1">
          <label class="form-label">CLARITY</label>
          <select id="minClaritySelect"><option value="">„Åô„Åπ„Å¶</option></select>
        </div>
        <div style="flex:1">
          <label class="form-label">CUT</label>
          <select id="minCutSelect"><option value="">„Åô„Åπ„Å¶</option></select>
        </div>
      </div>
      <div style="margin-top:8px;">
        <label style="font-size:0.85rem;"><input type="checkbox" id="hcCheck"> H&C (Heart & Cupid)</label>
      </div>
      <input type="hidden" id="maxClaritySelect">
      <input type="hidden" id="maxCutSelect">
    </div>

    <div class="form-group">
      <div class="flex-row">
        <div style="flex:1">
          <label class="form-label">FLUORESCENCE</label>
          <select id="fluorescenceSelect"><option value="">„Åô„Åπ„Å¶</option></select>
        </div>
        <div style="flex:1">
          <label class="form-label">SHAPE</label>
          <select id="shapeSelect"><option value="">„Åô„Åπ„Å¶</option></select>
        </div>
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">FREE WORD</label>
      <input type="text" id="keyword" placeholder="‰æã: D VS1 EX">
    </div>

    <div class="action-buttons">
      <button id="searchButton">Áõ∏Â†¥„ÇíÊ§úÁ¥¢„Åô„Çã</button>
      <button id="clearButton">„É™„Çª„ÉÉ„Éà</button>
    </div>
  </div>

  <div id="loadingSpinner" style="display:none; text-align:center; padding:20px;">
    <div style="width:30px; height:30px; border:3px solid #ddd; border-top-color:var(--primary-gold); border-radius:50%; animation:spin 1s linear infinite; margin:auto;"></div>
  </div>

  <div class="table-wrapper card">
    <div id="resultCountTop" style="font-size:0.8rem; margin-bottom:10px; color:#666; font-weight:bold;"></div>
    <table id="resultTable">
      <thead>
        <tr>
          <th>Êó•‰ªò</th>
          <th>„Ç´„É©„Éº</th>
          <th>„ÇØ„É©„É™„ÉÜ„Ç£</th>
          <th>„Ç´„ÉÉ„Éà</th>
          <th>ËõçÂÖâÊÄß</th>
          <th>ÂΩ¢Áä∂</th>
          <th>ct</th>
          <th>„Ç¨„Ç§Âçò‰æ°</th>
          <th>Ë©≥Á¥∞</th>
        </tr>
      </thead>
      <tbody id="resultBody"></tbody>
    </table>
    <div id="paginationArea" style="margin-top:20px; text-align:center;"></div>
  </div>

  <div id="summaryBox" class="summary-box">
    <div class="summary-grid">
      <div class="summary-item">
        <span class="summary-label">Count</span>
        <span class="summary-value"><span id="summaryCount">0</span> ‰ª∂</span>
      </div>
      <div class="summary-item">
        <span class="summary-label">Avg. Price („Ç¨„Ç§)</span>
        <span class="summary-value"><span id="summaryAvgPrice">0</span> ÂÜÜ</span>
      </div>
      <div class="summary-item">
        <span class="summary-label">Rate Setting</span>
        <select id="rateSelect">
          <option value="0.5">5Êéõ„Åë</option>
          <option value="0.6">6Êéõ„Åë</option>
          <option value="0.7">7Êéõ„Åë</option>
          <option value="0.8" selected>8Êéõ„Åë</option>
          <option value="0.9">9Êéõ„Åë</option>
          <option value="1.0">10Êéõ„Åë</option>
        </select>
      </div>
      <div class="summary-item">
        <span class="summary-label">Valuation („Ç¨„Ç§)</span>
        <span class="summary-value" id="summaryUnitPrice">0 ÂÜÜ</span>
      </div>
      <div class="total-price-area">
        <span class="summary-label" style="color:var(--primary-gold);">Estimated Purchase Price</span>
        <div class="summary-value">¬• <strong id="summaryTotalPrice">0</strong></div>
        <div style="font-size: 0.6rem; color: #aaa; margin-top: 4px;">Carat: <span id="summaryCarat">0.000</span> ct</div>
      </div>
    </div>
  </div>

</div>

<script>
  // --- ÂÖ±ÈÄöÂÆöÁæ©„Éª„Éû„ÉÉ„Éî„É≥„Ç∞ (ÂÖÉ„ÅÆ„É≠„Ç∏„ÉÉ„ÇØ„ÇíÁ∂ôÊâø) ---
  const ALPHA_COLOR_ZONES = [
    { label: "D", key: "D" }, { label: "E", key: "E" }, { label: "F", key: "F" },
    { label: "G", key: "G" }, { label: "H", key: "H" }, { label: "I", key: "I" },
    { label: "J", key: "J" }, { label: "K", key: "K" }, { label: "L", key: "L" },
    { label: "M", key: "M" }, { label: "N", key: "N" },
    { label: "UNDER N", key: "UNDER_N" }, { label: "UNDER S", key: "UNDER_S" },
    { label: "OÔΩûT", key: "O_T" }, { label: "UÔΩûZ", key: "U_Z" }
  ];
  const CUT_ORDER = ["EX","VG","GD","FR","PR"];
  const CLARITY_ORDER = ["FL","IF","VVS1","VVS2","VS1","VS2","SI1","SI2","I1","I2","I3"];
  const caratThresholds = [0,0.1,0.2,0.25,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1,1.5,2,3,5];
  const fancyGrades = ["FAINT","VERY LIGHT","LIGHT","FANCY LIGHT","FANCY","FANCY INTENSE","FANCY VIVID","FANCY DEEP","FANCY DARK"];
  const fancyTones = ["YELLOW","PINK","BLUE","GREEN","BROWN","ORANGE","PURPLE","RED","GRAY","BLACK"];
  const shapeMap = { RD:"„É©„Ç¶„É≥„Éâ", PS:"„Éö„Ç¢", HS:"„Éè„Éº„Éà", OV:"„Ç™„Éº„Éê„É´", EM:"„Ç®„É°„É©„É´„Éâ", MQ:"„Éû„Éº„Ç≠„Çπ", PRI:"„Éó„É™„É≥„Çª„Çπ", CUS:"„ÇØ„ÉÉ„Ç∑„Éß„É≥" };

  let diamondData = [];

  // --- UIÂà∂Âæ° ---
  const colorBtns = document.querySelectorAll('.colorTypeBtn');
  colorBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      colorBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const type = btn.dataset.type;
      document.getElementById('alphaFields').style.display = type === 'alpha' ? 'flex' : 'none';
      document.getElementById('fancyFields').style.display = type === 'fancy' ? 'flex' : 'none';
      document.getElementById('treatedCheck').parentElement.style.display = (type === 'fancy' || type === 'all') ? 'inline' : 'none';
      document.getElementById('faintCheck').parentElement.style.display = (type === 'alpha' || type === 'all') ? 'inline' : 'none';
    });
  });

  // --- „Éá„Éº„ÇøÂèñÂæó„Éª„Éï„Ç£„É´„ÇøÂàùÊúüÂåñ ---
  async function init() {
    try {
      const resp = await fetch("https://raw.githubusercontent.com/sgc-gold/sgc/main/data/diamonds.json");
      diamondData = await resp.json();

      const sets = { dates:new Set(), clarities:new Set(), cuts:new Set(), fluos:new Set(), shapes:new Set() };
      diamondData.forEach(d => {
        if(d.date) sets.dates.add(d.date.split(" ")[0]);
        if(d.clarity) sets.clarities.add(d.clarity);
        if(d.cut) sets.cuts.add(d.cut);
        if(d.fluorescence) sets.fluos.add(d.fluorescence);
        if(d.shape) sets.shapes.add(d.shape);
      });

      const addOpt = (id, val, text) => document.getElementById(id).appendChild(new Option(text || val, val));
      
      Array.from(sets.dates).sort((a,b)=>new Date(b)-new Date(a)).forEach(d => addOpt("dateSelect", d));
      document.getElementById("dateSelect").selectedIndex = 1;

      ALPHA_COLOR_ZONES.forEach(z => { addOpt("fromColor", z.key, z.label); addOpt("toColor", z.key, z.label); });
      fancyGrades.forEach(g => addOpt("fancyGradeSelect", g));
      fancyTones.forEach(t => addOpt("fancyToneSelect", t));
      CLARITY_ORDER.forEach(c => addOpt("minClaritySelect", c));
      CUT_ORDER.forEach(c => addOpt("minCutSelect", c));
      Array.from(sets.fluos).sort().forEach(f => addOpt("fluorescenceSelect", f));
      
      addOpt("shapeSelect", "RD", "„É©„Ç¶„É≥„Éâ„Éñ„É™„É™„Ç¢„É≥„Éà");
      addOpt("shapeSelect", "NON_ROUND", "„É©„Ç¶„É≥„Éâ‰ª•Â§ñ");
      Array.from(sets.shapes).sort().filter(s=>s!=="RD").forEach(s => addOpt("shapeSelect", s, `‚Ü≥ ${shapeMap[s] || s}`));

    } catch(e) { console.error("Data load error", e); }
  }

  // --- Ê§úÁ¥¢„É≠„Ç∏„ÉÉ„ÇØ ---
  document.getElementById("searchButton").addEventListener("click", () => {
    const spinner = document.getElementById("loadingSpinner");
    spinner.style.display = "block";

    setTimeout(() => {
      const minC = parseFloat(document.getElementById("minCarat").value) || 0;
      const maxC = parseFloat(document.getElementById("maxCarat").value) || 999;
      const activeType = document.querySelector('.colorTypeBtn.active').dataset.type;
      const keyword = document.getElementById("keyword").value.toLowerCase();

      const results = diamondData.filter(d => {
        const c = parseFloat(d.carat) || 0;
        if(c < minC || c > maxC) return false;
        
        if(activeType === 'alpha' && d.colorType !== 'ALPHA') return false;
        if(activeType === 'fancy' && d.colorType !== 'FANCY') return false;

        const dateVal = document.getElementById("dateSelect").value;
        if(dateVal && d.date.split(" ")[0] < dateVal) return false;

        const shapeVal = document.getElementById("shapeSelect").value;
        if(shapeVal === "NON_ROUND" && d.shape === "RD") return false;
        if(shapeVal && shapeVal !== "NON_ROUND" && d.shape !== shapeVal) return false;

        const minClarity = document.getElementById("minClaritySelect").value;
        if(minClarity && CLARITY_ORDER.indexOf(d.clarity) > CLARITY_ORDER.indexOf(minClarity)) return false;

        const minCut = document.getElementById("minCutSelect").value;
        if(minCut && (!d.cut || !d.cut.includes(minCut))) return false;

        if(document.getElementById("hcCheck").checked && (!d.cut || !d.cut.includes("H&C"))) return false;

        if(keyword) {
          const text = `${d.color} ${d.clarity} ${d.cut} ${d.notes}`.toLowerCase();
          if(!keyword.split(" ").every(k => text.includes(k))) return false;
        }

        return true;
      });

      renderResults(results);
      window.lastSearchResults = results;
      updateSummary(results);
      spinner.style.display = "none";
    }, 100);
  });

  function renderResults(results) {
    const tbody = document.getElementById("resultBody");
    tbody.innerHTML = "";
    document.getElementById("resultCountTop").innerHTML = `üîπ Ê§úÁ¥¢ÁµêÊûú: ${results.length.toLocaleString()} ‰ª∂`;

    results.slice(0, 100).forEach(d => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${d.date.split(" ")[0]}</td>
        <td>${d.color}</td>
        <td>${d.clarity}</td>
        <td>${d.cut || "-"}</td>
        <td>${d.fluorescence}</td>
        <td>${d.shape}</td>
        <td>${parseFloat(d.carat).toFixed(3)}</td>
        <td class="price-cell">${Math.floor(d.pricePerCarat).toLocaleString()}</td>
        <td><button onclick="alert('${d.notes || "ÂÇôËÄÉ„Å™„Åó"}')" style="padding:4px 8px; font-size:0.7rem;">Ë©≥Á¥∞</button></td>
      `;
      tbody.appendChild(row);
    });
  }

  function updateSummary(results) {
    const count = results.length;
    const avg = count > 0 ? Math.round(results.reduce((s, d) => s + (parseFloat(d.pricePerCarat) || 0), 0) / count) : 0;
    const rate = parseFloat(document.getElementById("rateSelect").value);
    const unitPrice = Math.round(avg * rate);
    const carat = parseFloat(document.getElementById("mainCarat").value) || 0;

    document.getElementById("summaryCount").textContent = count.toLocaleString();
    document.getElementById("summaryAvgPrice").textContent = avg.toLocaleString();
    document.getElementById("summaryUnitPrice").textContent = unitPrice.toLocaleString();
    document.getElementById("summaryCarat").textContent = carat.toFixed(3);
    document.getElementById("summaryTotalPrice").textContent = Math.floor(unitPrice * carat).toLocaleString();
  }

  // --- „Ç´„É©„ÉÉ„Éà„Çπ„Éî„É≥„ÉªË£úÂä©Ê©üËÉΩ ---
  (function(){
    const si = document.getElementById("spinInt");
    const sd = document.getElementById("spinDec");
    const mc = document.getElementById("mainCarat");
    for(let i=0; i<=5; i++) si.appendChild(new Option(i, i));
    for(let i=0; i<=99; i++) sd.appendChild(new Option(i.toString().padStart(2,'0'), i.toString().padStart(2,'0')));
    si.value = "0"; sd.value = "50"; mc.value = "0.50";
    
    const sync = () => mc.value = `${si.value}.${sd.value}`;
    si.onchange = sync; sd.onchange = sync;

    document.getElementById("setCarat").onclick = () => {
      const c = parseFloat(mc.value);
      for(let i=0; i<caratThresholds.length-1; i++){
        if(c >= caratThresholds[i] && c < caratThresholds[i+1]){
          document.getElementById("minCarat").value = caratThresholds[i].toFixed(3);
          document.getElementById("maxCarat").value = (caratThresholds[i+1]-0.001).toFixed(3);
          break;
        }
      }
    };

    document.getElementById("clearButton").onclick = () => location.reload();
    document.getElementById("rateSelect").onchange = () => updateSummary(window.lastSearchResults || []);
  })();

  init();
</script>

<style>
  @keyframes spin { to { transform: rotate(360deg); } }
</style>
</body>
</html>