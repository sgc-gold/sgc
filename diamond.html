<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒ€ã‚¤ãƒ¤ç›¸å ´æ¤œç´¢</title>
<link href="https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@400;600;700&family=Cormorant+Garamond:ital,wght@0,400;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
/* â”€â”€ Reset â”€â”€ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

/* â”€â”€ Variables â”€â”€ */
:root {
  --green:     #1A3628;
  --green-lt:  #254D38;
  --green-dk:  #0E1F17;
  --gold:      #C09A50;
  --gold-lt:   #E8D49A;
  --gold-dk:   #8A6A28;
  --cream:     #F7F3EB;
  --cream-dk:  #EDE6D8;
  --white:     #FFFFFF;
  --ink:       #1C1A16;
  --ink-soft:  #5A5448;
  --border:    rgba(192,154,80,0.18);
  --border-ui: #D8D2C8;
  --shadow:    0 4px 24px rgba(28,26,22,0.09);
  --radius:    10px;
  --focus:     rgba(192,154,80,0.35);
  --up:        #B52929;
  --dn:        #1A5A9A;
}

/* â”€â”€ Base â”€â”€ */
html { background: var(--cream); height: 100%; }
body {
  font-family: 'DM Sans', sans-serif;
  background: var(--cream);
  color: var(--ink);
  overflow-y: auto;
  overflow-x: hidden;
  font-size: 13px;
  line-height: 1.6;
  padding-bottom: 60px;
}

/* Grain overlay */
body::before {
  content: ''; position: fixed; inset: 0;
  pointer-events: none; z-index: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
  opacity: 0.4;
}

/* â”€â”€ Page Header â”€â”€ */
.page-header {
  position: relative; z-index: 1;
  background: var(--green-dk);
  padding: 24px 24px 20px;
  border-bottom: 1px solid rgba(192,154,80,0.15);
}
.page-header::after {
  content: ''; position: absolute;
  bottom: -1px; left: 0; right: 0; height: 1px;
  background: linear-gradient(90deg, transparent, var(--gold-dk) 20%, var(--gold) 50%, var(--gold-dk) 80%, transparent);
}
.page-header-inner {
  display: flex; align-items: center; justify-content: space-between; gap: 12px;
}
.page-header-left { display: flex; align-items: center; gap: 12px; }
.page-header-icon {
  width: 40px; height: 40px;
  background: rgba(192,154,80,0.12);
  border: 1px solid rgba(192,154,80,0.25);
  border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.1rem;
  flex-shrink: 0;
}
.page-header-title {
  font-family: 'Shippori Mincho', serif;
  font-size: clamp(1rem, 3vw, 1.4rem);
  font-weight: 700;
  color: var(--white);
  letter-spacing: 0.08em;
  line-height: 1.2;
}
.page-header-title span {
  display: block;
  font-family: 'Cormorant Garamond', serif;
  font-style: italic;
  font-weight: 400;
  font-size: 0.68rem;
  color: var(--gold);
  letter-spacing: 0.22em;
  margin-top: 3px;
}
.page-header-badge {
  font-size: 0.6rem;
  font-weight: 600;
  letter-spacing: 0.1em;
  background: rgba(192,154,80,0.12);
  border: 1px solid rgba(192,154,80,0.25);
  color: rgba(232,212,154,0.7);
  padding: 4px 10px;
  border-radius: 100px;
  white-space: nowrap;
}

/* Notice bar */
.notice-bar {
  position: relative; z-index: 1;
  background: rgba(192,154,80,0.08);
  border-bottom: 1px solid rgba(192,154,80,0.15);
  padding: 8px 20px;
  display: flex; align-items: center; gap: 8px;
  font-size: 0.75rem;
  color: var(--gold-dk);
}
.notice-bar svg { flex-shrink: 0; opacity: 0.7; }

/* â”€â”€ Page wrap â”€â”€ */
.page-wrap {
  position: relative; z-index: 1;
  max-width: 1100px;
  margin: 0 auto;
  padding: 18px 16px 0;
}

/* â”€â”€ Panel (card) â”€â”€ */
.panel {
  background: var(--white);
  border: 1px solid var(--border);
  border-radius: 14px;
  box-shadow: var(--shadow);
  margin-bottom: 14px;
  overflow: hidden;
}
.panel-header {
  display: flex; align-items: center; gap: 8px;
  padding: 12px 18px;
  background: linear-gradient(135deg, rgba(247,243,235,0.9) 0%, var(--white) 100%);
  border-bottom: 1px solid rgba(192,154,80,0.12);
}
.panel-header-dot {
  width: 4px; height: 16px;
  background: var(--gold);
  border-radius: 2px;
  flex-shrink: 0;
}
.panel-title {
  font-family: 'Shippori Mincho', serif;
  font-size: 0.82rem;
  font-weight: 600;
  color: var(--ink);
  letter-spacing: 0.08em;
}
.panel-body { padding: 16px 18px; }

/* â”€â”€ Form grid â”€â”€ */
.form-grid {
  display: grid;
  grid-template-columns: 100px 1fr;
  row-gap: 9px;
  column-gap: 0;
  align-items: center;
}
.form-label {
  font-size: 0.71rem;
  font-weight: 500;
  color: var(--ink-soft);
  text-align: right;
  padding-right: 14px;
  white-space: nowrap;
  line-height: 1.4;
  letter-spacing: 0.02em;
}
.form-control {
  display: flex;
  align-items: center;
  gap: 6px;
  flex-wrap: wrap;
}
.form-divider {
  grid-column: 1 / -1;
  height: 1px;
  background: rgba(192,154,80,0.1);
  margin: 3px 0;
}

/* â”€â”€ Inputs & Selects â”€â”€ */
input[type="text"],
select {
  background: var(--cream);
  border: 1px solid var(--border-ui);
  border-radius: 8px;
  color: var(--ink);
  font-family: 'DM Sans', sans-serif;
  font-size: 0.82rem;
  padding: 6px 10px;
  height: 32px;
  outline: none;
  transition: border-color 0.16s, box-shadow 0.16s;
  appearance: none;
  -webkit-appearance: none;
}
input[type="text"]::placeholder { color: rgba(90,84,72,0.4); }
input[type="text"]:focus,
select:focus {
  border-color: var(--gold);
  box-shadow: 0 0 0 3px var(--focus);
  background: var(--white);
}
select {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%238A6A28'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 9px center;
  padding-right: 26px;
  cursor: pointer;
}
.range-sep {
  font-size: 0.75rem;
  color: var(--ink-soft);
  flex-shrink: 0;
}
.field-hint {
  font-size: 0.68rem;
  color: rgba(90,84,72,0.55);
  letter-spacing: 0.02em;
}

#mainCarat { width: 90px; text-align: center; }
#minCarat, #maxCarat { width: 76px; text-align: center; }

/* â”€â”€ Color toggle â”€â”€ */
.color-toggle {
  display: inline-flex;
  border: 1px solid var(--border-ui);
  border-radius: 8px;
  overflow: hidden;
  margin-bottom: 8px;
}
.ctog-btn {
  background: var(--cream);
  border: none;
  border-right: 1px solid var(--border-ui);
  color: var(--ink-soft);
  font-family: 'DM Sans', sans-serif;
  font-size: 0.72rem;
  font-weight: 400;
  padding: 5px 14px;
  cursor: pointer;
  transition: background 0.14s, color 0.14s;
  outline: none;
  height: 28px;
}
.ctog-btn:last-child { border-right: none; }
.ctog-btn:hover { background: var(--cream-dk); color: var(--ink); }
.ctog-btn.active {
  background: var(--green);
  color: var(--white);
}
.color-forms-wrap { display: flex; flex-direction: column; gap: 5px; }
.alpha-form, .fancy-form {
  display: flex; align-items: center; gap: 6px; flex-wrap: wrap;
}

/* â”€â”€ Checkboxes â”€â”€ */
.check-label {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  font-size: 0.72rem;
  color: var(--ink-soft);
  cursor: pointer;
  user-select: none;
  padding: 3px 10px;
  border: 1px solid var(--border-ui);
  border-radius: 100px;
  background: var(--cream);
  height: 28px;
  transition: all 0.14s;
  white-space: nowrap;
}
.check-label:hover { border-color: var(--gold); color: var(--gold-dk); }
.check-label input[type="checkbox"] {
  width: 12px; height: 12px;
  accent-color: var(--gold-dk);
  cursor: pointer; flex-shrink: 0;
}

/* â”€â”€ Buttons â”€â”€ */
.btn {
  border: none;
  border-radius: 9px;
  cursor: pointer;
  font-family: 'DM Sans', sans-serif;
  font-size: 0.82rem;
  font-weight: 500;
  padding: 6px 16px;
  height: 32px;
  transition: opacity 0.14s, transform 0.1s, box-shadow 0.14s;
  display: inline-flex; align-items: center; gap: 5px;
  white-space: nowrap;
  outline: none;
}
.btn:active { transform: scale(0.96); }
.btn-primary {
  background: linear-gradient(135deg, var(--green) 0%, var(--green-lt) 100%);
  color: var(--white);
  box-shadow: 0 2px 8px rgba(14,31,23,0.25);
}
.btn-primary:hover { opacity: 0.88; }
.btn-secondary {
  background: var(--cream-dk);
  color: var(--ink-soft);
  border: 1px solid var(--border-ui);
}
.btn-secondary:hover { background: #ddd7ca; color: var(--ink); }
.btn-sm { font-size: 0.72rem; padding: 4px 12px; height: 28px; }

.action-row {
  display: flex; justify-content: center; gap: 10px;
  padding-top: 14px;
  border-top: 1px solid rgba(192,154,80,0.1);
  margin-top: 12px;
}
.btn-search { min-width: 130px; height: 38px; font-size: 0.9rem; letter-spacing: 0.06em; }

/* â”€â”€ Loading â”€â”€ */
.loading-wrap {
  display: none;
  justify-content: center; align-items: center; gap: 10px;
  padding: 20px;
}
@keyframes spin { to { transform: rotate(360deg); } }
.spinner {
  width: 20px; height: 20px;
  border: 2px solid var(--border-ui);
  border-top-color: var(--gold);
  border-radius: 50%;
  animation: spin 0.7s linear infinite;
}
.loading-text { font-size: 0.8rem; color: var(--ink-soft); }

/* â”€â”€ Summary card â”€â”€ */
.summary-panel {
  background: var(--white);
  border: 1px solid var(--border);
  border-radius: 14px;
  box-shadow: var(--shadow);
  overflow: hidden;
  margin-bottom: 14px;
  max-width: 480px;
  margin-left: auto;
  margin-right: auto;
}
.summary-panel::before {
  content: ''; display: block; height: 3px;
  background: linear-gradient(90deg, var(--gold-dk), var(--gold-lt), var(--gold));
}
.summary-header {
  padding: 12px 18px;
  background: linear-gradient(135deg, rgba(247,243,235,0.9) 0%, var(--white) 100%);
  border-bottom: 1px solid rgba(192,154,80,0.12);
  display: flex; align-items: center; gap: 8px;
}
.summary-header-icon { font-size: 0.9rem; }
.summary-header-title {
  font-family: 'Shippori Mincho', serif;
  font-size: 0.82rem;
  font-weight: 600;
  color: var(--ink);
  letter-spacing: 0.08em;
}
.summary-rows { padding: 4px 0; }
.summary-row {
  display: flex; justify-content: space-between; align-items: center;
  padding: 8px 18px;
  border-bottom: 1px solid rgba(192,154,80,0.07);
  font-size: 0.82rem;
}
.summary-row:last-child { border-bottom: none; }
.summary-row.total {
  background: linear-gradient(135deg, rgba(26,54,40,0.04) 0%, rgba(192,154,80,0.05) 100%);
  border-top: 1px solid rgba(192,154,80,0.15);
}
.s-label { color: var(--ink-soft); }
.summary-row.total .s-label { color: var(--green); font-weight: 600; font-family: 'Shippori Mincho', serif; font-size: 0.88rem; }
.s-value { font-weight: 500; color: var(--ink); }
.s-value strong { font-size: 1.05rem; }
.summary-row.total .s-value strong { font-size: 1.3rem; color: var(--green); }
.s-unit { font-size: 0.68rem; color: var(--ink-soft); margin-left: 3px; }
#rateSelect {
  height: 26px; font-size: 0.72rem;
  padding: 0 22px 0 8px; border-color: var(--border-ui);
}

/* â”€â”€ Results â”€â”€ */
.result-bar {
  display: flex; align-items: center; justify-content: space-between;
  padding: 8px 2px 6px;
}
.result-count { font-size: 0.78rem; color: var(--ink-soft); }
.result-count strong { color: var(--green); font-size: 0.95rem; }
.sort-hint { font-size: 0.68rem; color: rgba(90,84,72,0.5); letter-spacing: 0.03em; }

/* Table */
.table-wrapper {
  background: var(--white);
  border: 1px solid var(--border);
  border-radius: 12px;
  box-shadow: var(--shadow);
  overflow: hidden;
  overflow-x: auto;
}
.table-wrapper::-webkit-scrollbar { height: 5px; }
.table-wrapper::-webkit-scrollbar-track { background: var(--cream); }
.table-wrapper::-webkit-scrollbar-thumb { background: var(--border-ui); border-radius: 3px; }

#resultTable {
  width: 100%;
  border-collapse: collapse;
  display: none;
  min-width: 760px;
  font-size: 0.78rem;
}
#resultTable thead th {
  background: var(--green-dk);
  color: rgba(255,255,255,0.7);
  font-size: 0.65rem;
  font-weight: 500;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  padding: 10px 10px;
  text-align: center;
  white-space: nowrap;
  cursor: pointer;
  user-select: none;
  transition: background 0.12s, color 0.12s;
  position: sticky; top: 0; z-index: 2;
  border-right: 1px solid rgba(255,255,255,0.05);
}
#resultTable thead th:hover { background: var(--green-lt); color: var(--white); }
#resultTable thead th:first-child { border-radius: 0; }
#resultTable thead th:last-child { cursor: default; border-right: none; }
#resultTable thead th:last-child:hover { background: var(--green-dk); color: rgba(255,255,255,0.7); }

#resultTable tbody tr { border-bottom: 1px solid rgba(192,154,80,0.08); }
#resultTable tbody tr:nth-child(4n+3),
#resultTable tbody tr:nth-child(4n+4) { background: rgba(247,243,235,0.5); }
#resultTable tbody tr:hover { background: rgba(192,154,80,0.06); }
#resultTable tbody td {
  padding: 8px 10px;
  text-align: center;
  color: var(--ink);
  white-space: nowrap;
}
#resultTable tbody td.priceCell {
  text-align: right;
  font-feature-settings: "tnum";
  color: var(--ink-soft);
  font-weight: 500;
}

/* detail row */
.detailsRow { display: none; background: rgba(247,243,235,0.8) !important; }
.detailsRow td {
  font-size: 0.72rem !important;
  color: var(--ink-soft) !important;
  text-align: left !important;
  padding: 7px 18px !important;
  white-space: normal !important;
  border-top: 1px dashed rgba(192,154,80,0.2) !important;
}
.detail-toggle {
  font-size: 0.68rem;
  color: var(--gold-dk);
  cursor: pointer;
  padding: 2px 9px;
  border: 1px solid rgba(192,154,80,0.3);
  border-radius: 100px;
  background: rgba(192,154,80,0.07);
  transition: background 0.12s;
  display: inline-block;
}
.detail-toggle:hover { background: rgba(192,154,80,0.15); }

/* Pagination */
.pagination-wrap {
  display: flex; justify-content: center; align-items: center; gap: 6px;
  padding: 14px 0 4px;
}
.pagination-wrap button {
  background: var(--white);
  border: 1px solid var(--border-ui);
  color: var(--ink-soft);
  font-family: 'DM Sans', sans-serif;
  font-size: 0.72rem;
  padding: 5px 14px;
  border-radius: 8px;
  cursor: pointer;
  transition: border-color 0.12s, color 0.12s;
}
.pagination-wrap button:hover:not(:disabled) { border-color: var(--gold); color: var(--gold-dk); }
.pagination-wrap button:disabled { opacity: 0.3; cursor: not-allowed; }
.pagination-wrap .page-info { font-size: 0.72rem; color: var(--ink-soft); padding: 0 8px; }

.count-bar {
  font-size: 0.72rem; color: var(--ink-soft);
  padding: 6px 0;
  border-top: 1px solid rgba(192,154,80,0.1);
}
.count-bar strong { color: var(--green); }

/* â”€â”€ Mobile â”€â”€ */
#caratSpinnerMobile { display: none; }

@media (max-width: 600px) {
  .page-wrap { padding: 12px 12px 0; }
  .panel-body { padding: 14px 14px; }
  .form-grid { grid-template-columns: 80px 1fr; row-gap: 8px; }
  .form-label { font-size: 0.68rem; padding-right: 10px; }
  #mainCarat { display: none; }
  #caratSpinnerMobile { display: flex; align-items: center; gap: 4px; }
  .spin { display: flex; align-items: center; gap: 3px; }
  .spin select {
    width: 46px; font-size: 0.82rem; padding: 5px 3px;
    -webkit-appearance: none; appearance: none; background-image: none;
    text-align: center; height: 32px;
  }
  .spin .dot { font-size: 1rem; font-weight: 700; color: var(--ink-soft); }
  .summary-panel { max-width: 100%; }
}
</style>
</head>
<body>

<!-- â”€â”€â”€ Page Header â”€â”€â”€ -->
<div class="page-header">
  <div class="page-header-inner">
    <div class="page-header-left">
      <div class="page-header-icon">ğŸ’</div>
      <div class="page-header-title">
        ãƒ€ã‚¤ãƒ¤ç›¸å ´æ¤œç´¢
        <span>Diamond Market Reference System</span>
      </div>
    </div>
    <div class="page-header-badge">INTERNAL USE</div>
  </div>
</div>

<!-- Notice -->
<div class="notice-bar">
  <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
  <span><strong>æ›´æ–°æƒ…å ±</strong>ã€€2026å¹´02æœˆ20æ—¥ã€€NJå¤§ä¼š 2æœˆå‰åŠåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ </span>
</div>

<div class="page-wrap">

  <!-- â”€â”€â”€ Search Panel â”€â”€â”€ -->
  <div class="panel">
    <div class="panel-header">
      <div class="panel-header-dot"></div>
      <div class="panel-title">æ¤œç´¢æ¡ä»¶</div>
    </div>
    <div class="panel-body">
      <div class="form-grid">

        <!-- Carat -->
        <div class="form-label">ã‚«ãƒ©ãƒƒãƒˆï¼ˆctï¼‰</div>
        <div class="form-control">
          <div id="caratSetRow" style="display:flex;align-items:center;gap:6px;flex-wrap:wrap;">
            <input type="text" id="mainCarat" placeholder="ä¾‹: 0.345" inputmode="decimal" pattern="[0-9]*\.?[0-9]*">
            <div id="caratSpinnerMobile">
              <div class="spin">
                <select id="spinInt"></select>
                <span class="dot">.</span>
                <select id="spinDec"></select>
              </div>
            </div>
            <button class="btn btn-secondary btn-sm" id="setCarat">ç¯„å›²ã‚’ã‚»ãƒƒãƒˆ</button>
            <input type="text" id="minCarat" placeholder="æœ€å°" inputmode="decimal">
            <span class="range-sep">ã€œ</span>
            <input type="text" id="maxCarat" placeholder="æœ€å¤§" inputmode="decimal">
          </div>
        </div>

        <!-- Date -->
        <div class="form-label">é–‹å‚¬æ—¥</div>
        <div class="form-control">
          <select id="dateSelect" style="min-width:160px;"><option value="">ã™ã¹ã¦</option></select>
          <span class="field-hint">ä»¥é™ã§æ¤œç´¢</span>
        </div>

        <div class="form-divider"></div>

        <!-- Color -->
        <div class="form-label">ã‚«ãƒ©ãƒ¼</div>
        <div class="form-control" style="flex-direction:column;align-items:flex-start;">
          <div class="color-toggle">
            <button class="ctog-btn active" data-type="alpha">A to Z</button>
            <button class="ctog-btn" data-type="fancy">FANCY</button>
            <button class="ctog-btn" data-type="all">ã™ã¹ã¦</button>
          </div>
          <div class="color-forms-wrap">
            <div class="alpha-form">
              <select id="fromColor" style="min-width:86px;"><option value="">From</option></select>
              <span class="range-sep">ã€œ</span>
              <select id="toColor" style="min-width:86px;"><option value="">To</option></select>
              <label class="check-label">
                <input type="checkbox" id="faintCheck"> FAINT
              </label>
            </div>
            <div class="fancy-form" style="display:none;">
              <select id="fancyGradeSelect" style="min-width:140px;"><option value="">Grade: ã™ã¹ã¦</option></select>
              <select id="fancyToneSelect"  style="min-width:110px;"><option value="">Tone: ã™ã¹ã¦</option></select>
              <label class="check-label">
                <input type="checkbox" id="treatedCheck"> TREATED
              </label>
            </div>
          </div>
        </div>

        <!-- Clarity -->
        <div class="form-label">ã‚¯ãƒ©ãƒªãƒ†ã‚£</div>
        <div class="form-control">
          <select id="minClaritySelect" onchange="syncToValue('minClaritySelect','maxClaritySelect')" style="min-width:80px;">
            <option value="">ã™ã¹ã¦</option>
            <option value="FL">FL</option><option value="IF">IF</option>
            <option value="VVS1">VVS1</option><option value="VVS2">VVS2</option>
            <option value="VS1">VS1</option><option value="VS2">VS2</option>
            <option value="SI1">SI1</option><option value="SI2">SI2</option>
            <option value="I1">I1</option><option value="I2">I2</option><option value="I3">I3</option>
          </select>
          <span class="range-sep">ã€œ</span>
          <select id="maxClaritySelect" style="min-width:80px;">
            <option value="">ã™ã¹ã¦</option>
            <option value="FL">FL</option><option value="IF">IF</option>
            <option value="VVS1">VVS1</option><option value="VVS2">VVS2</option>
            <option value="VS1">VS1</option><option value="VS2">VS2</option>
            <option value="SI1">SI1</option><option value="SI2">SI2</option>
            <option value="I1">I1</option><option value="I2">I2</option><option value="I3">I3</option>
          </select>
        </div>

        <!-- Cut -->
        <div class="form-label">ã‚«ãƒƒãƒˆ</div>
        <div class="form-control">
          <select id="minCutSelect" onchange="syncToValue('minCutSelect','maxCutSelect')" style="min-width:108px;">
            <option value="">ã™ã¹ã¦</option>
            <option value="EX">EXCELLENT</option><option value="VG">VERY GOOD</option>
            <option value="GD">GOOD</option><option value="FR">FAIR</option><option value="PR">POOR</option>
          </select>
          <span class="range-sep">ã€œ</span>
          <select id="maxCutSelect" style="min-width:108px;">
            <option value="">ã™ã¹ã¦</option>
            <option value="EX">EXCELLENT</option><option value="VG">VERY GOOD</option>
            <option value="GD">GOOD</option><option value="FR">FAIR</option><option value="PR">POOR</option>
          </select>
          <label class="check-label">
            <input type="checkbox" id="hcCheck"> H&amp;C
          </label>
        </div>

        <!-- Fluorescence -->
        <div class="form-label">è›å…‰æ€§</div>
        <div class="form-control">
          <select id="minFluoSelect" onchange="syncToValue('minFluoSelect','maxFluoSelect')" style="min-width:78px;">
            <option value="">ã™ã¹ã¦</option>
            <option value="N">N</option><option value="F">F</option>
            <option value="MB">MB</option><option value="SB">SB</option><option value="VSB">VSB</option>
          </select>
          <span class="range-sep">ã€œ</span>
          <select id="maxFluoSelect" style="min-width:78px;">
            <option value="">ã™ã¹ã¦</option>
            <option value="N">N</option><option value="F">F</option>
            <option value="MB">MB</option><option value="SB">SB</option><option value="VSB">VSB</option>
          </select>
        </div>

        <!-- Shape -->
        <div class="form-label">å½¢çŠ¶</div>
        <div class="form-control">
          <select id="shapeSelect" style="min-width:200px;"><option value="">ã™ã¹ã¦</option></select>
        </div>

        <div class="form-divider"></div>

        <!-- Keyword -->
        <div class="form-label">ãƒ•ãƒªãƒ¼ãƒ¯ãƒ¼ãƒ‰</div>
        <div class="form-control">
          <input type="text" id="keyword" placeholder="ä¾‹: D VS1 GDã€€ã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šã§ANDæ¤œç´¢" style="min-width:0;flex:1;max-width:400px;">
        </div>

      </div>

      <div class="action-row">
        <button id="searchButton" class="btn btn-primary btn-search">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
          æ¤œã€€ç´¢
        </button>
        <button id="clearButton" class="btn btn-secondary">ã‚¯ãƒªã‚¢</button>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div id="loadingSpinner" class="loading-wrap">
    <div class="spinner"></div>
    <span class="loading-text">æ¤œç´¢ä¸­â€¦</span>
  </div>

  <!-- â”€â”€â”€ Summary Panel â”€â”€â”€ -->
  <div class="summary-panel">
    <div class="summary-header">
      <span class="summary-header-icon">â—†</span>
      <span class="summary-header-title">è²·å–å‚è€ƒä¾¡æ ¼</span>
    </div>
    <div class="summary-rows">
      <div class="summary-row">
        <span class="s-label">æ¤œç´¢ä»¶æ•°</span>
        <span class="s-value"><strong id="summaryCount">0</strong><span class="s-unit">ä»¶</span></span>
      </div>
      <div class="summary-row">
        <span class="s-label">å¹³å‡ã‚¬ã‚¤å˜ä¾¡</span>
        <span class="s-value"><strong id="summaryAvgPrice">0</strong><span class="s-unit">å††</span></span>
      </div>
      <div class="summary-row">
        <span class="s-label">æ›ã‘ç‡</span>
        <span class="s-value">
          <select id="rateSelect">
            <option value="0.5">5æ›ã‘</option>
            <option value="0.6">6æ›ã‘</option>
            <option value="0.7">7æ›ã‘</option>
            <option value="0.8" selected>8æ›ã‘</option>
            <option value="0.9">9æ›ã‘</option>
          </select>
        </span>
      </div>
      <div class="summary-row" style="border-top:1px solid rgba(192,154,80,0.12); padding-top:10px;">
        <span class="s-label">ã‚¬ã‚¤å˜ä¾¡</span>
        <span class="s-value"><strong id="summaryUnitPrice">0</strong><span class="s-unit">å††</span></span>
      </div>
      <div class="summary-row">
        <span class="s-label">ã‚«ãƒ©ãƒƒãƒˆ</span>
        <span class="s-value"><strong id="summaryCarat">0.000</strong><span class="s-unit">ct</span></span>
      </div>
      <div class="summary-row total">
        <span class="s-label">è²·å–å‚è€ƒä¾¡æ ¼</span>
        <span class="s-value"><strong id="summaryTotalPrice">0</strong><span class="s-unit">å††</span></span>
      </div>
    </div>
  </div>

  <!-- â”€â”€â”€ Results â”€â”€â”€ -->
  <div id="resultSection" style="display:none;">
    <div class="result-bar">
      <div id="resultCountTop" class="result-count"></div>
      <div class="sort-hint">åˆ—ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä¸¦ã³æ›¿ãˆ â–²â–¼</div>
    </div>
    <div class="table-wrapper">
      <table id="resultTable">
        <thead>
          <tr>
            <th>æ—¥ä»˜</th>
            <th>ã‚«ãƒ©ãƒ¼</th>
            <th>ã‚¯ãƒ©ãƒªãƒ†ã‚£</th>
            <th>ã‚«ãƒƒãƒˆ</th>
            <th>è›å…‰æ€§</th>
            <th>å½¢çŠ¶</th>
            <th>ã‚«ãƒ©ãƒƒãƒˆ</th>
            <th>ã‚¬ã‚¤å˜ä¾¡</th>
            <th>é‡‘é¡</th>
            <th>å‚™è€ƒ</th>
            <th>è©³ç´°</th>
          </tr>
        </thead>
        <tbody id="resultBody"></tbody>
      </table>
    </div>
    <div id="resultCountBottom" class="count-bar"></div>
    <div id="paginationArea" class="pagination-wrap"></div>
  </div>

</div><!-- /page-wrap -->

<script>
/* â”€â”€ Constants â”€â”€ */
const ALPHA_COLOR_ZONES = [
  { label:"D",       key:"D",       rank:100 },
  { label:"E",       key:"E",       rank:101 },
  { label:"F",       key:"F",       rank:102 },
  { label:"G",       key:"G",       rank:103 },
  { label:"H",       key:"H",       rank:104 },
  { label:"I",       key:"I",       rank:105 },
  { label:"J",       key:"J",       rank:106 },
  { label:"K",       key:"K",       rank:107 },
  { label:"L",       key:"L",       rank:108 },
  { label:"M",       key:"M",       rank:109 },
  { label:"N",       key:"N",       rank:110 },
  { label:"UNDER N", key:"UNDER_N", rank:401 },
  { label:"UNDER S", key:"UNDER_S", rank:402 },
  { label:"Oï½T",    key:"O_T",     rank:500 },
  { label:"Uï½Z",    key:"U_Z",     rank:600 }
];
const CLARITY_ORDER = ["FL","IF","VVS1","VVS2","VS1","VS2","SI1","SI2","I1","I2","I3"];
const CUT_RANK      = { EX:1, VG:2, GD:3, FR:4, PR:5 };
const FLUO_ORDER    = ["N","F","MB","SB","VSB"];
const CARAT_THRESHOLDS = [0,0.1,0.2,0.25,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1,1.5,2,3,5];
const fancyGrades = ["FAINT","VERY LIGHT","LIGHT","FANCY LIGHT","FANCY","FANCY INTENSE","FANCY VIVID","FANCY DEEP","FANCY DARK"];
const fancyTones  = ["YELLOW","PINK","BLUE","GREEN","BROWN","ORANGE","PURPLE","RED","GRAY","BLACK"];
const shapeMap    = {
  RD:"ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ–ãƒªãƒªã‚¢ãƒ³ãƒˆ", PS:"ãƒšã‚¢ã‚·ã‚§ã‚¤ãƒ—", HS:"ãƒãƒ¼ãƒˆã‚·ã‚§ã‚¤ãƒ—",
  OV:"ã‚ªãƒ¼ãƒãƒ«", EM:"ã‚¨ãƒ¡ãƒ©ãƒ«ãƒ‰", MQ:"ãƒãƒ¼ã‚­ã‚¹", SQ:"ã‚¹ã‚¯ã‚¨ã‚¢",
  FS:"ãƒ•ã‚¡ãƒ³ã‚·ãƒ¼", PRI:"ãƒ—ãƒªãƒ³ã‚»ã‚¹", BG:"ãƒã‚²ãƒƒãƒˆ", CUS:"ã‚¯ãƒƒã‚·ãƒ§ãƒ³",
  BUT:"ãƒã‚¿ãƒ•ãƒ©ã‚¤", TRI:"ãƒˆãƒªãƒªã‚¢ãƒ³ãƒˆ", FA:"ãƒ•ã‚¡ãƒ³ã‚·ãƒ¼ã‚«ãƒƒãƒˆ", RCT:"ãƒ¬ã‚¯ã‚¿ãƒ³ã‚®ãƒ¥ãƒ©ãƒ¼"
};

/* â”€â”€ Helpers â”€â”€ */
function syncToValue(fromId, toId) {
  document.getElementById(toId).value = document.getElementById(fromId).value;
}

function getCutGrade(value) {
  if (!value) return null;
  const str = value.toUpperCase();
  const hasHC = /H&C|HEART/.test(str);
  const parts = str.includes("/") ? str.split("/") : str.split(" ");
  const grade = parts.find(p =>
    p.includes("EX")||p.includes("VG")||p.includes("GD")||p==="G"||
    p.includes("FR")||p==="FA"||p==="PO"||p.includes("PR")
  );
  if (!grade) return null;
  let base;
  if      (grade.includes("EX"))              base = "EX";
  else if (grade.includes("VG"))              base = "VG";
  else if (grade.includes("GD")||grade==="G") base = "GD";
  else if (grade.includes("FR")||grade==="FA") base = "FR";
  else if (grade.includes("PR")||grade==="PO") base = "PR";
  else base = null;
  return { base, hasHC };
}

function getAlphaZoneKey(colorText) {
  if (!colorText) return null;
  const u = colorText.toUpperCase().trim();
  if (u.startsWith("UNDER N")) return "UNDER_N";
  if (u.startsWith("UNDER S")) return "UNDER_S";
  const m = u.match(/^[D-Z]/);
  if (!m) return null;
  const ch = m[0];
  if ("DEFGHIJKLMN".includes(ch)) return ch;
  if ("OPQRST".includes(ch)) return "O_T";
  if ("UVWXYZ".includes(ch)) return "U_Z";
  return null;
}

function setCountEl(el, count, page, totalPages) {
  if (!el) return;
  if (count === 0) { el.innerHTML = "è©²å½“ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã¯ã‚ã‚Šã¾ã›ã‚“"; return; }
  el.innerHTML = `æ¤œç´¢çµæœï¼š<strong>${count.toLocaleString()}</strong> ä»¶ï¼ˆ${page} / ${totalPages} ãƒšãƒ¼ã‚¸ï¼‰`;
}

/* â”€â”€ Data load & filter init â”€â”€ */
let diamondData = [];

async function populateFilters() {
  const resp = await fetch("https://raw.githubusercontent.com/sgc-gold/sgc/main/data/diamonds.json");
  diamondData = await resp.json();

  const dates = new Set(), shapes = new Set();
  diamondData.forEach(d => {
    if (d.date)  dates.add(d.date.split(" ")[0]);
    if (d.shape) shapes.add(d.shape);
  });

  const addOpt = (sel, val, label) => sel.appendChild(new Option(label || val, val));

  const dateSel = document.getElementById("dateSelect");
  Array.from(dates).sort((a,b) => new Date(b)-new Date(a)).forEach(d => addOpt(dateSel, d));
  dateSel.selectedIndex = 1;

  const fromColorSel = document.getElementById("fromColor");
  const toColorSel   = document.getElementById("toColor");
  ALPHA_COLOR_ZONES.forEach(z => { addOpt(fromColorSel, z.key, z.label); addOpt(toColorSel, z.key, z.label); });

  fancyGrades.forEach(g => addOpt(document.getElementById("fancyGradeSelect"), g));
  fancyTones.forEach(t  => addOpt(document.getElementById("fancyToneSelect"),  t));

  populateShapeSelect(Array.from(shapes));
}
populateFilters();

function populateShapeSelect(shapeCodes) {
  const sel = document.getElementById("shapeSelect");
  sel.innerHTML = "";
  sel.appendChild(new Option("ã™ã¹ã¦", ""));
  sel.appendChild(new Option("â†³ ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ–ãƒªãƒªã‚¢ãƒ³ãƒˆ", "RD"));
  sel.appendChild(new Option("â†³ ãƒ©ã‚¦ãƒ³ãƒ‰ä»¥å¤–", "NON_ROUND"));
  [...new Set(shapeCodes.filter(s => s && s !== "RD"))].sort().forEach(code => {
    sel.appendChild(new Option(`ã€€â†³ ${shapeMap[code] || code}`, code));
  });
  sel.value = "";
}

/* â”€â”€ Color toggle â”€â”€ */
document.querySelectorAll('.ctog-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.ctog-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const type = btn.dataset.type;
    document.querySelector('.alpha-form').style.display = type === 'alpha' ? 'flex' : 'none';
    document.querySelector('.fancy-form').style.display = type === 'fancy' ? 'flex' : 'none';
    document.getElementById('treatedCheck').checked = false;
    document.getElementById('faintCheck').checked   = false;
  });
});
window.addEventListener("DOMContentLoaded", () => {
  document.querySelector('.alpha-form').style.display = 'flex';
  document.querySelector('.fancy-form').style.display = 'none';
});
document.getElementById('fromColor').addEventListener('change', function() {
  document.getElementById('toColor').value = this.value;
});

/* â”€â”€ Carat set â”€â”€ */
document.getElementById("setCarat").addEventListener("click", () => {
  const c = parseFloat(document.getElementById("mainCarat").value);
  if (isNaN(c)) return alert("æ•°å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
  let min = 0, max = null;
  for (let i = 0; i < CARAT_THRESHOLDS.length - 1; i++) {
    if (c >= CARAT_THRESHOLDS[i] && c < CARAT_THRESHOLDS[i+1]) {
      min = CARAT_THRESHOLDS[i]; max = CARAT_THRESHOLDS[i+1] - 0.001; break;
    }
  }
  if (c >= CARAT_THRESHOLDS[CARAT_THRESHOLDS.length - 1]) {
    min = CARAT_THRESHOLDS[CARAT_THRESHOLDS.length - 1]; max = null;
  }
  document.getElementById("minCarat").value = min.toFixed(3);
  document.getElementById("maxCarat").value = max !== null ? max.toFixed(3) : "";
});

/* â”€â”€ Search â”€â”€ */
document.getElementById("searchButton").addEventListener("click", runSearch);

function runSearch() {
  document.getElementById("loadingSpinner").style.display = "flex";
  setTimeout(() => {
    const minC     = parseFloat(document.getElementById("minCarat").value) || 0;
    const maxC     = parseFloat(document.getElementById("maxCarat").value) || 999;
    const dateVal  = document.getElementById("dateSelect").value;
    const shapeVal = document.getElementById("shapeSelect").value;
    const keyword  = document.getElementById("keyword").value.trim().toLowerCase();
    const fromColorVal = document.getElementById("fromColor").value;
    const toColorVal   = document.getElementById("toColor").value;
    const fancyGrade   = document.getElementById("fancyGradeSelect").value;
    const fancyTone    = document.getElementById("fancyToneSelect").value;
    const treatedOnly  = document.getElementById("treatedCheck").checked;
    const faintOnly    = document.getElementById("faintCheck").checked;
    const hcChecked    = document.getElementById("hcCheck").checked;
    const minClarity   = document.getElementById("minClaritySelect").value;
    const maxClarity   = document.getElementById("maxClaritySelect").value;
    const minCut       = document.getElementById("minCutSelect").value;
    const maxCut       = document.getElementById("maxCutSelect").value;
    const minFluo      = document.getElementById("minFluoSelect").value;
    const maxFluo      = document.getElementById("maxFluoSelect").value;
    const activeColorType = document.querySelector('.ctog-btn.active')?.dataset.type || "all";

    const results = diamondData.filter(d => {
      const c = parseFloat(d.carat) || 0;
      if (c < minC || c > maxC) return false;
      if (dateVal && d.date.split(" ")[0] < dateVal) return false;
      if (shapeVal) {
        if (shapeVal === "NON_ROUND") { if (d.shape === "RD") return false; }
        else { if (d.shape !== shapeVal) return false; }
      }
      if (minClarity || maxClarity) {
        const ci = CLARITY_ORDER.indexOf(d.clarity);
        const lo = minClarity ? CLARITY_ORDER.indexOf(minClarity) : -1;
        const hi = maxClarity ? CLARITY_ORDER.indexOf(maxClarity) : CLARITY_ORDER.length;
        if (lo !== -1 && ci < lo) return false;
        if (hi !== CLARITY_ORDER.length && ci > hi) return false;
      }
      if (minCut || maxCut) {
        const res = getCutGrade(d.cut);
        if (!res || !res.base) return false;
        if (minCut && CUT_RANK[res.base] < CUT_RANK[minCut]) return false;
        if (maxCut && CUT_RANK[res.base] > CUT_RANK[maxCut]) return false;
      }
      if (minFluo || maxFluo) {
        const fi = FLUO_ORDER.indexOf(d.fluorescence);
        const lo = minFluo ? FLUO_ORDER.indexOf(minFluo) : -1;
        const hi = maxFluo ? FLUO_ORDER.indexOf(maxFluo) : FLUO_ORDER.length;
        if (fi === -1) return false;
        if (lo !== -1 && fi < lo) return false;
        if (hi !== FLUO_ORDER.length && fi > hi) return false;
      }
      if (keyword) {
        const fields = [d.carat,d.color,d.clarity,d.cut,d.fluorescence,d.notes].join(" ").toLowerCase();
        if (!keyword.split(" ").every(k => fields.includes(k))) return false;
      }
      const colorUpper = (d.color || "").toUpperCase();
      const isFancy = d.colorType === "FANCY";
      const isAlpha = d.colorType === "ALPHA";
      if (activeColorType === "alpha" && !isAlpha) return false;
      if (activeColorType === "fancy" && !isFancy) return false;
      if (isAlpha && (fromColorVal || toColorVal)) {
        const itemKey = getAlphaZoneKey(colorUpper);
        const order   = ALPHA_COLOR_ZONES.map(z => z.key);
        const fromIdx = fromColorVal ? order.indexOf(fromColorVal) : 0;
        const toIdx   = toColorVal   ? order.indexOf(toColorVal)   : order.length - 1;
        const itemIdx = order.indexOf(itemKey);
        if (itemIdx === -1 || itemIdx < fromIdx || itemIdx > toIdx) return false;
      }
      if (isFancy) {
        if (fancyGrade && !colorUpper.includes(fancyGrade.toUpperCase())) return false;
        if (fancyTone  && !colorUpper.includes(fancyTone.toUpperCase()))  return false;
      }
      if (treatedOnly && !colorUpper.includes("TREATED")) return false;
      if (faintOnly   && !colorUpper.includes("FAINT"))   return false;
      if (hcChecked) {
        const cu = (d.cut || "").toUpperCase();
        if (!(cu.includes("H&C") || cu.includes("HC"))) return false;
      }
      return true;
    });

    results.sort((a,b) => (Number(a.NO)||0) - (Number(b.NO)||0));
    window.lastSearchResults = results;

    document.getElementById("resultSection").style.display = "block";
    document.getElementById("resultTable").style.display   = "table";

    const perPage    = 100;
    let currentPage  = 1;
    const totalPages = Math.ceil(results.length / perPage) || 1;

    function renderPage(page) {
      const tbody = document.getElementById("resultBody");
      tbody.innerHTML = "";
      const start = (page - 1) * perPage;
      window.lastSearchResults.slice(start, start + perPage).forEach(d => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${d.date.split(" ")[0]||""}</td>
          <td>${d.color||""}</td>
          <td>${d.clarity||""}</td>
          <td>${d.cut||""}</td>
          <td>${d.fluorescence||""}</td>
          <td>${d.shape||""}</td>
          <td>${(+d.carat).toFixed(3)||""}</td>
          <td class="priceCell">${(+d.pricePerCarat).toLocaleString()||""}</td>
          <td class="priceCell">${Math.floor((+d.pricePerCarat)*(+d.carat)).toLocaleString()||""}</td>
          <td>${d.notes||""}</td>
          <td><span class="detail-toggle">è©³ç´°</span></td>
        `;
        tbody.appendChild(row);

        const detailRow = document.createElement("tr");
        detailRow.classList.add("detailsRow");
        let unevenRate = "", heightRatio = "";
        if (d.diameterMin && d.diameterMax) {
          const mn = parseFloat(d.diameterMin), mx = parseFloat(d.diameterMax);
          const avg = (mn + mx) / 2;
          unevenRate = (((mx - mn) / avg) * 100).toFixed(2) + "%";
          if (d.height) heightRatio = ((parseFloat(d.height) / avg) * 100).toFixed(2) + "%";
        }
        detailRow.innerHTML = `<td colspan="11">ç›´å¾„ï¼š${d.diameterMin||"â€”"}â€“${d.diameterMax||"â€”"} mmï¼ˆä¸æ­£å††ç‡ï¼š${unevenRate||"â€”"}ï¼‰ã€€é«˜ã•ï¼š${d.height||"â€”"} mmï¼ˆå…¨é«˜æ¯”ï¼š${heightRatio||"â€”"}ï¼‰</td>`;
        tbody.appendChild(detailRow);

        row.querySelector(".detail-toggle").addEventListener("click", () => {
          detailRow.style.display = detailRow.style.display === "table-row" ? "none" : "table-row";
        });
      });
      setCountEl(document.getElementById("resultCountTop"),    results.length, page, totalPages);
      setCountEl(document.getElementById("resultCountBottom"), results.length, page, totalPages);
      notifyHeight();
    }

    function updatePagination() {
      const wrap = document.getElementById("paginationArea");
      wrap.innerHTML = "";
      if (totalPages <= 1) return;
      const prev = document.createElement("button");
      prev.textContent = "â† å‰ã¸"; prev.disabled = currentPage === 1;
      prev.onclick = () => { currentPage--; renderPage(currentPage); updatePagination(); };
      const next = document.createElement("button");
      next.textContent = "æ¬¡ã¸ â†’"; next.disabled = currentPage === totalPages;
      next.onclick = () => { currentPage++; renderPage(currentPage); updatePagination(); };
      const info = document.createElement("span");
      info.className = "page-info";
      info.textContent = `${currentPage} / ${totalPages}`;
      wrap.append(prev, info, next);
    }

    let sortState = {};
    function enableSort() {
      document.querySelectorAll("#resultTable thead th").forEach((th, idx) => {
        if (idx === 10) return;
        th.addEventListener("click", () => {
          const dir = sortState[idx] === "asc" ? "desc" : "asc";
          sortState = { [idx]: dir };
          window.lastSearchResults.sort((a, b) => {
            let r = 0;
            if (idx === 0) { r = (Number(a.NO)||0) - (Number(b.NO)||0); }
            else {
              const va = colVal(a, idx), vb = colVal(b, idx);
              if (va == null) return 1; if (vb == null) return -1;
              r = (!isNaN(va) && !isNaN(vb)) ? va - vb : String(va).localeCompare(String(vb), "ja");
            }
            return dir === "desc" ? -r : r;
          });
          currentPage = 1; renderPage(currentPage); updatePagination();
          document.querySelectorAll("#resultTable thead th").forEach((h, i) => {
            h.textContent = h.textContent.replace(/ [â–²â–¼]$/, "");
            if (i === idx) h.textContent += dir === "asc" ? " â–²" : " â–¼";
          });
        });
      });
    }

    function colVal(row, idx) {
      switch (idx) {
        case 0: return row.date;
        case 1: return row.color || "";
        case 2: return CLARITY_ORDER.indexOf(row.clarity);
        case 3: { const b = getCutGrade(row.cut)?.base; return b ? CUT_RANK[b] : 999; }
        case 4: { const fi = FLUO_ORDER.indexOf(row.fluorescence); return fi === -1 ? 999 : fi; }
        case 5: return row.shape || "";
        case 6: return parseFloat(row.carat) || 0;
        case 7: return parseFloat(row.pricePerCarat) || 0;
        case 8: return (parseFloat(row.pricePerCarat)||0) * (parseFloat(row.carat)||0);
        case 9: return row.notes || "";
        default: return "";
      }
    }

    renderPage(1); updatePagination(); enableSort();
    updateSummary(results);
    document.getElementById("loadingSpinner").style.display = "none";
  }, 80);
}

/* â”€â”€ Clear â”€â”€ */
document.getElementById("clearButton").addEventListener("click", () => {
  ["minCarat","maxCarat","mainCarat","fromColor","toColor",
   "fancyGradeSelect","fancyToneSelect","minCutSelect","maxCutSelect",
   "minClaritySelect","maxClaritySelect","minFluoSelect","maxFluoSelect",
   "shapeSelect","keyword"
  ].forEach(id => { document.getElementById(id).value = ""; });
  const si = document.getElementById("spinInt"), sd = document.getElementById("spinDec");
  if (si && sd) { si.value = "0"; sd.value = "50"; document.getElementById("mainCarat").value = "0.50"; }
  ["hcCheck","treatedCheck","faintCheck"].forEach(id => { document.getElementById(id).checked = false; });
  document.getElementById("resultSection").style.display  = "none";
  document.getElementById("resultTable").style.display    = "none";
  document.getElementById("resultBody").innerHTML         = "";
  document.getElementById("paginationArea").innerHTML     = "";
  document.getElementById("summaryCount").textContent      = "0";
  document.getElementById("summaryAvgPrice").textContent   = "0";
  document.getElementById("summaryUnitPrice").textContent  = "0";
  document.getElementById("summaryCarat").textContent      = "0.000";
  document.getElementById("summaryTotalPrice").textContent = "0";
  document.getElementById("rateSelect").value              = "0.8";
  window.lastSearchResults = [];
  notifyHeight();
});

/* â”€â”€ Summary â”€â”€ */
function updateSummary(results) {
  const carat = parseFloat(document.getElementById("mainCarat").value) || 0;
  const rate  = parseFloat(document.getElementById("rateSelect").value) || 1;
  const count = results.length;
  const avg   = count > 0 ? Math.round(results.reduce((s,d) => s + (parseFloat(d.pricePerCarat)||0), 0) / count) : 0;
  const unit  = Math.round(avg * rate);
  const total = Math.round(unit * carat);
  document.getElementById("summaryCount").textContent      = count.toLocaleString();
  document.getElementById("summaryAvgPrice").textContent   = avg.toLocaleString();
  document.getElementById("summaryUnitPrice").textContent  = unit.toLocaleString();
  document.getElementById("summaryCarat").textContent      = carat.toFixed(3);
  document.getElementById("summaryTotalPrice").textContent = total.toLocaleString();
}
document.getElementById("rateSelect").addEventListener("change", () => {
  updateSummary(window.lastSearchResults || []);
});

/* â”€â”€ Mobile spinner â”€â”€ */
(function() {
  const si = document.getElementById("spinInt"), sd = document.getElementById("spinDec"), mc = document.getElementById("mainCarat");
  if (!si || !sd || !mc) return;
  for (let i = 0; i <= 10; i++) si.appendChild(new Option(i, i));
  for (let i = 1; i <= 99; i++) { const v = String(i).padStart(2,"0"); sd.appendChild(new Option(v,v)); }
  si.value = "0"; sd.value = "50"; mc.value = "0.50";
  const sync = () => { mc.value = si.value + "." + sd.value; };
  si.addEventListener("change", sync); sd.addEventListener("change", sync);
})();

/* â”€â”€ iframe height â”€â”€ */
function notifyHeight() {
  parent.postMessage({ type: 'resize-iframe', height: document.body.scrollHeight }, '*');
}
window.addEventListener('load', notifyHeight);
window.addEventListener('resize', notifyHeight);
</script>
</body>
</html>
