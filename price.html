<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>価格情報</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Noto Sans JP', sans-serif;
    background: #f5f5f5;
    color: #003D2E;
    margin: 0;
    padding: 0;
  }
  h3 {
    text-align: center;
    font-size: 1.3rem;
    color: #003D2E;
    margin-bottom: 1rem;
  }
  h3 span {
    display: block;
    font-size: 0.9rem;
    color: #777;
    margin-top: 4px;
  }
  .contents_inner {
    max-width: 850px;
    margin: 0 auto;
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    padding: 1rem 1.5rem 2rem;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 1rem;
  }
  th, td {
    text-align: center;
    padding: 0.9rem;
    border-bottom: 1px solid #eee;
  }
  th {
    background: #003D2E;
    color: #fff;
    font-size: 0.95rem;
  }
  tr.gold td { background: #fffbe6; }
  tr.pt td { background: #f8f8f8; }
  tr.silver td { background: #fefefe; }
  td.metal_name {
    font-weight: 600;
    color: #003D2E;
  }
  td.positive {
    color: #c60000;
    font-weight: 600;
  }
  td.negative {
    color: #0044cc;
    font-weight: 600;
  }
  td.small_diff {
    font-size: 0.8em;
    color: #777;
  }
  ul.notice {
    list-style: disc;
    color: #555;
    font-size: 0.9rem;
    padding-left: 1.5rem;
  }
  @media (max-width: 600px) {
    th, td { font-size: 0.8rem; padding: 0.6rem; }
    .contents_inner { padding: 0.8rem; }
  }
</style>
</head>
<body>

  <h3 id="title">田中貴金属価格情報 <span>(読み込み中...)</span></h3>

  <div class="contents_inner">
    <table id="metal_price">
      <tr>
        <th>&nbsp;</th>
        <th>小売価格<br>(税込)</th>
        <th>前日比</th>
        <th>買取価格<br>(税込)</th>
        <th>前日比</th>
      </tr>
    </table>

    <ul class="notice">
      <li>前日比は前営業日の9:30の価格と比較して算出しています。</li>
      <li>14:30更新時のみ、（9:30比）も併記されます。</li>
    </ul>
  </div>

<script>
async function fetchTanaka() {
  try {
    const res = await fetch('data/tanaka_price.json?nocache=' + Date.now());
    const data = await res.json();

    // 更新時刻をタイトルに反映
    document.querySelector("#title span").textContent = `(${data.update_time})`;

    const table = document.querySelector("#metal_price");
    const metals = ["GOLD", "PLATINUM", "SILVER"];
    const rows = [];

    const isAfternoon = data.update_time.includes("14");

    for (const metal of metals) {
      const p = data.prices[metal];
      if (!p) continue;

      const diffRetailClass = p.retail_diff.startsWith('+')
        ? 'positive'
        : p.retail_diff.startsWith('-')
        ? 'negative'
        : '';
      const diffBuyClass = p.buy_diff.startsWith('+')
        ? 'positive'
        : p.buy_diff.startsWith('-')
        ? 'negative'
        : '';

      const retailPrice = p.retail.includes('.') 
        ? Number(p.retail).toFixed(2) + "円"
        : Number(p.retail).toLocaleString() + "円";

      const buyPrice = p.buy.includes('.') 
        ? Number(p.buy).toFixed(2) + "円"
        : Number(p.buy).toLocaleString() + "円";

      // 午後（14時更新）の場合は9:30比も追加表示
      let retailDiffText = `${p.retail_diff}円`;
      let buyDiffText = `${p.buy_diff}円`;
      if (isAfternoon && p.retail_930diff && p.buy_930diff) {
        retailDiffText += `<br><span class="small_diff">(${p.retail_930diff}円)</span>`;
        buyDiffText += `<br><span class="small_diff">(${p.buy_930diff}円)</span>`;
      }

      const metalName =
        metal === "GOLD" ? "金" :
        metal === "PLATINUM" ? "プラチナ" :
        "銀";

      rows.push(`
        <tr class="${metal.toLowerCase()}">
          <td class="metal_name">${metalName}</td>
          <td class="retail_tax">${retailPrice}</td>
          <td class="retail_ratio ${diffRetailClass}">${retailDiffText}</td>
          <td class="purchase_tax">${buyPrice}</td>
          <td class="purchase_ratio ${diffBuyClass}">${buyDiffText}</td>
        </tr>
      `);
    }

    table.insertAdjacentHTML("beforeend", rows.join(""));
  } catch (err) {
    document.querySelector("#metal_price").insertAdjacentHTML(
      "afterend",
      `<p style="color:red;text-align:center;">価格データの取得に失敗しました。</p>`
    );
    console.error("価格データの読み込みエラー:", err);
  }
}

fetchTanaka();
</script>

</body>
</html>