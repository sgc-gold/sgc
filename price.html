<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>価格情報</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Noto Sans JP', sans-serif;
    background: #f5f5f5;
    color: #003D2E;
    margin: 0;
    padding: 0;
  }
  h3 {
    text-align: center;
    font-size: 1.3rem;
    color: #003D2E;
    margin-bottom: 1rem;
  }
  h3 span {
    display: block;
    font-size: 0.9rem;
    color: #777;
    margin-top: 4px;
  }
  .contents_inner {
    max-width: 850px;
    margin: 0 auto;
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    padding: 1rem 1.5rem 2rem;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 1rem;
  }
  th, td {
    text-align: center;
    padding: 0.9rem;
    border-bottom: 1px solid #eee;
  }
  th {
    background: #003D2E;
    color: #fff;
    font-size: 0.95rem;
  }
  tr.gold td { 
    background: #fff8e1; /* 金色っぽい薄い黄色 */
  }
  tr.pt td { 
    background: #f0f4f8; /* プラチナっぽい薄いグレー */
  }
  tr.silver td { 
    background: #fefefe; /* 銀色っぽい白 */
  }
  td.metal_name {
    font-weight: 600;
    color: #003D2E;
  }
  td.positive {
    color: #c60000;
    font-weight: 600;
  }
  td.negative {
    color: #0044cc;
    font-weight: 600;
  }
  td.small_diff {
    font-size: 0.8em;
    color: #777;
  }
  ul.notice {
    list-style: disc;
    color: #555;
    font-size: 0.9rem;
    padding-left: 1.5rem;
  }
  @media (max-width: 600px) {
    th, td { font-size: 0.8rem; padding: 0.6rem; }
    .contents_inner { padding: 0.8rem; }
  }
</style>
</head>
<body>

  <h3 id="title">田中貴金属価格情報 <span>(読み込み中...)</span></h3>

  <div class="contents_inner">
    <table id="metal_price">
      <tr>
        <th>&nbsp;</th>
        <th>小売価格<br>(税込)</th>
        <th>前日比</th>
        <th>買取価格<br>(税込)</th>
        <th>前日比</th>
      </tr>
    </table>

    <ul class="notice">
      <li>前日比は前営業日の9:30の価格と比較して算出しています。</li>
      <li>14:30更新時のみ、（9:30比）も併記されます。</li>
    </ul>
  </div>

<script>
async function fetchTanaka() {
  try {
    const res = await fetch('data/tanaka_price.json?nocache=' + Date.now());
    const data = await res.json();

    // 更新時刻をタイトルに反映（括弧なし）
    document.querySelector("#title span").textContent = data.update_time;

    const table = document.querySelector("#metal_price");
    const metals = ["GOLD", "PLATINUM", "SILVER"];
    const rows = [];

    // 14時更新か判定（data内にretail_930diffがあれば午後）
    const isAfternoon = Object.values(data.prices).some(p => p.retail_930diff || p.buy_930diff);

    for (const metal of metals) {
      const p = data.prices[metal];
      if (!p) continue;

      // 差分の色判定
      const diffRetailClass = p.retail_diff.startsWith('+') ? 'positive' :
                              p.retail_diff.startsWith('-') ? 'negative' : '';
      const diffBuyClass = p.buy_diff.startsWith('+') ? 'positive' :
                           p.buy_diff.startsWith('-') ? 'negative' : '';

      // カンマ削除して数値化
      const retailPrice = Number(p.retail.replace(/,/g, '')).toLocaleString() + "円";
      const buyPrice = Number(p.buy.replace(/,/g, '')).toLocaleString() + "円";

      // 差分テキスト
      let retailDiffText = `${p.retail_diff}円`;
      let buyDiffText = `${p.buy_diff}円`;

      // 午後更新時は9:30比を追加
      if (isAfternoon) {
        if (p.retail_930diff) retailDiffText += `<br><span class="small_diff">(${p.retail_930diff})</span>`;
        if (p.buy_930diff) buyDiffText += `<br><span class="small_diff">(${p.buy_930diff})</span>`;
      }

      // 金属名
      const metalName = metal === "GOLD" ? "金" :
                        metal === "PLATINUM" ? "プラチナ" : "銀";

      rows.push(`
        <tr class="${metal.toLowerCase()}">
          <td class="metal_name">${metalName}</td>
          <td class="retail_tax">${retailPrice}</td>
          <td class="retail_ratio ${diffRetailClass}">${retailDiffText}</td>
          <td class="purchase_tax">${buyPrice}</td>
          <td class="purchase_ratio ${diffBuyClass}">${buyDiffText}</td>
        </tr>
      `);
    }

    table.insertAdjacentHTML("beforeend", rows.join(""));
  } catch (err) {
    document.querySelector("#metal_price").insertAdjacentHTML(
      "afterend",
      `<p style="color:red;text-align:center;">価格データの取得に失敗しました。</p>`
    );
    console.error("価格データの読み込みエラー:", err);
  }
}

fetchTanaka();
</script>

</body>
</html>
