<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IGã‚·ãƒªã‚¢ãƒ«ç•ªå·ç…§åˆ</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap" rel="stylesheet">
  <style>
    html {
      font-size: 16px; /* åŸºæº–ã‚µã‚¤ã‚ºï¼š1rem = 16px */
      overflow-x: hidden;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: 'Noto Sans JP', sans-serif;
      background: #f4f4f4;
      overflow-x: hidden;
    }

    * {
      box-sizing: border-box;
    }

    header {
      background: #003D2E;
      color: #fff;
      text-align: center;
      padding: 0.9375rem; /* 15px */
    }

    header img {
      width: 140px;
      height: auto;
      margin-bottom: 0.5rem;
    }

    header h1 {
      font-size: 2.2rem;
      margin: 0;
    }

    .container {
      max-width: 40rem; /* 640px */
      margin: 0.9375rem auto;
      background: #fff;
      border-radius: 0.5rem;
      padding: 1.25rem;
      box-shadow: 0 0.125rem 0.5rem rgba(0, 0, 0, 0.1);
      font-size: 1.2rem;
    }

    .note {
      background: #fff3cd;
      color: #856404;
      padding: 0.75rem;
      border-radius: 0.375rem;
      border: 1px solid #ffeeba;
      margin-bottom: 0.9375rem;
      font-size: 1rem;
    }

    .brand-box,
    .serial-box {
      margin-bottom: 0.625rem;
    }

    .serial-box {
      display: flex;
      gap: 0.625rem;
      flex-wrap: wrap;
    }

    .serial-box select,
    .serial-box input {
      font-size: 2rem;
      padding: 1.25rem;
      border: 1px solid #ccc;
      border-radius: 0.5rem;
      width: 100%;
      flex: 1;
      min-width: 0;
    }

    #lotSelect {
      flex-grow: 5;
      flex-basis: 0;
    }

    #numberInput {
      flex-grow: 5;
      flex-basis: 0;
    }

    .item-brand-weight {
      display: flex;
      gap: 0.625rem;
      margin-bottom: 0.75rem;
    }

    .item-brand-weight select {
      font-size: 1.8rem;
      padding: 1.25rem;
      border: 1px solid #ccc;
      border-radius: 0.5rem;
      flex: 1;
      min-width: 0;
    }

    #itemSelect   { flex-grow: 15; flex-basis: 0; }
    #brandSelect  { flex-grow: 35; flex-basis: 0; }
    #weightSelect { flex-grow: 25; flex-basis: 0; }

    #searchButton,
    #clearButton,
    #exportButton {
      width: 100%;
      display: block;
      padding: 1.5rem;
      font-size: 2rem;
      border: none;
      border-radius: 0.5rem;
      margin-top: 0.75rem;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    #searchButton {
      background: #003D2E;
      color: #fff;
    }

    #searchButton:hover:not(:disabled) {
      background: #00503A;
    }

    #searchButton:disabled {
      background: #999;
      cursor: not-allowed;
    }

    #clearButton {
      background: #999;
      color: #fff;
    }

    #clearButton:hover {
      background: #666;
    }

    #exportButton {
      background: #00695C;
      color: #fff;
      display: none;
    }

    #exportButton:hover:not(:disabled) {
      background: #00897B;
    }

    #exportButton:disabled {
      background: #999;
      cursor: not-allowed;
    }

    .count {
      color: #d32f2f;
      font-weight: bold;
      margin-top: 1.25rem;
      font-size: 1.4rem;
    }

    .result {
      margin-top: 0.75rem;
      background: #e9f7fc;
      border: 1px solid #003D2E;
      border-radius: 0.5rem;
      padding: 1.125rem;
      font-size: 1.4rem;
    }

    .serial-highlight {
      font-size: 1.8rem;
      font-weight: bold;
      color: #c62828;
      background: #fff;
      padding: 0.375rem 0.625rem;
      border: 2px solid #c62828;
      border-radius: 0.375rem;
      display: inline-block;
    }

    footer {
      text-align: center;
      margin: 1.25rem 0;
      font-size: 1rem;
      color: #666;
    }

    #loadingSpinner {
      display: none;
      text-align: center;
      margin: 2.5rem 0;
    }

    .spinner {
      margin: 0.625rem auto;
      width: 40px;
      height: 40px;
      border: 5px solid #ccc;
      border-top: 5px solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0%   { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    #keypadToggle {
      font-size: 3rem;
      padding-left: 1.25rem;
      padding-right: 1.25rem;
      border-radius: 0.5rem;
      border: 1px solid #ccc;
      background: #eee;
      cursor: pointer;
    }

    #customKeypad {
      margin-top: 1rem;
      padding: 1rem;
      background: #f9f9f9;
      border-radius: 0.75rem;
      box-shadow: 0 0.125rem 0.375rem rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
    }

    #customKeypad .keypad-row {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
    }

    #customKeypad button {
      aspect-ratio: 1 / 1;         /* âœ… æ­£æ–¹å½¢ã‚’ä¿è¨¼ */
      width: 5.5rem;               /* âœ… åŸºæº–ã‚µã‚¤ã‚ºï¼ˆç”»é¢ã«å¿œã˜ã¦èª¿æ•´å¯èƒ½ï¼‰ */
      font-size: 2.8rem;
      font-weight: 700;
      border-radius: 0.625rem;
      border: none;
      background: #fff;
      color: #333;
      box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.1);
      transition: background-color 0.2s ease;
    }

    #customKeypad button:hover {
      background: #e0f7fa;
      color: #00695C;
    }

    #customKeypad button.enter {
      background: #00695C;
      font-size: 3rem;
      font-weight: 800;
      line-height: 1.2;
      box-shadow: 0 0 0 3px #fff inset, 0 0.125rem 0.5rem rgba(0,0,0,0.2);
    }

    #customKeypad button.enter:hover {
      background: #00897B;
    }

    @media (max-width: 1024px) {
      html {
        font-size: 112.5%; /* 18pxç›¸å½“ */
      }

      .container {
        max-width: 100%;
        margin: 0;
        padding: 1rem;
        border-radius: 0;
      }

      .note {
        font-size: 1.4rem;
        padding: 1rem;
      }

      .serial-box {
        flex-direction: row;
        gap: 0.625rem;
      }

      .item-brand-weight select,
      .serial-box select,
      .serial-box input {
        font-size: 2.5rem;
        height: 6rem;
      }

      #customKeypad button {
        width: 4.5rem;
        font-size: 2.4rem;
      }

      #customKeypad button.enter {
        font-size: 3.6rem;
        padding: 1.75rem;
      }

      #searchButton,
      #exportButton {
        font-size: 2.4rem;
        padding: 1.75rem;
      }

      .result {
        font-size: 1.6rem;
        padding: 1.5rem;
      }

      .count {
        font-size: 1.6rem;
      }

      footer {
        font-size: 1.2rem;
      }

      .spinner {
        width: 3.75rem; /* 60px */
        height: 3.75rem;
      }
    }
  </style>
</head>
<body lang="ja">
<header>
  <img src="https://www.sgc-gold.co.jp/img/header-logo.png" alt="SGCãƒ­ã‚´">
  <h1>IGã‚·ãƒªã‚¢ãƒ«ç•ªå·ç…§åˆ</h1>
</header>

<div class="container">

  <div class="note">
    ã„ãšã‚Œã‹1ã¤ä»¥ä¸Šã‚’é¸æŠã¾ãŸã¯å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
  </div>

  <div class="item-brand-weight">
    <select id="itemSelect">
      <option value="Au" selected>ï¼¡ï½•</option>  <!-- âœ… åˆæœŸé¸æŠ -->
      <option value="Pt">ï¼°ï½”</option>
    </select>

    <select id="brandSelect">
      <option value="">ãƒ–ãƒ©ãƒ³ãƒ‰é¸æŠ</option>
      <!-- ãƒ–ãƒ©ãƒ³ãƒ‰ã¯JSã§è‡ªå‹•è¿½åŠ ã•ã‚Œã¾ã™ -->
    </select>

    <select id="weightSelect">
      <option value="">é‡é‡é¸æŠ</option>
      <option value="1kg">1kg</option>
      <option value="500g">500g</option>
      <option value="300g">300g</option>
      <option value="250g">250g</option>
      <option value="200g">200g</option>
      <option value="100g">100g</option>
    </select>
  </div>

  <div class="serial-box">
    <select id="lotSelect">
      <option value="">ï¼¬ï½ï½”é¸æŠ</option>
    </select>
    <input type="tel" inputmode="numeric" pattern="[0-9]*" id="numberInput" placeholder="æ•°å­—å…¥åŠ›">
    <button id="keypadToggle" onclick="toggleKeypad()">ğŸ”¢</button>
  </div>

  <div id="customKeypad" style="display: none;"></div>

  <button id="searchButton" onclick="searchSerial()">æ¤œç´¢</button>
  <button id="clearButton" onclick="clearForm()">ã‚¯ãƒªã‚¢</button>
  <button id="exportButton" onclick="downloadExcel()" style="display: none;">Excelå‡ºåŠ›</button>

  <!-- å…±é€šã‚¹ãƒ”ãƒŠãƒ¼è¡¨ç¤º -->
  <div id="loadingSpinner">
    <div class="spinner"></div>
    <p id="loadingMessage">å‡¦ç†ä¸­ã§ã™...</p>
  </div>

  <div id="exportResult" class="result" style="display: none;"></div>
  <div id="countContainer"></div>

  <!-- ğŸ”¼ ä¸Šéƒ¨ãƒšãƒ¼ã‚¸ãƒŠãƒ“ -->
  <div id="paginationTop"></div>

  <!-- ğŸ”½ æ¤œç´¢çµæœæœ¬ä½“ -->
  <div id="resultContainer"></div>

  <!-- ğŸ”½ ä¸‹éƒ¨ãƒšãƒ¼ã‚¸ãƒŠãƒ“ -->
  <div id="paginationBottom"></div>

</div>

<footer>
  <p>Â© 2025 SGC Co., Ltd. All Rights Reserved.</p>
</footer>

<script>
  const brandList = ["ç”°ä¸­", "æ—¥ãƒãƒ†", "ä¸‰è±", "å¾³åŠ›", "çŸ³ç¦", "æ¾ç”°", "ã‚¢ã‚µãƒ’", "SGCãƒãƒ¼", "CS", "HERAEUS", "SBC", "UBS"];

  function populateBrands() {
    const select = document.getElementById("brandSelect");
    if (!select) return;
    brandList.forEach(brand => {
      const option = document.createElement("option");
      option.value = brand;
      option.textContent = brand;
      select.appendChild(option);
    });
  }

  google.script.run.withSuccessHandler(populateLots).getLots();

  window.addEventListener("load", () => {
    populateBrands();
  });

  function populateLots(lots) {
    const lotSelect = document.getElementById("lotSelect");
    lots.forEach(lot => {
      const option = document.createElement("option");
      option.value = lot;
      option.textContent = lot;
      lotSelect.appendChild(option);
    });
  }

  function normalize(str) {
    if (!str) return "";
    return str.replace(/\u3000/g,' ').trim().toUpperCase();
  }

  function showLoading(message) {
    document.getElementById("loadingMessage").textContent = message;
    document.getElementById("loadingSpinner").style.display = "block";
  }

  function hideLoading() {
    document.getElementById("loadingSpinner").style.display = "none";
  }

  function searchSerial() {
    const item = document.getElementById("itemSelect").value.trim();
    const brand = document.getElementById("brandSelect").value.trim();
    const weight = document.getElementById("weightSelect").value.trim();
    const lot = document.getElementById("lotSelect").value.trim();
    const number = document.getElementById("numberInput").value.trim();

    if (!item && !brand && !weight && !lot && !number) {
      alert("ã„ãšã‚Œã‹ã‚’é¸æŠã¾ãŸã¯å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
      return;
    }

    showLoading("æ¤œç´¢ä¸­ã§ã™...");
    document.getElementById("searchButton").disabled = true;
    document.getElementById("exportButton").style.display = "none"; //

    google.script.run
      .withSuccessHandler(function(data) {
        hideLoading();
        document.getElementById("searchButton").disabled = false;
        displayResult(data);

        // âœ… æ¤œç´¢çµæœãŒã‚ã‚‹å ´åˆã®ã¿è¡¨ç¤º
        const exportButton = document.getElementById("exportButton");
        exportButton.style.display = (data && data.length > 0) ? "block" : "none";
      })
      .searchSerial(item, brand, weight, lot, number);
  }

  function downloadExcel() {
    const item = document.getElementById("itemSelect").value;
    const brand = document.getElementById("brandSelect").value;
    const weight = document.getElementById("weightSelect").value;
    const lot = document.getElementById("lotSelect").value;
    const number = document.getElementById("numberInput").value;

    document.getElementById("exportButton").style.display = "block";
    document.getElementById("exportResult").innerHTML = "";

    showLoading("Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆä¸­ã§ã™...");

    google.script.run
      .withSuccessHandler(showExportResult)
      .exportSearchResults(item, brand, weight, lot, number); // ğŸ”½ å¼•æ•°ã‚’5ã¤ã«æ‹¡å¼µ
  }

  function showExportResult(message) {
    hideLoading();
    const container = document.getElementById("exportResult");
    container.innerHTML = message.replace(/\n/g, "<br>");
    container.style.display = "block";
  }

  function clearForm() {
    document.getElementById("itemSelect").value = "Au";
    document.getElementById("brandSelect").value = "";
    document.getElementById("weightSelect").value = "";
    document.getElementById("lotSelect").value = "";
    document.getElementById("numberInput").value = "";

    document.getElementById("countContainer").innerHTML = "";
    document.getElementById("resultContainer").innerHTML = "";
    document.getElementById("paginationTop").innerHTML = "";
    document.getElementById("paginationBottom").innerHTML = "";
    document.getElementById("exportResult").innerHTML = "";
    document.getElementById("exportResult").style.display = "none";

    document.getElementById("exportButton").style.display = "none"; // âœ… éè¡¨ç¤ºã«æˆ»ã™

    hideLoading();
    document.getElementById("searchButton").disabled = false;
  }

  function displayResult(data) {
    const countContainer = document.getElementById("countContainer");
    const resultContainer = document.getElementById("resultContainer");
    const paginationTop = document.getElementById("paginationTop");
    const paginationBottom = document.getElementById("paginationBottom");

    countContainer.innerHTML = "";
    resultContainer.innerHTML = "";
    paginationTop.innerHTML = "";
    paginationBottom.innerHTML = "";

    if (!data || data.length === 0) {
      resultContainer.innerHTML = '<div class="result">è©²å½“ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</div>';
      return;
    }

    const pageSize = 50;
    let currentPage = 1;
    const totalPages = Math.ceil(data.length / pageSize);

    function renderPage(page) {
      resultContainer.innerHTML = "";
      paginationTop.innerHTML = "";
      paginationBottom.innerHTML = "";

      const start = (page - 1) * pageSize;
      const end = Math.min(start + pageSize, data.length);
      const pageData = data.slice(start, end);

      // ğŸ”½ è¡¨ç¤ºç¯„å›²ã®æ¡ˆå†…ï¼ˆä¾‹ï¼š51ã€œ100ä»¶ç›®ã‚’è¡¨ç¤ºä¸­ï¼‰
      const rangeInfo = document.createElement("p");
      rangeInfo.className = "count";
      rangeInfo.style.textAlign = "center";
      rangeInfo.style.color = "#000";
      rangeInfo.textContent = `ã€${start + 1}ã€œ${end}ä»¶ç›®ã‚’è¡¨ç¤ºä¸­ã€‘`;
      paginationTop.appendChild(rangeInfo);

      // ğŸ”½ ä¸Šéƒ¨ãƒŠãƒ“è¡¨ç¤º
      paginationTop.appendChild(renderPagination(page, totalPages));

      pageData.forEach(item => {
        const div = document.createElement("div");
        div.className = "result";
        div.innerHTML = `
          <p><span class="serial-highlight">${item.ã‚·ãƒªã‚¢ãƒ«ç•ªå·}</span></p>
          <p><strong>å“ç›®:</strong> ${item.å“ç›®}</p>
          <p><strong>ãƒ–ãƒ©ãƒ³ãƒ‰:</strong> ${item.ãƒ–ãƒ©ãƒ³ãƒ‰}</p>
          <p><strong>é‡é‡:</strong> ${item.é‡é‡}</p>
          <p><strong>ç™ºç”Ÿæ—¥:</strong> ${item.ç™ºç”Ÿæ—¥}</p>
          <p><strong>å‚™è€ƒ:</strong> ${item.å‚™è€ƒ}</p>
          <p><strong>ç®¡è½„:</strong> ${item.ç®¡è½„}</p>
        `;
        resultContainer.appendChild(div);
      });

      // ğŸ”½ ä¸‹éƒ¨ãƒŠãƒ“è¡¨ç¤º
      paginationBottom.appendChild(renderPagination(page, totalPages));
    }

    function renderPagination(page, totalPages) {
      const nav = document.createElement("div");
      nav.style.textAlign = "center";
      nav.style.marginTop = "20px";

      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement("button");
        btn.textContent = i;
        btn.style.margin = "0 4px";
        btn.style.padding = "8px 12px";
        btn.style.borderRadius = "6px";
        btn.style.border = "1px solid #ccc";
        btn.style.background = i === page ? "#00695C" : "#fff";
        btn.style.color = i === page ? "#fff" : "#333";
        btn.style.cursor = "pointer";
        btn.onclick = () => renderPage(i);
        nav.appendChild(btn);
      }

      return nav;
    }

    countContainer.innerHTML = `
      <p class="count">
        ${data.length}ä»¶ã®è©²å½“ãŒã‚ã‚Šã¾ã—ãŸã€‚<br>
        å†åº¦ã”ç¢ºèªã®ä¸Šã€éŠ€åº§ãƒ—ãƒ¬ã‚¤ã‚¹æœ¬ç¤¾ <a href="tel:03-6274-6833">03-6274-6833</a> ã¾ã§ã”å ±å‘Šãã ã•ã„ã€‚
      </p>
    `;

    renderPage(currentPage);
  }

  function showKeypad() {
    const keypad = document.getElementById("customKeypad");
    if (keypad.style.display !== "block") {
      keypad.style.display = "block";
      if (keypad.innerHTML === "") renderKeypad();
    }
  }

  function hideKeypad() {
    document.getElementById("customKeypad").style.display = "none";
  }

  function toggleKeypad() {
    const keypad = document.getElementById("customKeypad");
    keypad.style.display = keypad.style.display === "none" ? "block" : "none";
    if (keypad.innerHTML === "") renderKeypad();
  }

  function renderKeypad() {
    const keypad = document.getElementById("customKeypad");
    const layout = [
      ["1", "2", "3", "4", "5", "del"],
      ["6", "7", "8", "9", "0", "Enter"]
    ];
    keypad.innerHTML = "";
    layout.forEach(row => {
      const rowDiv = document.createElement("div");
      rowDiv.style.display = "flex";
      rowDiv.style.justifyContent = "space-between";
      rowDiv.style.marginBottom = "8px";
      row.forEach(label => {
        const btn = document.createElement("button");

        // âœ… âã‚’è¡¨ç¤ºï¼ˆè¦‹ãŸç›®ã ã‘å¤‰ãˆã‚‹ï¼‰
        btn.innerHTML = label === "Enter" ? "â" : label;

        // âœ… ã‚¹ã‚¿ã‚¤ãƒ«ã¯ã™ã¹ã¦å…±é€šï¼ˆEnterã‚‚æ•°å­—ã‚‚åŒã˜ï¼‰
        btn.style.flex = "1";
        btn.style.margin = "2px";
        btn.style.padding = "16px";
        btn.style.borderRadius = "6px";
        btn.style.border = "1px solid #ccc";
        btn.style.background = "#fff";
        btn.style.color = "#333";
        btn.style.cursor = "pointer";

        btn.onclick = () => handleKeypadInput(label);
        rowDiv.appendChild(btn);
      });
      keypad.appendChild(rowDiv);
    });
  }

  function handleKeypadInput(label) {
    const input = document.getElementById("numberInput");
    if (label === "del") {
      input.value = input.value.slice(0, -1);
    } else if (label === "Enter" || label === "Ent" || label === "ENTER") {
      searchSerial(); // âœ… æ¤œç´¢å®Ÿè¡Œ
      document.getElementById("customKeypad").style.display = "none"; // âœ… ãƒ†ãƒ³ã‚­ãƒ¼éè¡¨ç¤º
    } else {
      input.value += label;
    }
  }
  
document.addEventListener("DOMContentLoaded", () => {
  const input = document.getElementById("numberInput");
  const keypad = document.getElementById("customKeypad");

  // âœ… å…¥åŠ›æ¬„ã‚’ã‚¿ãƒƒãƒ—ã—ãŸã‚‰ãƒ†ãƒ³ã‚­ãƒ¼è¡¨ç¤º
  input.addEventListener("focus", showKeypad);

  // âœ… å…¥åŠ›æ¬„ä»¥å¤–ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰ãƒ†ãƒ³ã‚­ãƒ¼ã‚’é–‰ã˜ã‚‹
  document.addEventListener("click", (event) => {
    const isInput = input.contains(event.target);
    const isKeypad = keypad.contains(event.target);
    const isToggle = document.getElementById("keypadToggle").contains(event.target);
    if (!isInput && !isKeypad && !isToggle) {
      hideKeypad();
    }
  });
});
</script>
</body>
</html>
